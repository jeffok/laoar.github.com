
<!DOCTYPE HTML>
<html>
<head>
	<meta charset="utf-8">
	<title>loop unrolling : may or may not make the program run faster - One Man's Yammer</title>
	<meta name="author" content="Yafang Shao">

	
	<meta name="description" content="Loop Unrolling : May or May Not Make the Program Run Faster TL;DR 前辈@fcicq 看了我这篇blog后，跟我讲，“你虽然描述清楚了状况，但是不知道这是什么” @fcicq是一个理论大师，她所说的“什么”就是指某一个专业术语。 &hellip;">
	
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

	<link href="" rel="alternate" title="One Man's Yammer" type="application/atom+xml">
	<link rel="canonical" href="">
	<link href="/favicon.png" rel="shortcut icon">
	<link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
	<!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
	<script async="true" src="//ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
	
</head>


<body>
	<header id="header" class="inner"><h1><a href="/">One Man's Yammer</a></h1>
<nav id="main-nav"><ul class="main">
	<li><a href="/read">BookWall</a></li>
</ul>
</nav>
<nav id="mobile-nav"> <ul class="main">
	<li><a href="/read">BookWall</a></li>
</ul>
 </nav>
<!--	<div class="menu"> --!>
		<!--<a class="button">Menu</a>
		<div class="container"><ul class="main">
	<li><a href="/read">BookWall</a></li>
</ul>
</div>--!>
	<!--</div>--!>
<!--</nav>--!>
<!-- @yfshao
	<div class="alignright search">
		<a class="button"></a>
		<div class="container">
			<form action="false" method="get">
				<input type="text" name="q" results="0">
				<input type="hidden" name="q" value="site:laoar.github.io">
			</form>
		</div>
	</div>
</nav>
--!>
<!--
<nav id="sub-nav" class="alignright">
	<div class="social">
		
		
		
		
    
		
		
		
		
		
    
	</div>
	<form class="search" action="false" method="get">
		<input class="alignright" type="text" name="q" results="0">
		<input type="hidden" name="q" value="site:laoar.github.io">
	</form>
</nav>
--!>
<!----!>
</header>
	
		
	
	<div id="content" class="inner"><article class="post">
	<h2 class="title">Loop Unrolling : May or May Not Make the Program Run Faster</h2>
	<div class="entry-content"><h2>TL;DR</h2>

<p>前辈@fcicq 看了我这篇blog后，跟我讲，“你虽然描述清楚了状况，但是不知道这是什么”   <br/>
@fcicq是一个理论大师，她所说的“什么”就是指某一个专业术语。得益于与@fcicq 的讨论，使得我的理论知识有了一些进步。特此更新。   <br/>
关于@fcicq，可移步豆瓣: <a href="https://www.douban.com/people/fcicq/">fcicq on Douban</a></p>

<p>loop unrolling 是将while/for循环的循环主体多排列几次，从而在一次迭代中执行更多的数据操作，他的本质意义是CPU的运算器和内存数据带宽的trade off，即计算机中经典的空间与时间的trade off。具体解释请直接跳到结论那一节。</p>

<p>我们可以手动的修改while/for循环来展开循环体，也可以使用编译器的自动循环展开功能。gcc的-funroll-loops就是用来自动将循环给展开用的。在gcc的手册里，对于-funroll-loops有一句说明，</p>

<blockquote><p>This option makes code larger, and may or may not make it run faster.</p></blockquote>

<p>其实这句话并不是很准确，确切的说法是，“This option may improves or reduces the performance.”。</p>

<h2>backgroud</h2>

<p>在最近我的做的一个项目中，版本做出大幅度升级后，性能下降了30%多，经过各种排查后发现原来是编译器从Gcc-4.1.1升级为Gcc-4.2.1后-funroll-loops的行为发生了变化，使得在循环展开的过程中产生了大量的temp variables，这些temp variables入栈和出栈占用了大量的cpu cycles，从而使得其中一个线程成为bottleneck，性能因此下降了30%多.</p>

<h2>why ?</h2>

<p>在这篇博客里，来分析下loop unrolling为什么会导致性能下降  <br/>
如下是我写的一个测试程序用来描述该问题。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
</pre></td><td class='code'><pre><code class='c'><span class='line'><span class="cp">#define TIMES 2</span>
</span><span class='line'><span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span>
</span><span class='line'><span class="nf">atomic_write64</span> <span class="p">(</span><span class="n">u_int64_t</span> <span class="o">*</span><span class="n">addr</span><span class="p">,</span> <span class="n">u_int64_t</span> <span class="n">val</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="k">volatile</span> <span class="n">u_int32_t</span> <span class="n">val_hi</span> <span class="o">=</span> <span class="n">val</span> <span class="o">&gt;&gt;</span> <span class="mi">32</span><span class="p">;</span>
</span><span class='line'>    <span class="k">volatile</span> <span class="n">u_int32_t</span> <span class="n">val_lo</span> <span class="o">=</span> <span class="n">val</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">asm</span>  <span class="k">volatile</span><span class="p">(</span><span class="s">&quot;    .set push           </span><span class="se">\n</span><span class="s">&quot;</span>
</span><span class='line'>                <span class="s">&quot;    .set mips64         </span><span class="se">\n</span><span class="s">&quot;</span>
</span><span class='line'>                <span class="s">&quot;    dsll   %1, %1, 32   </span><span class="se">\n</span><span class="s">&quot;</span>
</span><span class='line'>                <span class="s">&quot;    dsll   %2, %2, 32   </span><span class="se">\n</span><span class="s">&quot;</span>
</span><span class='line'>                <span class="s">&quot;    dsrl   %2, %2, 32   </span><span class="se">\n</span><span class="s">&quot;</span>
</span><span class='line'>                <span class="s">&quot;    or     %1, %1, %2   </span><span class="se">\n</span><span class="s">&quot;</span>
</span><span class='line'>                <span class="s">&quot;    dsll   %0, %0, 32   </span><span class="se">\n</span><span class="s">&quot;</span>
</span><span class='line'>                <span class="s">&quot;    dsrl   %0, %0, 32   </span><span class="se">\n</span><span class="s">&quot;</span>
</span><span class='line'>                <span class="s">&quot;    sd     %1, 0(%0)    </span><span class="se">\n</span><span class="s">&quot;</span>
</span><span class='line'>                <span class="s">&quot;    .set pop            </span><span class="se">\n</span><span class="s">&quot;</span>
</span><span class='line'>                <span class="o">:</span>
</span><span class='line'>                <span class="o">:</span><span class="s">&quot;r&quot;</span><span class="p">(</span><span class="n">addr</span><span class="p">),</span> <span class="s">&quot;r&quot;</span> <span class="p">(</span><span class="n">val_hi</span><span class="p">),</span> <span class="s">&quot;r&quot;</span> <span class="p">(</span><span class="n">val_lo</span><span class="p">)</span>
</span><span class='line'>               <span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="kt">int</span> <span class="n">i</span><span class="p">;</span>
</span><span class='line'>    <span class="n">u_int64_t</span> <span class="n">x</span><span class="p">;</span>
</span><span class='line'>    <span class="n">u_int64_t</span> <span class="o">*</span><span class="n">addr</span> <span class="o">=</span> <span class="p">(</span><span class="n">u_int64_t</span> <span class="o">*</span><span class="p">)</span><span class="n">malloc</span><span class="p">(</span><span class="k">sizeof</span><span class="p">(</span><span class="n">u_int64_t</span><span class="p">)</span> <span class="o">*</span> <span class="mi">2</span><span class="p">);</span>
</span><span class='line'>    <span class="n">u_int64_t</span> <span class="o">*</span><span class="n">new_addr</span> <span class="o">=</span> <span class="p">(</span><span class="n">u_int64_t</span> <span class="o">*</span><span class="p">)((</span><span class="kt">unsigned</span> <span class="kt">int</span><span class="p">)</span><span class="n">addr</span> <span class="o">&amp;</span> <span class="mh">0xfffffff8</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">TIMES</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="c1">// The value of random() is 32bits.</span>
</span><span class='line'>        <span class="n">x</span> <span class="o">=</span> <span class="p">(</span><span class="n">u_int64_t</span><span class="p">)</span><span class="n">random</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="mi">32</span> <span class="o">+</span> <span class="n">random</span><span class="p">();</span>
</span><span class='line'>        <span class="n">atomic_write64</span><span class="p">(</span><span class="n">new_addr</span><span class="p">,</span> <span class="n">x</span><span class="p">);</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>对该测试程序的一些注释：</p>

<ul>
<li>该atomic function摘自freebsd source code。</li>
<li>使用的编译器是Gcc-4.2.1，平台是MIPS（该CPU是64bit的CPU），ABI是O32.[1]</li>
<li>之所以要new_addr的低3bits要为0，是由于sd指令要求地址必须是8字节对齐。   <br/>
这里就是O32和N32区别的一个体现，O32的寄存器是32bits，所以它的栈空间是4字节对齐，即指针是4字节对齐的；N32的寄存器是64bits，所以它的栈空间是64bits，即指针是8字节对齐。在N32上就不需要做这种处理。</li>
<li>由于CPU的寄存器是64bits，所以dsll将寄存器左移32bits后会将寄存器内容移到高32bits，实际上这里是变相在使用N32的特性，即64bit寄存器.</li>
<li>为了便于理解反汇编，gcc的优化option使用-O.</li>
<li>之所以初始测试条件是TIMES为2，而不是1，是为了防止for循环被编译器给优化掉。</li>
</ul>


<p>我们编译该程序，然后看反汇编结果：</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
</pre></td><td class='code'><pre><code class='c'><span class='line'><span class="mo">00000000</span> <span class="o">&lt;</span><span class="n">main</span><span class="o">&gt;:</span>
</span><span class='line'>   <span class="mi">0</span><span class="o">:</span>   <span class="mi">3</span><span class="n">c1c0000</span>    <span class="n">lui</span> <span class="n">gp</span><span class="p">,</span><span class="mh">0x0</span>
</span><span class='line'>   <span class="mi">4</span><span class="o">:</span>   <span class="mi">279</span><span class="n">c0000</span>    <span class="n">addiu</span>   <span class="n">gp</span><span class="p">,</span><span class="n">gp</span><span class="p">,</span><span class="mi">0</span>
</span><span class='line'>   <span class="mi">8</span><span class="o">:</span>   <span class="mf">0399e021</span>    <span class="n">addu</span>    <span class="n">gp</span><span class="p">,</span><span class="n">gp</span><span class="p">,</span><span class="n">t9</span>
</span><span class='line'>   <span class="nl">c:</span>   <span class="mi">27</span><span class="n">bdffc8</span>    <span class="n">addiu</span>   <span class="n">sp</span><span class="p">,</span><span class="n">sp</span><span class="p">,</span><span class="o">-</span><span class="mi">56</span>
</span><span class='line'>  <span class="mi">10</span><span class="o">:</span>   <span class="n">afbf0034</span>    <span class="n">sw</span>  <span class="n">ra</span><span class="p">,</span><span class="mi">52</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
</span><span class='line'>  <span class="mi">14</span><span class="o">:</span>   <span class="n">afb40030</span>    <span class="n">sw</span>  <span class="n">s4</span><span class="p">,</span><span class="mi">48</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
</span><span class='line'>  <span class="mi">18</span><span class="o">:</span>   <span class="n">afb3002c</span>    <span class="n">sw</span>  <span class="n">s3</span><span class="p">,</span><span class="mi">44</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
</span><span class='line'>  <span class="mi">1</span><span class="n">c</span><span class="o">:</span>   <span class="n">afb20028</span>    <span class="n">sw</span>  <span class="n">s2</span><span class="p">,</span><span class="mi">40</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
</span><span class='line'>  <span class="mi">20</span><span class="o">:</span>   <span class="n">afb10024</span>    <span class="n">sw</span>  <span class="n">s1</span><span class="p">,</span><span class="mi">36</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
</span><span class='line'>  <span class="mi">24</span><span class="o">:</span>   <span class="n">afb00020</span>    <span class="n">sw</span>  <span class="n">s0</span><span class="p">,</span><span class="mi">32</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
</span><span class='line'>  <span class="mi">28</span><span class="o">:</span>   <span class="n">afbc0010</span>    <span class="n">sw</span>  <span class="n">gp</span><span class="p">,</span><span class="mi">16</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
</span><span class='line'>  <span class="mi">2</span><span class="n">c</span><span class="o">:</span>   <span class="mf">8f</span><span class="mi">990000</span>    <span class="n">lw</span>  <span class="n">t9</span><span class="p">,</span><span class="mi">0</span><span class="p">(</span><span class="n">gp</span><span class="p">)</span>
</span><span class='line'>  <span class="mi">30</span><span class="o">:</span>   <span class="mf">0320f</span><span class="mi">809</span>    <span class="n">jalr</span>    <span class="n">t9</span>
</span><span class='line'>  <span class="mi">34</span><span class="o">:</span>   <span class="mi">24040010</span>    <span class="n">li</span>  <span class="n">a0</span><span class="p">,</span><span class="mi">16</span>
</span><span class='line'>  <span class="mi">38</span><span class="o">:</span>   <span class="mf">8f</span><span class="n">bc0010</span>    <span class="n">lw</span>  <span class="n">gp</span><span class="p">,</span><span class="mi">16</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
</span><span class='line'>  <span class="mi">3</span><span class="n">c</span><span class="o">:</span>   <span class="mf">2403ff</span><span class="n">f8</span>    <span class="n">li</span>  <span class="n">v1</span><span class="p">,</span><span class="o">-</span><span class="mi">8</span>
</span><span class='line'>  <span class="mi">40</span><span class="o">:</span>   <span class="mo">0043</span><span class="n">a024</span>    <span class="n">and</span> <span class="n">s4</span><span class="p">,</span><span class="n">v0</span><span class="p">,</span><span class="n">v1</span>
</span><span class='line'>  <span class="mi">44</span><span class="o">:</span>   <span class="mo">0000</span><span class="mi">9021</span>    <span class="n">move</span>    <span class="n">s2</span><span class="p">,</span><span class="n">zero</span>
</span><span class='line'>  <span class="mi">48</span><span class="o">:</span>   <span class="mf">8f</span><span class="mi">990000</span>    <span class="n">lw</span>  <span class="n">t9</span><span class="p">,</span><span class="mi">0</span><span class="p">(</span><span class="n">gp</span><span class="p">)</span>
</span><span class='line'>  <span class="mi">4</span><span class="n">c</span><span class="o">:</span>   <span class="mo">0320</span><span class="mi">9821</span>    <span class="n">move</span>    <span class="n">s3</span><span class="p">,</span><span class="n">t9</span>
</span><span class='line'>  <span class="mi">50</span><span class="o">:</span>   <span class="mo">0260</span><span class="n">c821</span>    <span class="n">move</span>    <span class="n">t9</span><span class="p">,</span><span class="n">s3</span>
</span><span class='line'>  <span class="mi">54</span><span class="o">:</span>   <span class="mf">0320f</span><span class="mi">809</span>    <span class="n">jalr</span>    <span class="n">t9</span>
</span><span class='line'>  <span class="mi">58</span><span class="o">:</span>   <span class="mo">0000</span><span class="mi">8821</span>    <span class="n">move</span>    <span class="n">s1</span><span class="p">,</span><span class="n">zero</span>
</span><span class='line'>  <span class="mi">5</span><span class="n">c</span><span class="o">:</span>   <span class="mf">8f</span><span class="n">bc0010</span>    <span class="n">lw</span>  <span class="n">gp</span><span class="p">,</span><span class="mi">16</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
</span><span class='line'>  <span class="mi">60</span><span class="o">:</span>   <span class="mo">0260</span><span class="n">c821</span>    <span class="n">move</span>    <span class="n">t9</span><span class="p">,</span><span class="n">s3</span>
</span><span class='line'>  <span class="mi">64</span><span class="o">:</span>   <span class="mf">0320f</span><span class="mi">809</span>    <span class="n">jalr</span>    <span class="n">t9</span>
</span><span class='line'>  <span class="mi">68</span><span class="o">:</span>   <span class="mo">0040</span><span class="mi">8021</span>    <span class="n">move</span>    <span class="n">s0</span><span class="p">,</span><span class="n">v0</span>
</span><span class='line'>  <span class="mi">6</span><span class="n">c</span><span class="o">:</span>   <span class="mf">8f</span><span class="n">bc0010</span>    <span class="n">lw</span>  <span class="n">gp</span><span class="p">,</span><span class="mi">16</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
</span><span class='line'>  <span class="mi">70</span><span class="o">:</span>   <span class="mo">00401</span><span class="mi">821</span>    <span class="n">move</span>    <span class="n">v1</span><span class="p">,</span><span class="n">v0</span>
</span><span class='line'>  <span class="mi">74</span><span class="o">:</span>   <span class="mo">000217</span><span class="n">c3</span>    <span class="n">sra</span> <span class="n">v0</span><span class="p">,</span><span class="n">v0</span><span class="p">,</span><span class="mh">0x1f</span>
</span><span class='line'>  <span class="mi">78</span><span class="o">:</span>   <span class="mo">0202</span><span class="mi">8025</span>    <span class="n">or</span>  <span class="n">s0</span><span class="p">,</span><span class="n">s0</span><span class="p">,</span><span class="n">v0</span>
</span><span class='line'>  <span class="mi">7</span><span class="n">c</span><span class="o">:</span>   <span class="mo">0223</span><span class="mi">8825</span>    <span class="n">or</span>  <span class="n">s1</span><span class="p">,</span><span class="n">s1</span><span class="p">,</span><span class="n">v1</span>
</span><span class='line'>  <span class="mi">80</span><span class="o">:</span>   <span class="n">afb00018</span>    <span class="n">sw</span>  <span class="n">s0</span><span class="p">,</span><span class="mi">24</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
</span><span class='line'>  <span class="mi">84</span><span class="o">:</span>   <span class="n">afb1001c</span>    <span class="n">sw</span>  <span class="n">s1</span><span class="p">,</span><span class="mi">28</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
</span><span class='line'>  <span class="mi">88</span><span class="o">:</span>   <span class="mf">8f</span><span class="n">a30018</span>    <span class="n">lw</span>  <span class="n">v1</span><span class="p">,</span><span class="mi">24</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
</span><span class='line'>  <span class="mi">8</span><span class="n">c</span><span class="o">:</span>   <span class="mf">8f</span><span class="n">a2001c</span>    <span class="n">lw</span>  <span class="n">v0</span><span class="p">,</span><span class="mi">28</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
</span><span class='line'>  <span class="mi">90</span><span class="o">:</span>   <span class="mo">00031</span><span class="mi">83</span><span class="n">c</span>    <span class="n">dsll32</span>  <span class="n">v1</span><span class="p">,</span><span class="n">v1</span><span class="p">,</span><span class="mh">0x0</span>
</span><span class='line'>  <span class="mi">94</span><span class="o">:</span>   <span class="mo">0002103</span><span class="n">c</span>    <span class="n">dsll32</span>  <span class="n">v0</span><span class="p">,</span><span class="n">v0</span><span class="p">,</span><span class="mh">0x0</span>
</span><span class='line'>  <span class="mi">98</span><span class="o">:</span>   <span class="mo">0002103</span><span class="n">e</span>    <span class="n">dsrl32</span>  <span class="n">v0</span><span class="p">,</span><span class="n">v0</span><span class="p">,</span><span class="mh">0x0</span>
</span><span class='line'>  <span class="mi">9</span><span class="n">c</span><span class="o">:</span>   <span class="mo">00621</span><span class="mi">825</span>    <span class="n">or</span>  <span class="n">v1</span><span class="p">,</span><span class="n">v1</span><span class="p">,</span><span class="n">v0</span>
</span><span class='line'>  <span class="nl">a0:</span>   <span class="mo">0014</span><span class="n">a03c</span>    <span class="n">dsll32</span>  <span class="n">s4</span><span class="p">,</span><span class="n">s4</span><span class="p">,</span><span class="mh">0x0</span>
</span><span class='line'>  <span class="nl">a4:</span>   <span class="mo">0014</span><span class="n">a03e</span>    <span class="n">dsrl32</span>  <span class="n">s4</span><span class="p">,</span><span class="n">s4</span><span class="p">,</span><span class="mh">0x0</span>
</span><span class='line'>  <span class="nl">a8:</span>   <span class="n">fe830000</span>    <span class="n">sd</span>  <span class="n">v1</span><span class="p">,</span><span class="mi">0</span><span class="p">(</span><span class="n">s4</span><span class="p">)</span>
</span><span class='line'>  <span class="nl">ac:</span>   <span class="mi">26520001</span>    <span class="n">addiu</span>   <span class="n">s2</span><span class="p">,</span><span class="n">s2</span><span class="p">,</span><span class="mi">1</span>
</span><span class='line'>  <span class="nl">b0:</span>   <span class="mi">24020002</span>    <span class="n">li</span>  <span class="n">v0</span><span class="p">,</span><span class="mi">2</span>
</span><span class='line'>  <span class="nl">b4:</span>   <span class="mf">1642ff</span><span class="n">e7</span>    <span class="n">bne</span> <span class="n">s2</span><span class="p">,</span><span class="n">v0</span><span class="p">,</span><span class="mi">54</span> <span class="o">&lt;</span><span class="n">main</span><span class="o">+</span><span class="mh">0x54</span><span class="o">&gt;</span>
</span><span class='line'>  <span class="nl">b8:</span>   <span class="mo">0260</span><span class="n">c821</span>    <span class="n">move</span>    <span class="n">t9</span><span class="p">,</span><span class="n">s3</span>
</span><span class='line'>  <span class="nl">bc:</span>   <span class="mo">00001021</span>    <span class="n">move</span>    <span class="n">v0</span><span class="p">,</span><span class="n">zero</span>
</span><span class='line'>  <span class="nl">c0:</span>   <span class="mf">8f</span><span class="n">bf0034</span>    <span class="n">lw</span>  <span class="n">ra</span><span class="p">,</span><span class="mi">52</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
</span><span class='line'>  <span class="nl">c4:</span>   <span class="mf">8f</span><span class="n">b40030</span>    <span class="n">lw</span>  <span class="n">s4</span><span class="p">,</span><span class="mi">48</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
</span><span class='line'>  <span class="nl">c8:</span>   <span class="mf">8f</span><span class="n">b3002c</span>    <span class="n">lw</span>  <span class="n">s3</span><span class="p">,</span><span class="mi">44</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
</span><span class='line'>  <span class="nl">cc:</span>   <span class="mf">8f</span><span class="n">b20028</span>    <span class="n">lw</span>  <span class="n">s2</span><span class="p">,</span><span class="mi">40</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
</span><span class='line'>  <span class="nl">d0:</span>   <span class="mf">8f</span><span class="n">b10024</span>    <span class="n">lw</span>  <span class="n">s1</span><span class="p">,</span><span class="mi">36</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
</span><span class='line'>  <span class="nl">d4:</span>   <span class="mf">8f</span><span class="n">b00020</span>    <span class="n">lw</span>  <span class="n">s0</span><span class="p">,</span><span class="mi">32</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
</span><span class='line'>  <span class="nl">d8:</span>   <span class="mf">03e00008</span>    <span class="n">jr</span>  <span class="n">ra</span>
</span><span class='line'>  <span class="nl">dc:</span>   <span class="mi">27</span><span class="n">bd0038</span>    <span class="n">addiu</span>   <span class="n">sp</span><span class="p">,</span><span class="n">sp</span><span class="p">,</span><span class="mi">56</span>
</span></code></pre></td></tr></table></div></figure>


<p>可以看出，变量<code>val_hi</code>和<code>val_lo</code>分别存储在24(sp)和28(sp)这部分内存空间.  <br/>
另外还需要注意的变量x。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='c'><span class='line'>  <span class="mi">64</span><span class="o">:</span>   <span class="mf">0320f</span><span class="mi">809</span>    <span class="n">jalr</span>    <span class="n">t9</span>
</span><span class='line'>  <span class="mi">68</span><span class="o">:</span>   <span class="mo">0040</span><span class="mi">8021</span>    <span class="n">move</span>    <span class="n">s0</span><span class="p">,</span><span class="n">v0</span>
</span><span class='line'>  <span class="mi">6</span><span class="n">c</span><span class="o">:</span>   <span class="mf">8f</span><span class="n">bc0010</span>    <span class="n">lw</span>  <span class="n">gp</span><span class="p">,</span><span class="mi">16</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
</span><span class='line'>  <span class="mi">70</span><span class="o">:</span>   <span class="mo">00401</span><span class="mi">821</span>    <span class="n">move</span>    <span class="n">v1</span><span class="p">,</span><span class="n">v0</span>
</span></code></pre></td></tr></table></div></figure>


<p>由于我只是-C来编译，并没有做链接，所以在这里调用<code>random()</code>这个函数是被编译为了<code>jalr t9</code>，在MIPS上，函数调用的返回值会放在$v0这个寄存器里面。[2]在这里函数调用的返回值$v0 是直接赋值给了$s0和$v1，而不是放入栈空间，这说明编译器将变量x存储在了寄存器里面而不是内存里面。编译器之所以会这么做，是为了提高性能。变量尽可能的存储在寄存器上，从而减少访问内存所需要消耗的时间。另外再说一句，寄存器数量是有限的，当寄存器无法再存储变量时，就会将临时变量存储到内存上。</p>

<p>然后我们将TIME 变为3，对比看下有无funroll-loops下的差异。</p>

<h4>无funroll-loops.</h4>

<p>结果证明，跟TIMES为2的情况下相比，反汇编结果一样。此处不再拷贝代码</p>

<h4>使用funroll-loops</h4>

<p>汇编代码较长，闪花了眼，我在后面只解释重点。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
<span class='line-number'>97</span>
<span class='line-number'>98</span>
<span class='line-number'>99</span>
<span class='line-number'>100</span>
<span class='line-number'>101</span>
<span class='line-number'>102</span>
<span class='line-number'>103</span>
<span class='line-number'>104</span>
<span class='line-number'>105</span>
<span class='line-number'>106</span>
<span class='line-number'>107</span>
<span class='line-number'>108</span>
<span class='line-number'>109</span>
<span class='line-number'>110</span>
<span class='line-number'>111</span>
<span class='line-number'>112</span>
<span class='line-number'>113</span>
<span class='line-number'>114</span>
<span class='line-number'>115</span>
<span class='line-number'>116</span>
<span class='line-number'>117</span>
<span class='line-number'>118</span>
<span class='line-number'>119</span>
<span class='line-number'>120</span>
<span class='line-number'>121</span>
<span class='line-number'>122</span>
<span class='line-number'>123</span>
<span class='line-number'>124</span>
<span class='line-number'>125</span>
<span class='line-number'>126</span>
<span class='line-number'>127</span>
<span class='line-number'>128</span>
<span class='line-number'>129</span>
<span class='line-number'>130</span>
<span class='line-number'>131</span>
<span class='line-number'>132</span>
<span class='line-number'>133</span>
<span class='line-number'>134</span>
<span class='line-number'>135</span>
<span class='line-number'>136</span>
<span class='line-number'>137</span>
<span class='line-number'>138</span>
<span class='line-number'>139</span>
<span class='line-number'>140</span>
<span class='line-number'>141</span>
<span class='line-number'>142</span>
<span class='line-number'>143</span>
<span class='line-number'>144</span>
<span class='line-number'>145</span>
<span class='line-number'>146</span>
<span class='line-number'>147</span>
<span class='line-number'>148</span>
<span class='line-number'>149</span>
<span class='line-number'>150</span>
<span class='line-number'>151</span>
<span class='line-number'>152</span>
<span class='line-number'>153</span>
<span class='line-number'>154</span>
<span class='line-number'>155</span>
<span class='line-number'>156</span>
<span class='line-number'>157</span>
<span class='line-number'>158</span>
<span class='line-number'>159</span>
<span class='line-number'>160</span>
<span class='line-number'>161</span>
<span class='line-number'>162</span>
<span class='line-number'>163</span>
<span class='line-number'>164</span>
<span class='line-number'>165</span>
<span class='line-number'>166</span>
<span class='line-number'>167</span>
<span class='line-number'>168</span>
<span class='line-number'>169</span>
<span class='line-number'>170</span>
<span class='line-number'>171</span>
<span class='line-number'>172</span>
<span class='line-number'>173</span>
<span class='line-number'>174</span>
<span class='line-number'>175</span>
</pre></td><td class='code'><pre><code class='c'><span class='line'><span class="mo">00000000</span> <span class="o">&lt;</span><span class="n">main</span><span class="o">&gt;:</span>
</span><span class='line'>   <span class="mi">0</span><span class="o">:</span>   <span class="mi">3</span><span class="n">c1c0000</span>    <span class="n">lui</span> <span class="n">gp</span><span class="p">,</span><span class="mh">0x0</span>
</span><span class='line'>   <span class="mi">4</span><span class="o">:</span>   <span class="mi">279</span><span class="n">c0000</span>    <span class="n">addiu</span>   <span class="n">gp</span><span class="p">,</span><span class="n">gp</span><span class="p">,</span><span class="mi">0</span>
</span><span class='line'>   <span class="mi">8</span><span class="o">:</span>   <span class="mf">0399e021</span>    <span class="n">addu</span>    <span class="n">gp</span><span class="p">,</span><span class="n">gp</span><span class="p">,</span><span class="n">t9</span>
</span><span class='line'>   <span class="nl">c:</span>   <span class="mi">27</span><span class="n">bdff58</span>    <span class="n">addiu</span>   <span class="n">sp</span><span class="p">,</span><span class="n">sp</span><span class="p">,</span><span class="o">-</span><span class="mi">168</span>
</span><span class='line'>  <span class="mi">10</span><span class="o">:</span>   <span class="n">afbf00a4</span>    <span class="n">sw</span>  <span class="n">ra</span><span class="p">,</span><span class="mi">164</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
</span><span class='line'>  <span class="mi">14</span><span class="o">:</span>   <span class="n">afbe00a0</span>    <span class="n">sw</span>  <span class="n">s8</span><span class="p">,</span><span class="mi">160</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
</span><span class='line'>  <span class="mi">18</span><span class="o">:</span>   <span class="n">afb7009c</span>    <span class="n">sw</span>  <span class="n">s7</span><span class="p">,</span><span class="mi">156</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
</span><span class='line'>  <span class="mi">1</span><span class="n">c</span><span class="o">:</span>   <span class="n">afb60098</span>    <span class="n">sw</span>  <span class="n">s6</span><span class="p">,</span><span class="mi">152</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
</span><span class='line'>  <span class="mi">20</span><span class="o">:</span>   <span class="n">afb50094</span>    <span class="n">sw</span>  <span class="n">s5</span><span class="p">,</span><span class="mi">148</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
</span><span class='line'>  <span class="mi">24</span><span class="o">:</span>   <span class="n">afb40090</span>    <span class="n">sw</span>  <span class="n">s4</span><span class="p">,</span><span class="mi">144</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
</span><span class='line'>  <span class="mi">28</span><span class="o">:</span>   <span class="n">afb3008c</span>    <span class="n">sw</span>  <span class="n">s3</span><span class="p">,</span><span class="mi">140</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
</span><span class='line'>  <span class="mi">2</span><span class="n">c</span><span class="o">:</span>   <span class="n">afb20088</span>    <span class="n">sw</span>  <span class="n">s2</span><span class="p">,</span><span class="mi">136</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
</span><span class='line'>  <span class="mi">30</span><span class="o">:</span>   <span class="n">afb10084</span>    <span class="n">sw</span>  <span class="n">s1</span><span class="p">,</span><span class="mi">132</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
</span><span class='line'>  <span class="mi">34</span><span class="o">:</span>   <span class="n">afb00080</span>    <span class="n">sw</span>  <span class="n">s0</span><span class="p">,</span><span class="mi">128</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
</span><span class='line'>  <span class="mi">38</span><span class="o">:</span>   <span class="n">afbc0010</span>    <span class="n">sw</span>  <span class="n">gp</span><span class="p">,</span><span class="mi">16</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
</span><span class='line'>  <span class="mi">3</span><span class="n">c</span><span class="o">:</span>   <span class="mo">00003</span><span class="mi">821</span>    <span class="n">move</span>    <span class="n">a3</span><span class="p">,</span><span class="n">zero</span>
</span><span class='line'>  <span class="mi">40</span><span class="o">:</span>   <span class="mo">00003021</span>    <span class="n">move</span>    <span class="n">a2</span><span class="p">,</span><span class="n">zero</span>
</span><span class='line'>  <span class="mi">44</span><span class="o">:</span>   <span class="n">afa70024</span>    <span class="n">sw</span>  <span class="n">a3</span><span class="p">,</span><span class="mi">36</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
</span><span class='line'>  <span class="mi">48</span><span class="o">:</span>   <span class="n">afa60020</span>    <span class="n">sw</span>  <span class="n">a2</span><span class="p">,</span><span class="mi">32</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
</span><span class='line'>  <span class="mi">4</span><span class="n">c</span><span class="o">:</span>   <span class="n">afa7002c</span>    <span class="n">sw</span>  <span class="n">a3</span><span class="p">,</span><span class="mi">44</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
</span><span class='line'>  <span class="mi">50</span><span class="o">:</span>   <span class="n">afa60028</span>    <span class="n">sw</span>  <span class="n">a2</span><span class="p">,</span><span class="mi">40</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
</span><span class='line'>  <span class="mi">54</span><span class="o">:</span>   <span class="n">afa7003c</span>    <span class="n">sw</span>  <span class="n">a3</span><span class="p">,</span><span class="mi">60</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
</span><span class='line'>  <span class="mi">58</span><span class="o">:</span>   <span class="n">afa60038</span>    <span class="n">sw</span>  <span class="n">a2</span><span class="p">,</span><span class="mi">56</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
</span><span class='line'>  <span class="mi">5</span><span class="n">c</span><span class="o">:</span>   <span class="mo">00002021</span>    <span class="n">move</span>    <span class="n">a0</span><span class="p">,</span><span class="n">zero</span>
</span><span class='line'>  <span class="mi">60</span><span class="o">:</span>   <span class="mo">00001</span><span class="mi">821</span>    <span class="n">move</span>    <span class="n">v1</span><span class="p">,</span><span class="n">zero</span>
</span><span class='line'>  <span class="mi">64</span><span class="o">:</span>   <span class="n">afa40044</span>    <span class="n">sw</span>  <span class="n">a0</span><span class="p">,</span><span class="mi">68</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
</span><span class='line'>  <span class="mi">68</span><span class="o">:</span>   <span class="n">afa30040</span>    <span class="n">sw</span>  <span class="n">v1</span><span class="p">,</span><span class="mi">64</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
</span><span class='line'>  <span class="mi">6</span><span class="n">c</span><span class="o">:</span>   <span class="n">afa4004c</span>    <span class="n">sw</span>  <span class="n">a0</span><span class="p">,</span><span class="mi">76</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
</span><span class='line'>  <span class="mi">70</span><span class="o">:</span>   <span class="n">afa30048</span>    <span class="n">sw</span>  <span class="n">v1</span><span class="p">,</span><span class="mi">72</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
</span><span class='line'>  <span class="mi">74</span><span class="o">:</span>   <span class="n">afa40054</span>    <span class="n">sw</span>  <span class="n">a0</span><span class="p">,</span><span class="mi">84</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
</span><span class='line'>  <span class="mi">78</span><span class="o">:</span>   <span class="n">afa30050</span>    <span class="n">sw</span>  <span class="n">v1</span><span class="p">,</span><span class="mi">80</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
</span><span class='line'>  <span class="mi">7</span><span class="n">c</span><span class="o">:</span>   <span class="n">afa4005c</span>    <span class="n">sw</span>  <span class="n">a0</span><span class="p">,</span><span class="mi">92</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
</span><span class='line'>  <span class="mi">80</span><span class="o">:</span>   <span class="n">afa30058</span>    <span class="n">sw</span>  <span class="n">v1</span><span class="p">,</span><span class="mi">88</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
</span><span class='line'>  <span class="mi">84</span><span class="o">:</span>   <span class="n">afa40064</span>    <span class="n">sw</span>  <span class="n">a0</span><span class="p">,</span><span class="mi">100</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
</span><span class='line'>  <span class="mi">88</span><span class="o">:</span>   <span class="n">afa30060</span>    <span class="n">sw</span>  <span class="n">v1</span><span class="p">,</span><span class="mi">96</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
</span><span class='line'> <span class="mi">8</span><span class="n">c</span><span class="o">:</span>   <span class="n">afa4006c</span>    <span class="n">sw</span>  <span class="n">a0</span><span class="p">,</span><span class="mi">108</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
</span><span class='line'>  <span class="mi">90</span><span class="o">:</span>   <span class="n">afa30068</span>    <span class="n">sw</span>  <span class="n">v1</span><span class="p">,</span><span class="mi">104</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
</span><span class='line'>  <span class="mi">94</span><span class="o">:</span>   <span class="n">afa40074</span>    <span class="n">sw</span>  <span class="n">a0</span><span class="p">,</span><span class="mi">116</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
</span><span class='line'>  <span class="mi">98</span><span class="o">:</span>   <span class="n">afa30070</span>    <span class="n">sw</span>  <span class="n">v1</span><span class="p">,</span><span class="mi">112</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
</span><span class='line'>  <span class="mi">9</span><span class="n">c</span><span class="o">:</span>   <span class="n">afa4007c</span>    <span class="n">sw</span>  <span class="n">a0</span><span class="p">,</span><span class="mi">124</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
</span><span class='line'>  <span class="nl">a0:</span>   <span class="n">afa30078</span>    <span class="n">sw</span>  <span class="n">v1</span><span class="p">,</span><span class="mi">120</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
</span><span class='line'>  <span class="nl">a4:</span>   <span class="mf">8f</span><span class="mi">990000</span>    <span class="n">lw</span>  <span class="n">t9</span><span class="p">,</span><span class="mi">0</span><span class="p">(</span><span class="n">gp</span><span class="p">)</span>
</span><span class='line'>  <span class="nl">a8:</span>   <span class="mf">0320f</span><span class="mi">809</span>    <span class="n">jalr</span>    <span class="n">t9</span>
</span><span class='line'>  <span class="nl">ac:</span>   <span class="mi">24040010</span>    <span class="n">li</span>  <span class="n">a0</span><span class="p">,</span><span class="mi">16</span>
</span><span class='line'>  <span class="nl">b0:</span>   <span class="mf">8f</span><span class="n">bc0010</span>    <span class="n">lw</span>  <span class="n">gp</span><span class="p">,</span><span class="mi">16</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
</span><span class='line'>  <span class="nl">b4:</span>   <span class="mf">2405ff</span><span class="n">f8</span>    <span class="n">li</span>  <span class="n">a1</span><span class="p">,</span><span class="o">-</span><span class="mi">8</span>
</span><span class='line'>  <span class="nl">b8:</span>   <span class="mo">00451024</span>    <span class="n">and</span> <span class="n">v0</span><span class="p">,</span><span class="n">v0</span><span class="p">,</span><span class="n">a1</span>
</span><span class='line'>  <span class="nl">bc:</span>   <span class="mf">8f</span><span class="mi">990000</span>    <span class="n">lw</span>  <span class="n">t9</span><span class="p">,</span><span class="mi">0</span><span class="p">(</span><span class="n">gp</span><span class="p">)</span>
</span><span class='line'>  <span class="nl">c0:</span>   <span class="mf">0320f</span><span class="mi">809</span>    <span class="n">jalr</span>    <span class="n">t9</span>
</span><span class='line'>  <span class="nl">c4:</span>   <span class="n">afa20030</span>    <span class="n">sw</span>  <span class="n">v0</span><span class="p">,</span><span class="mi">48</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
</span><span class='line'>  <span class="nl">c8:</span>   <span class="mf">8f</span><span class="n">bc0010</span>    <span class="n">lw</span>  <span class="n">gp</span><span class="p">,</span><span class="mi">16</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
</span><span class='line'>  <span class="nl">cc:</span>   <span class="mf">8f</span><span class="mi">990000</span>    <span class="n">lw</span>  <span class="n">t9</span><span class="p">,</span><span class="mi">0</span><span class="p">(</span><span class="n">gp</span><span class="p">)</span>
</span><span class='line'>  <span class="nl">d0:</span>   <span class="mf">0320f</span><span class="mi">809</span>    <span class="n">jalr</span>    <span class="n">t9</span>
</span><span class='line'>  <span class="nl">d4:</span>   <span class="mo">0040</span><span class="mi">8021</span>    <span class="n">move</span>    <span class="n">s0</span><span class="p">,</span><span class="n">v0</span>
</span><span class='line'>  <span class="nl">d8:</span>   <span class="mf">8f</span><span class="n">bc0010</span>    <span class="n">lw</span>  <span class="n">gp</span><span class="p">,</span><span class="mi">16</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
</span><span class='line'>  <span class="nl">dc:</span>   <span class="mo">0000</span><span class="n">a821</span>    <span class="n">move</span>    <span class="n">s5</span><span class="p">,</span><span class="n">zero</span>
</span><span class='line'>  <span class="nl">e0:</span>   <span class="mo">0002</span><span class="n">c7c3</span>    <span class="n">sra</span> <span class="n">t8</span><span class="p">,</span><span class="n">v0</span><span class="p">,</span><span class="mh">0x1f</span>
</span><span class='line'>  <span class="nl">e4:</span>   <span class="mo">021</span><span class="mi">8</span><span class="n">b825</span>    <span class="n">or</span>  <span class="n">s7</span><span class="p">,</span><span class="n">s0</span><span class="p">,</span><span class="n">t8</span>
</span><span class='line'>  <span class="nl">e8:</span>   <span class="n">afb70028</span>    <span class="n">sw</span>  <span class="n">s7</span><span class="p">,</span><span class="mi">40</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
</span><span class='line'>  <span class="nl">ec:</span>   <span class="mo">02</span><span class="n">a2a025</span>    <span class="n">or</span>  <span class="n">s4</span><span class="p">,</span><span class="n">s5</span><span class="p">,</span><span class="n">v0</span>
</span><span class='line'>  <span class="nl">f0:</span>   <span class="n">afb4002c</span>    <span class="n">sw</span>  <span class="n">s4</span><span class="p">,</span><span class="mi">44</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
</span><span class='line'>  <span class="nl">f4:</span>   <span class="mf">8f</span><span class="n">b1002c</span>    <span class="n">lw</span>  <span class="n">s1</span><span class="p">,</span><span class="mi">44</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
</span><span class='line'>  <span class="nl">f8:</span>   <span class="mf">8f</span><span class="n">b30028</span>    <span class="n">lw</span>  <span class="n">s3</span><span class="p">,</span><span class="mi">40</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
</span><span class='line'>  <span class="nl">fc:</span>   <span class="n">afb30018</span>    <span class="n">sw</span>  <span class="n">s3</span><span class="p">,</span><span class="mi">24</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
</span><span class='line'><span class="mi">100</span><span class="o">:</span>   <span class="n">afb1001c</span>    <span class="n">sw</span>  <span class="n">s1</span><span class="p">,</span><span class="mi">28</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
</span><span class='line'><span class="mi">104</span><span class="o">:</span>   <span class="mf">8f</span><span class="n">ae0018</span>    <span class="n">lw</span>  <span class="n">t6</span><span class="p">,</span><span class="mi">24</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
</span><span class='line'><span class="mi">108</span><span class="o">:</span>   <span class="mf">8f</span><span class="n">af001c</span>    <span class="n">lw</span>  <span class="n">t7</span><span class="p">,</span><span class="mi">28</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
</span><span class='line'><span class="mi">10</span><span class="n">c</span><span class="o">:</span>   <span class="mf">8f</span><span class="n">a50030</span>    <span class="n">lw</span>  <span class="n">a1</span><span class="p">,</span><span class="mi">48</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
</span><span class='line'><span class="mi">110</span><span class="o">:</span>   <span class="mf">000e703</span><span class="n">c</span>    <span class="n">dsll32</span>  <span class="n">t6</span><span class="p">,</span><span class="n">t6</span><span class="p">,</span><span class="mh">0x0</span>
</span><span class='line'><span class="mi">114</span><span class="o">:</span>   <span class="mf">000f</span><span class="mi">783</span><span class="n">c</span>    <span class="n">dsll32</span>  <span class="n">t7</span><span class="p">,</span><span class="n">t7</span><span class="p">,</span><span class="mh">0x0</span>
</span><span class='line'><span class="mi">118</span><span class="o">:</span>   <span class="mf">000f</span><span class="mi">783</span><span class="n">e</span>    <span class="n">dsrl32</span>  <span class="n">t7</span><span class="p">,</span><span class="n">t7</span><span class="p">,</span><span class="mh">0x0</span>
</span><span class='line'><span class="mi">11</span><span class="n">c</span><span class="o">:</span>   <span class="mo">01</span><span class="n">cf7025</span>    <span class="n">or</span>  <span class="n">t6</span><span class="p">,</span><span class="n">t6</span><span class="p">,</span><span class="n">t7</span>
</span><span class='line'><span class="mi">120</span><span class="o">:</span>   <span class="mo">00052</span><span class="mi">83</span><span class="n">c</span>    <span class="n">dsll32</span>  <span class="n">a1</span><span class="p">,</span><span class="n">a1</span><span class="p">,</span><span class="mh">0x0</span>
</span><span class='line'><span class="mi">124</span><span class="o">:</span>   <span class="mo">00052</span><span class="mi">83</span><span class="n">e</span>    <span class="n">dsrl32</span>  <span class="n">a1</span><span class="p">,</span><span class="n">a1</span><span class="p">,</span><span class="mh">0x0</span>
</span><span class='line'><span class="mi">128</span><span class="o">:</span>   <span class="n">fcae0000</span>    <span class="n">sd</span>  <span class="n">t6</span><span class="p">,</span><span class="mi">0</span><span class="p">(</span><span class="n">a1</span><span class="p">)</span>
</span><span class='line'><span class="mi">12</span><span class="n">c</span><span class="o">:</span>   <span class="mf">8f</span><span class="mi">990000</span>    <span class="n">lw</span>  <span class="n">t9</span><span class="p">,</span><span class="mi">0</span><span class="p">(</span><span class="n">gp</span><span class="p">)</span>
</span><span class='line'><span class="mi">130</span><span class="o">:</span>   <span class="mf">0320f</span><span class="mi">809</span>    <span class="n">jalr</span>    <span class="n">t9</span>
</span><span class='line'><span class="mi">134</span><span class="o">:</span>   <span class="mf">0000f</span><span class="mo">021</span>    <span class="n">move</span>    <span class="n">s8</span><span class="p">,</span><span class="n">zero</span>
</span><span class='line'><span class="mi">138</span><span class="o">:</span>   <span class="mf">8f</span><span class="n">bc0010</span>    <span class="n">lw</span>  <span class="n">gp</span><span class="p">,</span><span class="mi">16</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
</span><span class='line'><span class="mi">13</span><span class="n">c</span><span class="o">:</span>   <span class="mf">8f</span><span class="mi">990000</span>    <span class="n">lw</span>  <span class="n">t9</span><span class="p">,</span><span class="mi">0</span><span class="p">(</span><span class="n">gp</span><span class="p">)</span>
</span><span class='line'><span class="mi">140</span><span class="o">:</span>   <span class="mf">0320f</span><span class="mi">809</span>    <span class="n">jalr</span>    <span class="n">t9</span>
</span><span class='line'><span class="mi">144</span><span class="o">:</span>   <span class="mo">0040</span><span class="mi">8021</span>    <span class="n">move</span>    <span class="n">s0</span><span class="p">,</span><span class="n">v0</span>
</span><span class='line'><span class="mi">148</span><span class="o">:</span>   <span class="mf">8f</span><span class="n">bc0010</span>    <span class="n">lw</span>  <span class="n">gp</span><span class="p">,</span><span class="mi">16</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
</span><span class='line'><span class="mi">14</span><span class="n">c</span><span class="o">:</span>   <span class="n">afb00044</span>    <span class="n">sw</span>  <span class="n">s0</span><span class="p">,</span><span class="mi">68</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
</span><span class='line'><span class="mi">150</span><span class="o">:</span>   <span class="mo">001067</span><span class="n">c3</span>    <span class="n">sra</span> <span class="n">t4</span><span class="p">,</span><span class="n">s0</span><span class="p">,</span><span class="mh">0x1f</span>
</span><span class='line'><span class="mi">154</span><span class="o">:</span>   <span class="n">afac0040</span>    <span class="n">sw</span>  <span class="n">t4</span><span class="p">,</span><span class="mi">64</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
</span><span class='line'><span class="mi">158</span><span class="o">:</span>   <span class="mf">8f</span><span class="n">ab0044</span>    <span class="n">lw</span>  <span class="n">t3</span><span class="p">,</span><span class="mi">68</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
</span><span class='line'><span class="mi">15</span><span class="n">c</span><span class="o">:</span>   <span class="n">afab0048</span>    <span class="n">sw</span>  <span class="n">t3</span><span class="p">,</span><span class="mi">72</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
</span><span class='line'><span class="mi">160</span><span class="o">:</span>   <span class="mo">00005021</span>    <span class="n">move</span>    <span class="n">t2</span><span class="p">,</span><span class="n">zero</span>
</span><span class='line'><span class="mi">164</span><span class="o">:</span>   <span class="n">afaa004c</span>    <span class="n">sw</span>  <span class="n">t2</span><span class="p">,</span><span class="mi">76</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
</span><span class='line'><span class="mi">168</span><span class="o">:</span>   <span class="mf">8f</span><span class="n">a60048</span>    <span class="n">lw</span>  <span class="n">a2</span><span class="p">,</span><span class="mi">72</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
</span><span class='line'><span class="mi">16</span><span class="n">c</span><span class="o">:</span>   <span class="n">afa20054</span>    <span class="n">sw</span>  <span class="n">v0</span><span class="p">,</span><span class="mi">84</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
</span><span class='line'><span class="mi">170</span><span class="o">:</span>   <span class="mo">000247</span><span class="n">c3</span>    <span class="n">sra</span> <span class="n">t0</span><span class="p">,</span><span class="n">v0</span><span class="p">,</span><span class="mh">0x1f</span>
</span><span class='line'><span class="mi">174</span><span class="o">:</span>   <span class="n">afa80050</span>    <span class="n">sw</span>  <span class="n">t0</span><span class="p">,</span><span class="mi">80</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
</span><span class='line'><span class="mi">178</span><span class="o">:</span>   <span class="mf">8f</span><span class="n">a30054</span>    <span class="n">lw</span>  <span class="n">v1</span><span class="p">,</span><span class="mi">84</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
</span><span class='line'><span class="mi">17</span><span class="n">c</span><span class="o">:</span>   <span class="mf">8f</span><span class="n">a70050</span>    <span class="n">lw</span>  <span class="n">a3</span><span class="p">,</span><span class="mi">80</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
</span><span class='line'><span class="mi">180</span><span class="o">:</span>   <span class="mo">00</span><span class="n">c72025</span>    <span class="n">or</span>  <span class="n">a0</span><span class="p">,</span><span class="n">a2</span><span class="p">,</span><span class="n">a3</span>
</span><span class='line'><span class="mi">184</span><span class="o">:</span>   <span class="n">afa40020</span>    <span class="n">sw</span>  <span class="n">a0</span><span class="p">,</span><span class="mi">32</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
</span><span class='line'><span class="mi">188</span><span class="o">:</span>   <span class="mf">8f</span><span class="n">a5004c</span>    <span class="n">lw</span>  <span class="n">a1</span><span class="p">,</span><span class="mi">76</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
</span><span class='line'><span class="mi">18</span><span class="n">c</span><span class="o">:</span>   <span class="mo">00</span><span class="n">a31025</span>    <span class="n">or</span>  <span class="n">v0</span><span class="p">,</span><span class="n">a1</span><span class="p">,</span><span class="n">v1</span>
</span><span class='line'><span class="mi">190</span><span class="o">:</span>   <span class="n">afa20024</span>    <span class="n">sw</span>  <span class="n">v0</span><span class="p">,</span><span class="mi">36</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
</span><span class='line'><span class="mi">194</span><span class="o">:</span>   <span class="mf">8f</span><span class="n">bf0020</span>    <span class="n">lw</span>  <span class="n">ra</span><span class="p">,</span><span class="mi">32</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
</span><span class='line'><span class="mi">198</span><span class="o">:</span>   <span class="n">afbf005c</span>    <span class="n">sw</span>  <span class="n">ra</span><span class="p">,</span><span class="mi">92</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
</span><span class='line'><span class="mi">19</span><span class="n">c</span><span class="o">:</span>   <span class="n">afbe0058</span>    <span class="n">sw</span>  <span class="n">s8</span><span class="p">,</span><span class="mi">88</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
</span><span class='line'><span class="mi">1</span><span class="n">a0</span><span class="o">:</span>   <span class="mf">8f</span><span class="n">b8005c</span>    <span class="n">lw</span>  <span class="n">t8</span><span class="p">,</span><span class="mi">92</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
</span><span class='line'><span class="mi">1</span><span class="n">a4</span><span class="o">:</span>   <span class="n">afb80018</span>    <span class="n">sw</span>  <span class="n">t8</span><span class="p">,</span><span class="mi">24</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
</span><span class='line'><span class="mi">1</span><span class="n">a8</span><span class="o">:</span>   <span class="mf">8f</span><span class="n">b70024</span>    <span class="n">lw</span>  <span class="n">s7</span><span class="p">,</span><span class="mi">36</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
</span><span class='line'> <span class="mi">1</span><span class="n">ac</span><span class="o">:</span>   <span class="n">afb7001c</span>    <span class="n">sw</span>  <span class="n">s7</span><span class="p">,</span><span class="mi">28</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
</span><span class='line'><span class="mi">1</span><span class="n">b0</span><span class="o">:</span>   <span class="mf">8f</span><span class="n">b50018</span>    <span class="n">lw</span>  <span class="n">s5</span><span class="p">,</span><span class="mi">24</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
</span><span class='line'><span class="mi">1</span><span class="n">b4</span><span class="o">:</span>   <span class="mf">8f</span><span class="n">b6001c</span>    <span class="n">lw</span>  <span class="n">s6</span><span class="p">,</span><span class="mi">28</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
</span><span class='line'><span class="mi">1</span><span class="n">b8</span><span class="o">:</span>   <span class="mf">8f</span><span class="n">a40030</span>    <span class="n">lw</span>  <span class="n">a0</span><span class="p">,</span><span class="mi">48</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
</span><span class='line'><span class="mi">1</span><span class="n">bc</span><span class="o">:</span>   <span class="mo">0015</span><span class="n">a83c</span>    <span class="n">dsll32</span>  <span class="n">s5</span><span class="p">,</span><span class="n">s5</span><span class="p">,</span><span class="mh">0x0</span>
</span><span class='line'><span class="mi">1</span><span class="n">c0</span><span class="o">:</span>   <span class="mo">0016</span><span class="n">b03c</span>    <span class="n">dsll32</span>  <span class="n">s6</span><span class="p">,</span><span class="n">s6</span><span class="p">,</span><span class="mh">0x0</span>
</span><span class='line'><span class="mi">1</span><span class="n">c4</span><span class="o">:</span>   <span class="mo">0016</span><span class="n">b03e</span>    <span class="n">dsrl32</span>  <span class="n">s6</span><span class="p">,</span><span class="n">s6</span><span class="p">,</span><span class="mh">0x0</span>
</span><span class='line'><span class="mi">1</span><span class="n">c8</span><span class="o">:</span>   <span class="mo">02</span><span class="n">b6a825</span>    <span class="n">or</span>  <span class="n">s5</span><span class="p">,</span><span class="n">s5</span><span class="p">,</span><span class="n">s6</span>
</span><span class='line'><span class="mi">1</span><span class="n">cc</span><span class="o">:</span>   <span class="mo">0004203</span><span class="n">c</span>    <span class="n">dsll32</span>  <span class="n">a0</span><span class="p">,</span><span class="n">a0</span><span class="p">,</span><span class="mh">0x0</span>
</span><span class='line'><span class="mi">1</span><span class="n">d0</span><span class="o">:</span>   <span class="mo">0004203</span><span class="n">e</span>    <span class="n">dsrl32</span>  <span class="n">a0</span><span class="p">,</span><span class="n">a0</span><span class="p">,</span><span class="mh">0x0</span>
</span><span class='line'><span class="mi">1</span><span class="n">d4</span><span class="o">:</span>   <span class="n">fc950000</span>    <span class="n">sd</span>  <span class="n">s5</span><span class="p">,</span><span class="mi">0</span><span class="p">(</span><span class="n">a0</span><span class="p">)</span>
</span><span class='line'><span class="mi">1</span><span class="n">d8</span><span class="o">:</span>   <span class="mf">8f</span><span class="mi">990000</span>    <span class="n">lw</span>  <span class="n">t9</span><span class="p">,</span><span class="mi">0</span><span class="p">(</span><span class="n">gp</span><span class="p">)</span>
</span><span class='line'><span class="mi">1</span><span class="n">dc</span><span class="o">:</span>   <span class="mf">0320f</span><span class="mi">809</span>    <span class="n">jalr</span>    <span class="n">t9</span>
</span><span class='line'><span class="mf">1e0</span><span class="o">:</span>   <span class="mo">0000</span><span class="mi">8021</span>    <span class="n">move</span>    <span class="n">s0</span><span class="p">,</span><span class="n">zero</span>
</span><span class='line'><span class="mf">1e4</span><span class="o">:</span>   <span class="mf">8f</span><span class="n">bc0010</span>    <span class="n">lw</span>  <span class="n">gp</span><span class="p">,</span><span class="mi">16</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
</span><span class='line'><span class="mf">1e8</span><span class="o">:</span>   <span class="mf">8f</span><span class="mi">990000</span>    <span class="n">lw</span>  <span class="n">t9</span><span class="p">,</span><span class="mi">0</span><span class="p">(</span><span class="n">gp</span><span class="p">)</span>
</span><span class='line'><span class="mi">1</span><span class="n">ec</span><span class="o">:</span>   <span class="mf">0320f</span><span class="mi">809</span>    <span class="n">jalr</span>    <span class="n">t9</span>
</span><span class='line'><span class="mf">1f</span><span class="mi">0</span><span class="o">:</span>   <span class="mo">0040</span><span class="mi">9821</span>    <span class="n">move</span>    <span class="n">s3</span><span class="p">,</span><span class="n">v0</span>
</span><span class='line'><span class="mf">1f</span><span class="mi">4</span><span class="o">:</span>   <span class="mf">8f</span><span class="n">bc0010</span>    <span class="n">lw</span>  <span class="n">gp</span><span class="p">,</span><span class="mi">16</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
</span><span class='line'><span class="mf">1f</span><span class="mi">8</span><span class="o">:</span>   <span class="n">afb30064</span>    <span class="n">sw</span>  <span class="n">s3</span><span class="p">,</span><span class="mi">100</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
</span><span class='line'><span class="mf">1f</span><span class="n">c</span><span class="o">:</span>   <span class="mo">0013</span><span class="mi">97</span><span class="n">c3</span>    <span class="n">sra</span> <span class="n">s2</span><span class="p">,</span><span class="n">s3</span><span class="p">,</span><span class="mh">0x1f</span>
</span><span class='line'><span class="mi">200</span><span class="o">:</span>   <span class="n">afb20060</span>    <span class="n">sw</span>  <span class="n">s2</span><span class="p">,</span><span class="mi">96</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
</span><span class='line'><span class="mi">204</span><span class="o">:</span>   <span class="mf">8f</span><span class="n">b10064</span>    <span class="n">lw</span>  <span class="n">s1</span><span class="p">,</span><span class="mi">100</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
</span><span class='line'><span class="mi">208</span><span class="o">:</span>   <span class="n">afb10068</span>    <span class="n">sw</span>  <span class="n">s1</span><span class="p">,</span><span class="mi">104</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
</span><span class='line'><span class="mi">20</span><span class="n">c</span><span class="o">:</span>   <span class="n">afb0006c</span>    <span class="n">sw</span>  <span class="n">s0</span><span class="p">,</span><span class="mi">108</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
</span><span class='line'><span class="mi">210</span><span class="o">:</span>   <span class="mf">8f</span><span class="n">ac0068</span>    <span class="n">lw</span>  <span class="n">t4</span><span class="p">,</span><span class="mi">104</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
</span><span class='line'><span class="mi">214</span><span class="o">:</span>   <span class="n">afa20074</span>    <span class="n">sw</span>  <span class="n">v0</span><span class="p">,</span><span class="mi">116</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
</span><span class='line'><span class="mi">218</span><span class="o">:</span>   <span class="mo">000277</span><span class="n">c3</span>    <span class="n">sra</span> <span class="n">t6</span><span class="p">,</span><span class="n">v0</span><span class="p">,</span><span class="mh">0x1f</span>
</span><span class='line'><span class="mi">21</span><span class="n">c</span><span class="o">:</span>   <span class="n">afae0070</span>    <span class="n">sw</span>  <span class="n">t6</span><span class="p">,</span><span class="mi">112</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
</span><span class='line'><span class="mi">220</span><span class="o">:</span>   <span class="mf">8f</span><span class="n">aa0074</span>    <span class="n">lw</span>  <span class="n">t2</span><span class="p">,</span><span class="mi">116</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
</span><span class='line'><span class="mi">224</span><span class="o">:</span>   <span class="mf">8f</span><span class="n">ad0070</span>    <span class="n">lw</span>  <span class="n">t5</span><span class="p">,</span><span class="mi">112</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
</span><span class='line'><span class="mi">228</span><span class="o">:</span>   <span class="mo">01</span><span class="mi">8</span><span class="n">d5825</span>    <span class="n">or</span>  <span class="n">t3</span><span class="p">,</span><span class="n">t4</span><span class="p">,</span><span class="n">t5</span>
</span><span class='line'> <span class="mi">22</span><span class="n">c</span><span class="o">:</span>   <span class="n">afab0038</span>    <span class="n">sw</span>  <span class="n">t3</span><span class="p">,</span><span class="mi">56</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
</span><span class='line'><span class="mi">230</span><span class="o">:</span>   <span class="mf">8f</span><span class="n">a9006c</span>    <span class="n">lw</span>  <span class="n">t1</span><span class="p">,</span><span class="mi">108</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
</span><span class='line'><span class="mi">234</span><span class="o">:</span>   <span class="mo">012</span><span class="n">a4025</span>    <span class="n">or</span>  <span class="n">t0</span><span class="p">,</span><span class="n">t1</span><span class="p">,</span><span class="n">t2</span>
</span><span class='line'><span class="mi">238</span><span class="o">:</span>   <span class="n">afa8003c</span>    <span class="n">sw</span>  <span class="n">t0</span><span class="p">,</span><span class="mi">60</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
</span><span class='line'><span class="mi">23</span><span class="n">c</span><span class="o">:</span>   <span class="mf">8f</span><span class="n">a70038</span>    <span class="n">lw</span>  <span class="n">a3</span><span class="p">,</span><span class="mi">56</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
</span><span class='line'><span class="mi">240</span><span class="o">:</span>   <span class="n">afa7007c</span>    <span class="n">sw</span>  <span class="n">a3</span><span class="p">,</span><span class="mi">124</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
</span><span class='line'><span class="mi">244</span><span class="o">:</span>   <span class="mo">00003021</span>    <span class="n">move</span>    <span class="n">a2</span><span class="p">,</span><span class="n">zero</span>
</span><span class='line'><span class="mi">248</span><span class="o">:</span>   <span class="n">afa60078</span>    <span class="n">sw</span>  <span class="n">a2</span><span class="p">,</span><span class="mi">120</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
</span><span class='line'><span class="mi">24</span><span class="n">c</span><span class="o">:</span>   <span class="mf">8f</span><span class="n">a4007c</span>    <span class="n">lw</span>  <span class="n">a0</span><span class="p">,</span><span class="mi">124</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
</span><span class='line'><span class="mi">250</span><span class="o">:</span>   <span class="n">afa40018</span>    <span class="n">sw</span>  <span class="n">a0</span><span class="p">,</span><span class="mi">24</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
</span><span class='line'><span class="mi">254</span><span class="o">:</span>   <span class="mf">8f</span><span class="n">a5003c</span>    <span class="n">lw</span>  <span class="n">a1</span><span class="p">,</span><span class="mi">60</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
</span><span class='line'><span class="mi">258</span><span class="o">:</span>   <span class="n">afa5001c</span>    <span class="n">sw</span>  <span class="n">a1</span><span class="p">,</span><span class="mi">28</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
</span><span class='line'><span class="mi">25</span><span class="n">c</span><span class="o">:</span>   <span class="mf">8f</span><span class="n">a30018</span>    <span class="n">lw</span>  <span class="n">v1</span><span class="p">,</span><span class="mi">24</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
</span><span class='line'><span class="mi">260</span><span class="o">:</span>   <span class="mf">8f</span><span class="n">a2001c</span>    <span class="n">lw</span>  <span class="n">v0</span><span class="p">,</span><span class="mi">28</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
</span><span class='line'><span class="mi">264</span><span class="o">:</span>   <span class="mf">8f</span><span class="n">a40030</span>    <span class="n">lw</span>  <span class="n">a0</span><span class="p">,</span><span class="mi">48</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
</span><span class='line'><span class="mi">268</span><span class="o">:</span>   <span class="mo">00031</span><span class="mi">83</span><span class="n">c</span>    <span class="n">dsll32</span>  <span class="n">v1</span><span class="p">,</span><span class="n">v1</span><span class="p">,</span><span class="mh">0x0</span>
</span><span class='line'><span class="mi">26</span><span class="n">c</span><span class="o">:</span>   <span class="mo">0002103</span><span class="n">c</span>    <span class="n">dsll32</span>  <span class="n">v0</span><span class="p">,</span><span class="n">v0</span><span class="p">,</span><span class="mh">0x0</span>
</span><span class='line'><span class="mi">270</span><span class="o">:</span>   <span class="mo">0002103</span><span class="n">e</span>    <span class="n">dsrl32</span>  <span class="n">v0</span><span class="p">,</span><span class="n">v0</span><span class="p">,</span><span class="mh">0x0</span>
</span><span class='line'><span class="mi">274</span><span class="o">:</span>   <span class="mo">00621</span><span class="mi">825</span>    <span class="n">or</span>  <span class="n">v1</span><span class="p">,</span><span class="n">v1</span><span class="p">,</span><span class="n">v0</span>
</span><span class='line'><span class="mi">278</span><span class="o">:</span>   <span class="mo">0004203</span><span class="n">c</span>    <span class="n">dsll32</span>  <span class="n">a0</span><span class="p">,</span><span class="n">a0</span><span class="p">,</span><span class="mh">0x0</span>
</span><span class='line'><span class="mi">27</span><span class="n">c</span><span class="o">:</span>   <span class="mo">0004203</span><span class="n">e</span>    <span class="n">dsrl32</span>  <span class="n">a0</span><span class="p">,</span><span class="n">a0</span><span class="p">,</span><span class="mh">0x0</span>
</span><span class='line'><span class="mi">280</span><span class="o">:</span>   <span class="n">fc830000</span>    <span class="n">sd</span>  <span class="n">v1</span><span class="p">,</span><span class="mi">0</span><span class="p">(</span><span class="n">a0</span><span class="p">)</span>
</span><span class='line'><span class="mi">284</span><span class="o">:</span>   <span class="mo">00001021</span>    <span class="n">move</span>    <span class="n">v0</span><span class="p">,</span><span class="n">zero</span>
</span><span class='line'><span class="mi">288</span><span class="o">:</span>   <span class="mf">8f</span><span class="n">bf00a4</span>    <span class="n">lw</span>  <span class="n">ra</span><span class="p">,</span><span class="mi">164</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
</span><span class='line'><span class="mi">28</span><span class="n">c</span><span class="o">:</span>   <span class="mf">8f</span><span class="n">be00a0</span>    <span class="n">lw</span>  <span class="n">s8</span><span class="p">,</span><span class="mi">160</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
</span><span class='line'><span class="mi">290</span><span class="o">:</span>   <span class="mf">8f</span><span class="n">b7009c</span>    <span class="n">lw</span>  <span class="n">s7</span><span class="p">,</span><span class="mi">156</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
</span><span class='line'><span class="mi">294</span><span class="o">:</span>   <span class="mf">8f</span><span class="n">b60098</span>    <span class="n">lw</span>  <span class="n">s6</span><span class="p">,</span><span class="mi">152</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
</span><span class='line'><span class="mi">298</span><span class="o">:</span>   <span class="mf">8f</span><span class="n">b50094</span>    <span class="n">lw</span>  <span class="n">s5</span><span class="p">,</span><span class="mi">148</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
</span><span class='line'><span class="mi">29</span><span class="n">c</span><span class="o">:</span>   <span class="mf">8f</span><span class="n">b40090</span>    <span class="n">lw</span>  <span class="n">s4</span><span class="p">,</span><span class="mi">144</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
</span><span class='line'><span class="mi">2</span><span class="n">a0</span><span class="o">:</span>   <span class="mf">8f</span><span class="n">b3008c</span>    <span class="n">lw</span>  <span class="n">s3</span><span class="p">,</span><span class="mi">140</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
</span><span class='line'><span class="mi">2</span><span class="n">a4</span><span class="o">:</span>   <span class="mf">8f</span><span class="n">b20088</span>    <span class="n">lw</span>  <span class="n">s2</span><span class="p">,</span><span class="mi">136</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
</span><span class='line'><span class="mi">2</span><span class="n">a8</span><span class="o">:</span>   <span class="mf">8f</span><span class="n">b10084</span>    <span class="n">lw</span>  <span class="n">s1</span><span class="p">,</span><span class="mi">132</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
</span><span class='line'><span class="mi">2</span><span class="n">ac</span><span class="o">:</span>   <span class="mf">8f</span><span class="n">b00080</span>    <span class="n">lw</span>  <span class="n">s0</span><span class="p">,</span><span class="mi">128</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
</span><span class='line'><span class="mi">2</span><span class="n">b0</span><span class="o">:</span>   <span class="mf">03e00008</span>    <span class="n">jr</span>  <span class="n">ra</span>
</span><span class='line'><span class="mi">2</span><span class="n">b4</span><span class="o">:</span>   <span class="mi">27</span><span class="n">bd00a8</span>    <span class="n">addiu</span>   <span class="n">sp</span><span class="p">,</span><span class="n">sp</span><span class="p">,</span><span class="mi">168</span>
</span></code></pre></td></tr></table></div></figure>


<p>可以看到，栈空间一下子由56增加到了168，即增加了112字节这么大的空间！</p>

<p>我们就来分析下这112字节的空间是怎么产生的。</p>

<ul>
<li>从汇编代码来看，变量val_high和val_lo仍然是存储在24(sp)和28(sp)这部分内存空间。但是同时也生成了大量的临时变量。  <br/>
比如i为1时被展开的循环体：</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='c'><span class='line'><span class="nl">f4:</span>   <span class="mf">8f</span><span class="n">b1002c</span>    <span class="n">lw</span>  <span class="n">s1</span><span class="p">,</span><span class="mi">44</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
</span><span class='line'>  <span class="n">f8</span><span class="o">:</span>   <span class="mf">8f</span><span class="n">b30028</span>    <span class="n">lw</span>  <span class="n">s3</span><span class="p">,</span><span class="mi">40</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
</span><span class='line'>  <span class="n">fc</span><span class="o">:</span>   <span class="n">afb30018</span>    <span class="n">sw</span>  <span class="n">s3</span><span class="p">,</span><span class="mi">24</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
</span><span class='line'><span class="mi">100</span><span class="o">:</span>   <span class="n">afb1001c</span>    <span class="n">sw</span>  <span class="n">s1</span><span class="p">,</span><span class="mi">28</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>可以看到至少新增了44(sp)和40(sp)这两个临时变量。  <br/>
i为2时被展开的循环体：</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='c'><span class='line'><span class="mi">1</span><span class="n">a0</span><span class="o">:</span>   <span class="mf">8f</span><span class="n">b8005c</span>    <span class="n">lw</span>  <span class="n">t8</span><span class="p">,</span><span class="mi">92</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
</span><span class='line'><span class="mi">1</span><span class="n">a4</span><span class="o">:</span>   <span class="n">afb80018</span>    <span class="n">sw</span>  <span class="n">t8</span><span class="p">,</span><span class="mi">24</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
</span><span class='line'><span class="mi">1</span><span class="n">a8</span><span class="o">:</span>   <span class="mf">8f</span><span class="n">b70024</span>    <span class="n">lw</span>  <span class="n">s7</span><span class="p">,</span><span class="mi">36</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
</span><span class='line'> <span class="mi">1</span><span class="n">ac</span><span class="o">:</span>   <span class="n">afb7001c</span>    <span class="n">sw</span>  <span class="n">s7</span><span class="p">,</span><span class="mi">28</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p> 至少新增了36(sp)和92(sp)这两个临时变量。   <br/>
i为3时被展开的循环体：</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='c'><span class='line'><span class="mi">24</span><span class="n">c</span><span class="o">:</span>   <span class="mf">8f</span><span class="n">a4007c</span>    <span class="n">lw</span>  <span class="n">a0</span><span class="p">,</span><span class="mi">124</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
</span><span class='line'><span class="mi">250</span><span class="o">:</span>   <span class="n">afa40018</span>    <span class="n">sw</span>  <span class="n">a0</span><span class="p">,</span><span class="mi">24</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
</span><span class='line'><span class="mi">254</span><span class="o">:</span>   <span class="mf">8f</span><span class="n">a5003c</span>    <span class="n">lw</span>  <span class="n">a1</span><span class="p">,</span><span class="mi">60</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
</span><span class='line'><span class="mi">258</span><span class="o">:</span>   <span class="n">afa5001c</span>    <span class="n">sw</span>  <span class="n">a1</span><span class="p">,</span><span class="mi">28</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>至少新增了60(sp)和124(sp)这两个临时变量。   <br/>
注意这里不是参数入栈和出栈，因为这里是inline，不是函数调用。增加的这六个临时变量都是因为<code>atomic_write64</code>这个inline函数里定义了局部变量，他们其实是为了服务于那两个局部变量。</p>

<ul>
<li>再来看变量x</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='c'><span class='line'><span class="mi">140</span><span class="o">:</span>   <span class="mf">0320f</span><span class="mi">809</span>    <span class="n">jalr</span>    <span class="n">t9</span>
</span><span class='line'><span class="mi">144</span><span class="o">:</span>   <span class="mo">0040</span><span class="mi">8021</span>    <span class="n">move</span>    <span class="n">s0</span><span class="p">,</span><span class="n">v0</span>
</span><span class='line'><span class="mi">148</span><span class="o">:</span>   <span class="mf">8f</span><span class="n">bc0010</span>    <span class="n">lw</span>  <span class="n">gp</span><span class="p">,</span><span class="mi">16</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
</span><span class='line'><span class="mi">14</span><span class="n">c</span><span class="o">:</span>   <span class="n">afb00044</span>    <span class="n">sw</span>  <span class="n">s0</span><span class="p">,</span><span class="mi">68</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>可以看到这里新增加了一个临时变量68(sp)用来存储<code>random()</code>函数的返回值。  <br/>
这也是在前面使用<code>4:   afa40044    sw  a0,68(sp)</code>来初始化该临时变量的原因。</p>

<ul>
<li>循环展开后i值不同的循环体使用不同的$sn寄存器   <br/>
用到这些寄存器，就需要在函数开始将该寄存器压栈，然后在函数结束时出栈。</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='c'><span class='line'>  <span class="mi">14</span><span class="o">:</span>   <span class="n">afbe00a0</span>    <span class="n">sw</span>  <span class="n">s8</span><span class="p">,</span><span class="mi">160</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
</span><span class='line'>  <span class="mi">18</span><span class="o">:</span>   <span class="n">afb7009c</span>    <span class="n">sw</span>  <span class="n">s7</span><span class="p">,</span><span class="mi">156</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
</span><span class='line'>  <span class="mi">1</span><span class="n">c</span><span class="o">:</span>   <span class="n">afb60098</span>    <span class="n">sw</span>  <span class="n">s6</span><span class="p">,</span><span class="mi">152</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
</span><span class='line'>  <span class="mi">20</span><span class="o">:</span>   <span class="n">afb50094</span>    <span class="n">sw</span>  <span class="n">s5</span><span class="p">,</span><span class="mi">148</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
</span><span class='line'>  <span class="mi">24</span><span class="o">:</span>   <span class="n">afb40090</span>    <span class="n">sw</span>  <span class="n">s4</span><span class="p">,</span><span class="mi">144</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
</span><span class='line'>  <span class="mi">28</span><span class="o">:</span>   <span class="n">afb3008c</span>    <span class="n">sw</span>  <span class="n">s3</span><span class="p">,</span><span class="mi">140</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
</span><span class='line'><span class="err">…</span>
</span><span class='line'><span class="mi">28</span><span class="n">c</span><span class="o">:</span>   <span class="mf">8f</span><span class="n">be00a0</span>    <span class="n">lw</span>  <span class="n">s8</span><span class="p">,</span><span class="mi">160</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
</span><span class='line'><span class="mi">290</span><span class="o">:</span>   <span class="mf">8f</span><span class="n">b7009c</span>    <span class="n">lw</span>  <span class="n">s7</span><span class="p">,</span><span class="mi">156</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
</span><span class='line'><span class="mi">294</span><span class="o">:</span>   <span class="mf">8f</span><span class="n">b60098</span>    <span class="n">lw</span>  <span class="n">s6</span><span class="p">,</span><span class="mi">152</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
</span><span class='line'><span class="mi">298</span><span class="o">:</span>   <span class="mf">8f</span><span class="n">b50094</span>    <span class="n">lw</span>  <span class="n">s5</span><span class="p">,</span><span class="mi">148</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
</span><span class='line'><span class="mi">29</span><span class="n">c</span><span class="o">:</span>   <span class="mf">8f</span><span class="n">b40090</span>    <span class="n">lw</span>  <span class="n">s4</span><span class="p">,</span><span class="mi">144</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>新增的这些临时变量和对过多寄存器的使用增加了栈空间，而且入栈出栈也很消耗CPU cycles，因为这涉及到读写内存。</p>

<h2>问题初步结论</h2>

<p>由此我们可以得到一个初步结论，在unroll-loops的过程中，如果产生了额外的内存变量，那么unroll loops就极有可能对性能造成伤害。</p>

<ul>
<li>首先这些额外的临时变量会存储在内存里，执行指令时就会有入栈和出栈，这些多出来的入栈和出栈的指令，就会导致I-cache miss的增大</li>
<li>这些变量会占用D-cache空间，从而又导致D-cache miss的增大</li>
</ul>


<p>关键路径上I-cache和D-cache miss的增大，自然会导致性能的下降, 这是因为不同存储层级的访问速度是不一样的。</p>

<p>存储层级的访问速度从快到慢的排序如下：</p>

<ul>
<li>寄存器／运算器</li>
<li>L1 D-cache/ L1 I-cache</li>
<li>L2 cache</li>
<li>L3 cache (maybe)</li>
<li>memory</li>
<li>..</li>
</ul>


<p>关于存储层级上的各个延迟， 具体可参考<a href="https://gist.github.com/jboner/2841832">Latency Numbers Every Programmer Should Know</a></p>

<h2>循环展开的意义</h2>

<p>以简化的代码来解释。</p>

<h4>原始代码</h4>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='c'><span class='line'><span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">N</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="n">sum</span> <span class="o">+=</span> <span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<h4>循环展开后的代码</h4>

<p>假设N是4的倍数（这个不是关键）。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='c'><span class='line'><span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">N</span><span class="p">;</span> <span class="n">i</span> <span class="o">+=</span> <span class="mi">4</span> <span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="n">sum</span> <span class="o">+=</span> <span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">a</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">a</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="n">a</span> <span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">3</span><span class="p">];</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>如上代码所示，循环展开后，在一次迭代中完成了4个数组元素的运算。      <br/>
我们知道，在编译时以常量索引的数组元素通常位于寄存器中，但是以变量索引的数组元素只能放在栈空间。所以a[i]..a[i + 3]这四个数组元素要首先被从栈（内存）中读取到寄存器中，这就带来了更多的寄存器消耗；同时，相比于展开前，展开后的代码需要一次性的消耗4个加法器，即这会消耗更多的运算器。通过消耗更多的寄存器和运算器，节省了对内存的访问次数，从而提升了速度。       <br/>
更加深入的解释是，对于每份来自内存的数据而言，必须被若干次调用后才能节省内存带宽。即通过增加运算器来提升内存带宽。对于intel CPU而言，以及ARM／MIPS 这种RSIC CPU而言，设计的都是内存带宽过剩但是运算器不足。</p>

<p>对于循环展开而言，如果展开过度，就会导致运算器／寄存器不够用，这些数据和指令就被迫掉入L1 cache，cache的大小不够用，就会继续掉入内存。对于存储层级而言，每次数据被迫掉入下一个存储阶层，带宽大概率要减半或者更多了。</p>

<p>所以展开的次数多少最合适，是有CPU的运算器／寄存器来决定的。</p>

<p>另外，适度展开如果变成SIMD，就会变成数据并行，但是这跟结论无关。</p>

<p>继续来分析gcc的unroll loops的特性。以下的分析基于gcc的源码loop-unroll.c 。</p>

<h2>gcc的unroll loops</h2>

<p>由于这时TIMES仅为3，gcc可以将其完全展开，即peel_loop_completely，展开方式如下：</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='c'><span class='line'><span class="cm">/* </span>
</span><span class='line'><span class="cm">   Peel all iterations of LOOP, remove exit edges and cancel the loop</span>
</span><span class='line'><span class="cm">   completely.  The transformation done:</span>
</span><span class='line'><span class="cm">*/</span>
</span><span class='line'>   <span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
</span><span class='line'>     <span class="n">body</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// 展开为</span>
</span><span class='line'>   <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'>   <span class="n">body</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">;</span>
</span><span class='line'>   <span class="n">body</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">;</span>
</span><span class='line'>   <span class="n">body</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">;</span>
</span></code></pre></td></tr></table></div></figure>


<p>如果将TIMES增大到100，可以发现gcc并不会将循环体展开100次。循环展开多少次最好，在gcc unroll loops的设计者看来也是一个很难的问题，</p>

<blockquote><p>A great problem is that we don&rsquo;t have a good way how to determine how many times we should unroll the loop; the experiments I have made showed that this choice may affect performance in order of several %.</p></blockquote>

<p>因而unroll loops的设计着就定义了一些parameter来由程序员自行定义unroll规则。  <br/>
这些参数有max-unrolled-insns，max-unroll-times，max-peeled-insns和max-peel-times等。用法大致如&mdash;param max-unroll-times=N，如果在使能funroll-loops或者fpeel-loops（如果使能了funroll-loops会同时使能fpeel-loops）后没有设置这些参数，就会使用gcc的默认值，具体参考params.def这个文件。 这些参数的具体含义可以去查阅gcc manual，不再赘述。只说下peel和unroll的区别，从英语语义上来讲，peel是剥离，unroll是摊开，在这里也是这个含义，peel是指从循环中给剥离出去，unroll则是仍然在循环体内。我们可以通过gcc的source code来看下这两者的区别。</p>

<p>gcc unroll-loops的入口函数是<code>rtl_unroll_and_peel_loops</code>，在这里它会去检查funroll-loops,fpeel-loops,funroll-all-loops这些开关。然后就会调用unroll loops的主要函数体<code>unroll_and_peel_loops</code>。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class='c'><span class='line'> <span class="n">unroll_and_peel_loops</span>
</span><span class='line'>        <span class="cm">/* First perform complete loop peeling (it is almost surely a win,</span>
</span><span class='line'><span class="cm">           and affects parameters for further decision a lot).  */</span>
</span><span class='line'>        <span class="n">peel_loops_completely</span> <span class="p">(</span><span class="n">flags</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>        <span class="cm">/* Now decide rest of unrolling and peeling.  */</span>
</span><span class='line'>        <span class="n">decide_unrolling_and_peeling</span> <span class="p">(</span><span class="n">flags</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>          <span class="cm">/* Scan the loops, inner ones first.  */</span>
</span><span class='line'>        <span class="n">FOR_EACH_LOOP</span> <span class="p">(</span><span class="n">loop</span><span class="p">,</span> <span class="n">LI_FROM_INNERMOST</span><span class="p">)</span>
</span><span class='line'>         <span class="p">{</span>
</span><span class='line'>              <span class="p">...</span>
</span><span class='line'>         <span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>可以看到它首先做的就是尝试peel completely，如果不行，就再去选择unroll/peel策略，最后从最内侧循环开始unroll。 举个简单的例子，</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class='c'><span class='line'>   <span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">102</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
</span><span class='line'>     <span class="n">body</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="c1">//展开为</span>
</span><span class='line'>   <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'>   <span class="n">body</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">;</span>
</span><span class='line'>   <span class="n">body</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">;</span>
</span><span class='line'>   <span class="k">while</span> <span class="p">(</span><span class="n">i</span> <span class="o">&lt;</span> <span class="mi">102</span><span class="p">)</span>
</span><span class='line'>     <span class="p">{</span>
</span><span class='line'>       <span class="n">body</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">;</span>
</span><span class='line'>       <span class="n">body</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">;</span>
</span><span class='line'>       <span class="n">body</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">;</span>
</span><span class='line'>       <span class="n">body</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">;</span>
</span><span class='line'>     <span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>前两个body就是peel，后面while循环体内就是unroll。</p>

<p>总之就是，使用gcc的unroll需谨慎，如果循环次数在编译阶段就确定的，完全可以手动的展开，而不用gcc的unroll，当然展开的次数也是一个经验值，需要根据具体情况来定。对于运行时才能决定循环次数的，gcc也可以将其展开，展开方法大致如下：</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
</pre></td><td class='code'><pre><code class='c'><span class='line'>   <span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
</span><span class='line'>     <span class="n">body</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>   <span class="c1">// 展开为： </span>
</span><span class='line'>   <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'>   <span class="n">mod</span> <span class="o">=</span> <span class="n">n</span> <span class="o">%</span> <span class="mi">4</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>   <span class="k">switch</span> <span class="p">(</span><span class="n">mod</span><span class="p">)</span>
</span><span class='line'>     <span class="p">{</span>
</span><span class='line'>       <span class="k">case</span> <span class="mi">3</span>:
</span><span class='line'>         <span class="n">body</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">;</span>
</span><span class='line'>       <span class="k">case</span> <span class="mi">2</span>:
</span><span class='line'>         <span class="n">body</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">;</span>
</span><span class='line'>       <span class="k">case</span> <span class="mi">1</span>:
</span><span class='line'>         <span class="n">body</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">;</span>
</span><span class='line'>       <span class="k">case</span> <span class="mi">0</span>: <span class="p">;</span>
</span><span class='line'>     <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>   <span class="k">while</span> <span class="p">(</span><span class="n">i</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">)</span>
</span><span class='line'>     <span class="p">{</span>
</span><span class='line'>       <span class="n">body</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">;</span>
</span><span class='line'>       <span class="n">body</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">;</span>
</span><span class='line'>       <span class="n">body</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">;</span>
</span><span class='line'>       <span class="n">body</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">;</span>
</span><span class='line'>     <span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>另外再说一句，unroll loops要在critical path才能体现出价值来，对于non-critical path，就不应该做unroll loops了。这也是gcc的funroll-loops的一个不足之处，它不知道哪里是critical哪里non-critical，对它而言代码是平等的（程序员主动告知编译器的例外，比如likely/unlikely），它会一视同仁的把所有该展开的都展开。也许编程语言日后的发展方向会是，根据运行时的情况来自动的调整可执行文件的布局，从而每执行一次就可以优化一次来让程序越来越快[3].</p>

<h2>Ref.</h2>

<ul>
<li>MIPS支持3种ABI：O32/N32/N64,O32/N32的数据模型是ILP32，而N64是LP64，N32和O32的区别是N32的寄存器是64bit而O32的是32bit，N32使用64bits寄存器就要求栈要以8字节对齐。具体见<a href="http://math-atlas.sourceforge.net/devel/assembly/007-2816-005.pdf">MIPS ABI</a></li>
<li>如果返回值是64bits,就会用到$v0和$v1这两个寄存器。对于一些高级编程语言比如Ruby，它可以有多个返回值，不过它实际上是返回的一个数组，数组里面有多个值，即本质上还是返回一个值。</li>
<li>支持元编程的语言，比如Ruby，可以在运行时来修改代码，但是它不是来调整代码段的布局。</li>
<li><a href="https://www.douban.com/note/575214110/">并行有五种</a></li>
</ul>

</div>


<!--
<div class="meta">
	<div class="date">








  


<time datetime="2014-11-26T21:58:59+08:00" pubdate data-updated="true">Nov 26<span>th</span>, 2014</time></div>
	
	<div class="comments"><a href="#disqus_thread">Comments</a></div>
	
</div>
--!>
</article>

	<div class="share">
	<div class="addthis_toolbox addthis_default_style ">
		
		
		
		
	</div>
	
</div>



<section id="comment">
    <h2 class="title">Comments</h2>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
</section>
</div>
	<footer id="footer" class="inner">Copyright &copy; 2017

    Yafang Shao

</footer>
	<script src="/javascripts/slash.js"></script>
<script src="/javascripts/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
	$('.fancybox').fancybox();
})(jQuery);
</script> <!-- Delete or comment this line to disable Fancybox -->


<script type="text/javascript">
      var disqus_shortname = 'laoar';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://laoar.github.io/blog/2014/11/26/loop-unrolling/';
        var disqus_url = 'http://laoar.github.io/blog/2014/11/26/loop-unrolling/';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//go.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>





</body>
</html>
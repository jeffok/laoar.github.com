
<!DOCTYPE HTML>
<html>
<head>
	<meta charset="utf-8">
	<title>One Man's Yammer</title>
	<meta name="author" content="Yafang Shao">

	
	<meta name="description" content="This article was automatically generated via Booklist, which is wrote in Ruby by @laoar. It&#8217;s open to everyone. Feel free to use it. Below are &hellip;">
	
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

	<link href="" rel="alternate" title="One Man's Yammer" type="application/atom+xml">
	<link rel="canonical" href="">
	<link href="/favicon.png" rel="shortcut icon">
	<link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
	<!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
	<script async="true" src="//ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
	
</head>


<body>
	<header id="header" class="inner"><h1><a href="/">One Man's Yammer</a></h1>
<nav id="main-nav"><ul class="main">
	<li><a href="/read">BookWall</a></li>
</ul>
</nav>
<nav id="mobile-nav"> <ul class="main">
	<li><a href="/read">BookWall</a></li>
</ul>
 </nav>
<!--	<div class="menu"> --!>
		<!--<a class="button">Menu</a>
		<div class="container"><ul class="main">
	<li><a href="/read">BookWall</a></li>
</ul>
</div>--!>
	<!--</div>--!>
<!--</nav>--!>
<!-- @yfshao
	<div class="alignright search">
		<a class="button"></a>
		<div class="container">
			<form action="false" method="get">
				<input type="text" name="q" results="0">
				<input type="hidden" name="q" value="site:laoar.github.io">
			</form>
		</div>
	</div>
</nav>
--!>
<!--
<nav id="sub-nav" class="alignright">
	<div class="social">
		
		
		
		
    
		
		
		
		
		
    
	</div>
	<form class="search" action="false" method="get">
		<input class="alignright" type="text" name="q" results="0">
		<input type="hidden" name="q" value="site:laoar.github.io">
	</form>
</nav>
--!>
<!----!>
</header>
	
		
	
	<div id="content" class="inner"><meta content="width=device-width,user-scalable=no" name="viewport">





    
    
	<section class="archives">
		<h1 class="year">2014</h1>

		<article>
    		<a href="/blog/2014/12/27/reading-2014/">My Reading in 2014</a>
		</article>
    




		<article>
    		<a href="/blog/2014/11/26/loop-unrolling/">loop unrolling : may or may not make the program run faster</a>
		</article>
    




		<article>
    		<a href="/blog/2014/08/31/ruby/">Ruby, 我的书有点乱</a>
		</article>
    




		<article>
    		<a href="/blog/2014/07/13/jin-ji-de-ccheng-xu-yuan/">进击的C程序员, Ruby, 豆瓣读书</a>
		</article>
    




		<article>
    		<a href="/blog/2014/06/24/ldscript/">性能优化，要懂点编译原理</a>
		</article>
    




		<article>
    		<a href="/blog/2014/05/25/hello-github/">Hello Github!</a>
		</article>
    




		<article>
    		<a href="/blogs/501">性能优化：一些很有意思的尝试</a>
		</article>
    




		<article>
    		<a href="/blogs/482">性能优化，从linux内核里来学习，和一个例子</a>
		</article>
    




		<article>
    		<a href="/blogs/466">关于struct hack, 优雅的FreeBSD</a>
		</article>
    




		<article>
    		<a href="/blogs/455">性能优化,关于Profiling</a>
		</article>
    




		<article>
    		<a href="/blogs/435">为什么发送segment fault信号的进程总是PID0 ？</a>
		</article>
    




		<article>
    		<a href="/blogs/422">我的2013</a>
		</article>
    




    
    
    
	<section class="archives">
		<h1 class="year">2013</h1>

		<article>
    		<a href="/blogs/402">MacOS:mdworker曾让我很不爽</a>
		</article>
    




		<article>
    		<a href="/blogs/393">我为什么从华为离职</a>
		</article>
    




		<article>
    		<a href="/blogs/367">三言两语聊Kernel：linux kernel和bsd kernel实现doubly-linked list的差异</a>
		</article>
    




		<article>
    		<a href="/blogs/361">三言两语聊Kernel：atomic </a>
		</article>
    




		<article>
    		<a href="/blogs/338">三言两语聊Kernel：该怎么理解Terminal</a>
		</article>
    




		<article>
    		<a href="/blogs/325">三言两语聊Kernel：从Linux到FreeBSD</a>
		</article>
    




		<article>
    		<a href="/blogs/316">在高铁上聊Kernel：what is the fucking ABI(程序二进制接口)?</a>
		</article>
    




		<article>
    		<a href="/blogs/299">三言两语聊Kernel：Busy Waiting or Sleeping？</a>
		</article>
    




		<article>
    		<a href="/blogs/289">三言两语聊Kernel：do{…}while(0)</a>
		</article>
    




		<article>
    		<a href="/blogs/269">三言两语聊kernel：调度入门</a>
		</article>
    




		<article>
    		<a href="/blogs/266">三言两语聊kernel：内存管理入门</a>
		</article>
    




		<article>
    		<a href="/blogs/250">三言两语聊kernel：线程栈</a>
		</article>
    




		<article>
    		<a href="/blogs/227">2012 memory</a>
		</article>
    




		<article>
    		<a href="/blogs/215">三言两语聊Kernel： Undefined Instruction</a>
		</article>
    




    
    
    
	<section class="archives">
		<h1 class="year">2012</h1>

		<article>
    		<a href="/blogs/197">三言两语聊Kernel：flash驱动及文件系统</a>
		</article>
    




		<article>
    		<a href="/blogs/180">《捉虫日记》书评</a>
		</article>
    




		<article>
    		<a href="/blogs/119">iPhoneOS浅浅浅浅析(4):不做学术派</a>
		</article>
    




		<article>
    		<a href="/blogs/112">iPhoneOS浅浅浅浅析（3）</a>
		</article>
    




		<article>
    		<a href="/blogs/91">iPhoneOS浅浅浅浅析（2）</a>
		</article>
    




		<article>
    		<a href="/blogs/79">iPhoneOS浅浅浅浅析</a>
		</article>
    




		<article>
    		<a href="/blogs/66">是闰土，还是马克？</a>
		</article>
    




		<article>
    		<a href="/blogs/3">hello world!</a>
		</article>
    
	</section>
    

<!--    <h4 class="title"><a href=""></a></h4>
&#8211;>
<!--



   <article class="post">
	<h2 class="title">
		
		<a href="/blog/2014/12/27/reading-2014/">
		
			My Reading in 2014</a>
	</h2>
	<div class="entry-content">
		<p>This article was automatically generated via <a href="https://github.com/laoar/booklist">Booklist</a>, which is wrote in Ruby by @laoar. It&#8217;s open to everyone. Feel free to use it.</p>


<p>Below are the books @laoar have read in 2014. There&rsquo;re totally 23 books, that&rsquo;s approximately 1.92 books per month, not a bad number. Pls. keep proceeding.<br><br></p>

<h3>1.   Ruby元编程</h3>


<center><img src="http://img5.douban.com/mpic/s7014167.jpg"></center>


<p><strong>rating: </strong>★★★★☆</p>


<p><strong>comment:</strong><br>
读完了ruby的这部分，以后再读rails这部分。</p>


<p><font color=red>[Hey slacker, can&#8217;t U read it seriously and give more comment?]</font></p>


<br>




<h3>2.   C程序性能优化</h3>


<center><img src="http://img3.douban.com/mpic/s24611330.jpg"></center>


<p><strong>rating: </strong>★★★★☆</p>


<p><strong>comment:</strong><br>
日本技术人员在一些领域上总是会钻研的很深，他们写的书总有一些参考价值。这本书对我对性能优化的理解很有帮助，虽然大部分内容都无用，然后有那么几句话切实的帮到了我就够了，一本好书！</p>


<p><font color=green>[Good job!]</font></p>


<br>




<h3>3.   Zero to One</h3>


<center><img src="http://img5.douban.com/mpic/s27463048.jpg"></center>


<p><strong>rating: </strong>★★★★☆</p>


<p><strong>comment:</strong><br>
The author Peter Thiel is  a legendary person. This book descripts his experice on the companies which he has found or invested.</p>


<p><font color=green>[Good job!]</font></p>


<br>




<h3>4.   图解网络硬件</h3>


<center><img src="http://img3.douban.com/mpic/s27316002.jpg"></center>


<p><strong>rating: </strong>★★★★☆</p>


<p><strong>comment:</strong><br>
讲的很全面，很好的入门读物。</p>


<p><font color=red>[Hey slacker, can&#8217;t U read it seriously and give more comment?]</font></p>


<br>




<h3>5.   自由之魂</h3>


<center><img src="http://img5.douban.com/mpic/s27086436.jpg"></center>


<p><strong>rating: </strong>★★★☆☆</p>


<p><strong>comment:</strong><br>
可是都去了台湾。</p>


<p><font color=red>[Hey slacker, can&#8217;t U read it seriously and give more comment?]</font></p>


<br>




<h3>6.   Of Mice and Men</h3>


<center><img src="http://img3.douban.com/mpic/s4734995.jpg"></center>


<p><strong>rating: </strong>★★★★★</p>


<p><strong>comment:</strong><br>
Reads like ancient English, i.e. ya, ta, wun&#8217;t. Not sure whether it is because of printing or not, but this is the first kindle book I purchased on amazon.com, which took me around 8$. The two men were both dependent on each other and had a common dream, going through so many difficuties, however the dream was broken at last. Sorrowful ending.</p>


<p>[hmm&#8230;]</p>


<br>




<h3>7.   HTML 5 与 CSS 3 权威指南</h3>


<center><img src="http://img5.douban.com/mpic/s4696737.jpg"></center>


<p><strong>rating: </strong>★★★☆☆</p>


<p><strong>comment:</strong><br>
对于不了解html和css的，不适合读这本书。像一本手册，不适合系统学习。作者费这么多心思来搜集网上的资料，大致也能了解html5/css3能够做什么。</p>


<p><font color=green>[Good job!]</font></p>


<br>




<h3>8.   A Tale of Two Cities</h3>


<center><img src="http://img5.douban.com/mpic/s2789809.jpg"></center>


<p><strong>rating: </strong>★★★★★</p>


<p><strong>comment:</strong><br>
Charles Dickens&#8217; words are so beautiful.</p>


<p><font color=red>[Hey slacker, can&#8217;t U read it seriously and give more comment?]</font></p>


<br>




<h3>9.   Hard Choices</h3>


<center><img src="http://img5.douban.com/mpic/s27312699.jpg"></center>


<p><strong>rating: </strong>★★★☆☆</p>


<p><strong>comment:</strong><br>
Chapters related to China  are as follows, chap. 4, 5 and 25.  Nevertheless, it can broaden our view.</p>


<p><font color=green>[Good job!]</font></p>


<br>




<h3>10.   图解HTTP</h3>


<center><img src="http://img3.douban.com/mpic/s27283822.jpg"></center>


<p><strong>rating: </strong>★★★☆☆</p>


<p><strong>comment:</strong><br>
http快速入门，看完之后能够让你对http了解一个大概，不深入，入门。对于没有网络基础的人而言很适用。</p>


<p><font color=red>[Hey slacker, can&#8217;t U read it seriously and give more comment?]</font></p>


<br>




<h3>11.   松本行弘的程序世界</h3>


<center><img src="http://img5.douban.com/mpic/s11290956.jpg"></center>


<p><strong>rating: </strong>★★★★★</p>


<p><strong>comment:</strong><br>
ruby版《深入理解计算机系统》。侧重理论讲解，离实际应用还很远。</p>


<p><font color=red>[Hey slacker, can&#8217;t U read it seriously and give more comment?]</font></p>


<br>




<h3>12.   The Old Man and the Sea</h3>


<center><img src="http://img3.douban.com/mpic/s9068443.jpg"></center>


<p><strong>rating: </strong>★☆☆☆☆</p>


<p><strong>comment:</strong><br>
Looks wierd that it won for Hemingway both Pulitzer and Nobel Prize. It descibes a old fisherman&#8217;s three days&#8217; struggling on the sea just because of a big fish which in his mind represents pride, hornor, faith, goal or something.   This kind of book, per my understanding, only deserves one star. That&#8217;s all.</p>


<p>[hmm&#8230;]</p>


<br>




<h3>13.   The Shortest History of Europe</h3>


<center><img src="http://img3.douban.com/mpic/s4489600.jpg"></center>


<p><strong>rating: </strong>★★★★☆</p>


<p><strong>comment:</strong><br>
It&#8217;s a special perspective that interpreting the history not by timeline, but by the religion, goverment and language.  It mentioned China as well, with the purpose to explain why Europe was the first to industrialise.</p>


<p>[hmm&#8230;]</p>


<br>




<h3>14.   The Fault in Our Stars</h3>


<center><img src="http://img3.douban.com/mpic/s10394551.jpg"></center>


<p><strong>rating: </strong>★★★☆☆</p>


<p><strong>comment:</strong><br>
Very sad love story of young adult. It&#8217;s NOTHING but a commercial book, which only aims to sell more copies.  I would recommend it for none.</p>


<p><font color=green>[Good job!]</font></p>


<br>




<h3>15.   Programming Ruby</h3>


<center><img src="http://img3.douban.com/mpic/s4244255.jpg"></center>


<p><strong>rating: </strong>★★★☆☆</p>


<p><strong>comment:</strong><br>
The introduction to Ruby. NO rails, and metaprogramming.</p>


<p><font color=red>[Hey slacker, can&#8217;t U read it seriously and give more comment?]</font></p>


<br>




<h3>16.   The Crowd</h3>


<center><img src="http://img3.douban.com/mpic/s3363313.jpg"></center>


<p><strong>rating: </strong>★★★☆☆</p>


<p><strong>comment:</strong><br>
Full of rumor stories, lack of agumentation. It can&#8217;t convinced me withouth enough evidence, but inerest me beause of his point of view. Compared to novel, this kind of book is very hard to read in English.</p>


<p>[hmm&#8230;]</p>


<br>




<h3>17.   Animal Farm</h3>


<center><img src="http://img5.douban.com/mpic/s11909707.jpg"></center>


<p><strong>rating: </strong>★★★★★</p>


<p><strong>comment:</strong><br>
Orwell is good at using very simple story to explain the truth.Took me few days finish it.Pretty easy reading.It&#8217;s an allegory of the Russian Revolution.The farmer(Nicholas II),Major(Lenin/Marx),Snowball(Leon Trosky)，Napoleon(Stalin),Boxer(the peasants),dogs(The Party).Regarding China, it&#8217;s same.Framer(蒋？)，Major(李大钊/陈独秀),Snowball(刘)，Naploeon(哼～).</p>


<p>[hmm&#8230;]</p>


<br>




<h3>18.   Atlas Shrugged</h3>


<center><img src="http://img5.douban.com/mpic/s1448069.jpg"></center>


<p><strong>rating: </strong>★★★★☆</p>


<p><strong>comment:</strong><br>
花了差不多三个月读完了这本英文皇皇巨著。 I will never live for the sake of another man, nor ask another man to live for min. 安兰德在这本书里宣扬的是自私经济学，反对所谓共产主义。书名来自于Fransisco和Realdan的对话，Atalas holds the world on his shoulders, with his blood running, yet still making greate effort to hold the world aloft.  He need a shrug to relex himself.    很好奇Golt的理想国最后会是什么结局？可惜安兰德没有写。</p>


<p>[hmm&#8230;]</p>


<br>




<h3>19.   代码的未来</h3>


<center><img src="http://img5.douban.com/mpic/s26393136.jpg"></center>


<p><strong>rating: </strong>★★★★★</p>


<p><strong>comment:</strong><br>
不愧为大师，能够用很通俗的语言把很高深的技术描述的很清楚。 而且把各种技术关联在一起，正应了那句话，技术总是相同的，牛人的牛逼之处就在于能够触类旁通。总之，这本书给我的帮助很大。</p>


<p><font color=green>[Good job!]</font></p>


<br>




<h3>20.   黑客与画家</h3>


<center><img src="http://img3.douban.com/mpic/s4669554.jpg"></center>


<p><strong>rating: </strong>★★★☆☆</p>


<p><strong>comment:</strong><br>
如果不是那几篇谈论编程语言的文章，我真想给它2星。许多文章是又丑又长，一个观点反反复复变换着各个法儿的说，味同嚼蜡。另外，关于未来的编程语言，我还是觉得松本行弘在《代码的未来》里说的更好。</p>


<p><font color=green>[Good job!]</font></p>


<br>




<h3>21.   台湾念真情</h3>


<center><img src="http://img5.douban.com/mpic/s11150599.jpg"></center>


<p><strong>rating: </strong>★★★★☆</p>


<p><strong>comment:</strong><br>
乡土民情。台湾人的文字很优雅。</p>


<p><font color=red>[Hey slacker, can&#8217;t U read it seriously and give more comment?]</font></p>


<br>




<h3>22.   图解TCP/IP : 第5版</h3>


<center><img src="http://img5.douban.com/mpic/s26676928.jpg"></center>


<p><strong>rating: </strong>★★★☆☆</p>


<p><strong>comment:</strong><br>
TCP/IP快速入门，以及索引。 译者的计算机背景似乎不是很强，比如第24页，“最典型的时大实体和小实体”，有点莫名其妙，实则应该是“大端和小端”。</p>


<p><font color=green>[Good job!]</font></p>


<br>




<h3>23.   父与子全集</h3>


<center><img src="http://img5.douban.com/mpic/s1094608.jpg"></center>


<p><strong>rating: </strong>★★★★★</p>


<p><strong>comment:</strong><br>
温馨</p>


<p><font color=red>[Hey slacker, can&#8217;t U read it seriously and give more comment?]</font></p>


<br>




<h2>Statistics</h2>


<br><img src="/images/human_lang.png"><img src="/images/details_month.png">


		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2014-12-27T06:32:01+08:00" pubdate data-updated="true">Dec 27<span>th</span>, 2014</time></div>
	<div class="tags">

</div>
	
</div>
</article>  


   <article class="post">
	<h2 class="title">
		
		<a href="/blog/2014/11/26/loop-unrolling/">
		
			Loop Unrolling : May or May Not Make the Program Run Faster</a>
	</h2>
	<div class="entry-content">
		<p>loop unrolling 是将while/for循环的循环主体多排列几次展开以减少循环次数，从而减少分支指令开销来达到优化性能的目的。我们可以手动的修改while/for循环来展开循环体，也可以使用编译器的自动循环展开功能。gcc的-funroll-loops就是用来自动将循环给展开用的。在gcc的手册里，对于-funroll-loops有一句说明，“This option makes code larger, and may or may not make it run faster.”，其实这句话并不是很准确，确切的说法是，“This option may improves or reduces the performance.”。</p>


<p>在最近我的做的一个项目中，版本做出大幅度升级后，性能下降了30%多，经过各种排查后发现原来是编译器从Gcc-4.1.1升级为Gcc-4.2.1后-funroll-loops的行为发生了变化，使得在循环展开的过程中产生了大量的temp variables，这些temp variables入栈和出栈占用了大量的cpu cycles，从而使得其中一个线程成为bottleneck，性能因此下降了30%多.</p>


<p>在这篇博客里，来分析下loop unrolling为什么会导致性能下降</p>


<p>如下是我写的一个测试程序用来描述该问题。</p>




<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
</pre></td><td class='code'><pre><code class='c'><span class='line'><span class="cp">#define TIMES 2</span>
</span><span class='line'><span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span>
</span><span class='line'><span class="nf">atomic_write64</span> <span class="p">(</span><span class="n">u_int64_t</span> <span class="o">*</span><span class="n">addr</span><span class="p">,</span> <span class="n">u_int64_t</span> <span class="n">val</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="k">volatile</span> <span class="n">u_int32_t</span> <span class="n">val_hi</span> <span class="o">=</span> <span class="n">val</span> <span class="o">&gt;&gt;</span> <span class="mi">32</span><span class="p">;</span>
</span><span class='line'>    <span class="k">volatile</span> <span class="n">u_int32_t</span> <span class="n">val_lo</span> <span class="o">=</span> <span class="n">val</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">asm</span>  <span class="k">volatile</span><span class="p">(</span><span class="s">&quot;    .set push           </span><span class="se">\n</span><span class="s">&quot;</span>
</span><span class='line'>                <span class="s">&quot;    .set mips64         </span><span class="se">\n</span><span class="s">&quot;</span>
</span><span class='line'>                <span class="s">&quot;    dsll   %1, %1, 32   </span><span class="se">\n</span><span class="s">&quot;</span>
</span><span class='line'>                <span class="s">&quot;    dsll   %2, %2, 32   </span><span class="se">\n</span><span class="s">&quot;</span>
</span><span class='line'>                <span class="s">&quot;    dsrl   %2, %2, 32   </span><span class="se">\n</span><span class="s">&quot;</span>
</span><span class='line'>                <span class="s">&quot;    or     %1, %1, %2   </span><span class="se">\n</span><span class="s">&quot;</span>
</span><span class='line'>                <span class="s">&quot;    dsll   %0, %0, 32   </span><span class="se">\n</span><span class="s">&quot;</span>
</span><span class='line'>                <span class="s">&quot;    dsrl   %0, %0, 32   </span><span class="se">\n</span><span class="s">&quot;</span>
</span><span class='line'>                <span class="s">&quot;    sd     %1, 0(%0)    </span><span class="se">\n</span><span class="s">&quot;</span>
</span><span class='line'>                <span class="s">&quot;    .set pop            </span><span class="se">\n</span><span class="s">&quot;</span>
</span><span class='line'>                <span class="o">:</span>
</span><span class='line'>                <span class="o">:</span><span class="s">&quot;r&quot;</span><span class="p">(</span><span class="n">addr</span><span class="p">),</span> <span class="s">&quot;r&quot;</span> <span class="p">(</span><span class="n">val_hi</span><span class="p">),</span> <span class="s">&quot;r&quot;</span> <span class="p">(</span><span class="n">val_lo</span><span class="p">)</span>
</span><span class='line'>               <span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="kt">int</span> <span class="n">i</span><span class="p">;</span>
</span><span class='line'>    <span class="n">u_int64_t</span> <span class="n">x</span><span class="p">;</span>
</span><span class='line'>    <span class="n">u_int64_t</span> <span class="o">*</span><span class="n">addr</span> <span class="o">=</span> <span class="p">(</span><span class="n">u_int64_t</span> <span class="o">*</span><span class="p">)</span><span class="n">malloc</span><span class="p">(</span><span class="k">sizeof</span><span class="p">(</span><span class="n">u_int64_t</span><span class="p">)</span> <span class="o">*</span> <span class="mi">2</span><span class="p">);</span>
</span><span class='line'>    <span class="n">u_int64_t</span> <span class="o">*</span><span class="n">new_addr</span> <span class="o">=</span> <span class="p">(</span><span class="n">u_int64_t</span> <span class="o">*</span><span class="p">)((</span><span class="kt">unsigned</span> <span class="kt">int</span><span class="p">)</span><span class="n">addr</span> <span class="o">&amp;</span> <span class="mh">0xfffffff8</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">TIMES</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="c1">// The value of random() is 32bits.</span>
</span><span class='line'>        <span class="n">x</span> <span class="o">=</span> <span class="p">(</span><span class="n">u_int64_t</span><span class="p">)</span><span class="n">random</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="mi">32</span> <span class="o">+</span> <span class="n">random</span><span class="p">();</span>
</span><span class='line'>        <span class="n">atomic_write64</span><span class="p">(</span><span class="n">new_addr</span><span class="p">,</span> <span class="n">x</span><span class="p">);</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>对该测试程序的一些注释：<br/>
<1> 该atomic function摘自freebsd source code。<br/>
<2> 使用的编译器是Gcc-4.2.1，平台是MIPS（该CPU是64bit的CPU），ABI是O32.[1]<br>
<3> 之所以要new_addr的低3bits要为0，是由于sd指令要求地址必须是8字节对齐。  这里就是O32和N32区别的一个体现，O32的寄存器是32bits，所以它的栈空间是4字节对齐，即指针是4字节对齐的；N32的寄存器是64bits，所以它的栈空间是64bits，即指针是8字节对齐。在N32上就不需要做这种处理。<br/>
<4> 由于CPU的寄存器是64bits，所以dsll将寄存器左移32bits后会将寄存器内容移到高32bits，实际上这里是变相在使用N32的特性，即64bit寄存器.<br/>
<5> 为了便于理解反汇编，gcc的优化option使用-O.<br/>
<6> 之所以初始测试条件是TIMES为2，而不是1，是为了防止for循环被编译器给优化掉。</p>




<p>我们编译该程序，然后看反汇编结果：</p>




<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
</pre></td><td class='code'><pre><code class='c'><span class='line'><span class="mo">00000000</span> <span class="o">&lt;</span><span class="n">main</span><span class="o">&gt;:</span>
</span><span class='line'>   <span class="mi">0</span><span class="o">:</span>   <span class="mi">3</span><span class="n">c1c0000</span>    <span class="n">lui</span> <span class="n">gp</span><span class="p">,</span><span class="mh">0x0</span>
</span><span class='line'>   <span class="mi">4</span><span class="o">:</span>   <span class="mi">279</span><span class="n">c0000</span>    <span class="n">addiu</span>   <span class="n">gp</span><span class="p">,</span><span class="n">gp</span><span class="p">,</span><span class="mi">0</span>
</span><span class='line'>   <span class="mi">8</span><span class="o">:</span>   <span class="mf">0399e021</span>    <span class="n">addu</span>    <span class="n">gp</span><span class="p">,</span><span class="n">gp</span><span class="p">,</span><span class="n">t9</span>
</span><span class='line'>   <span class="nl">c:</span>   <span class="mi">27</span><span class="n">bdffc8</span>    <span class="n">addiu</span>   <span class="n">sp</span><span class="p">,</span><span class="n">sp</span><span class="p">,</span><span class="o">-</span><span class="mi">56</span>
</span><span class='line'>  <span class="mi">10</span><span class="o">:</span>   <span class="n">afbf0034</span>    <span class="n">sw</span>  <span class="n">ra</span><span class="p">,</span><span class="mi">52</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
</span><span class='line'>  <span class="mi">14</span><span class="o">:</span>   <span class="n">afb40030</span>    <span class="n">sw</span>  <span class="n">s4</span><span class="p">,</span><span class="mi">48</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
</span><span class='line'>  <span class="mi">18</span><span class="o">:</span>   <span class="n">afb3002c</span>    <span class="n">sw</span>  <span class="n">s3</span><span class="p">,</span><span class="mi">44</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
</span><span class='line'>  <span class="mi">1</span><span class="n">c</span><span class="o">:</span>   <span class="n">afb20028</span>    <span class="n">sw</span>  <span class="n">s2</span><span class="p">,</span><span class="mi">40</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
</span><span class='line'>  <span class="mi">20</span><span class="o">:</span>   <span class="n">afb10024</span>    <span class="n">sw</span>  <span class="n">s1</span><span class="p">,</span><span class="mi">36</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
</span><span class='line'>  <span class="mi">24</span><span class="o">:</span>   <span class="n">afb00020</span>    <span class="n">sw</span>  <span class="n">s0</span><span class="p">,</span><span class="mi">32</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
</span><span class='line'>  <span class="mi">28</span><span class="o">:</span>   <span class="n">afbc0010</span>    <span class="n">sw</span>  <span class="n">gp</span><span class="p">,</span><span class="mi">16</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
</span><span class='line'>  <span class="mi">2</span><span class="n">c</span><span class="o">:</span>   <span class="mf">8f</span><span class="mi">990000</span>    <span class="n">lw</span>  <span class="n">t9</span><span class="p">,</span><span class="mi">0</span><span class="p">(</span><span class="n">gp</span><span class="p">)</span>
</span><span class='line'>  <span class="mi">30</span><span class="o">:</span>   <span class="mf">0320f</span><span class="mi">809</span>    <span class="n">jalr</span>    <span class="n">t9</span>
</span><span class='line'>  <span class="mi">34</span><span class="o">:</span>   <span class="mi">24040010</span>    <span class="n">li</span>  <span class="n">a0</span><span class="p">,</span><span class="mi">16</span>
</span><span class='line'>  <span class="mi">38</span><span class="o">:</span>   <span class="mf">8f</span><span class="n">bc0010</span>    <span class="n">lw</span>  <span class="n">gp</span><span class="p">,</span><span class="mi">16</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
</span><span class='line'>  <span class="mi">3</span><span class="n">c</span><span class="o">:</span>   <span class="mf">2403ff</span><span class="n">f8</span>    <span class="n">li</span>  <span class="n">v1</span><span class="p">,</span><span class="o">-</span><span class="mi">8</span>
</span><span class='line'>  <span class="mi">40</span><span class="o">:</span>   <span class="mo">0043</span><span class="n">a024</span>    <span class="n">and</span> <span class="n">s4</span><span class="p">,</span><span class="n">v0</span><span class="p">,</span><span class="n">v1</span>
</span><span class='line'>  <span class="mi">44</span><span class="o">:</span>   <span class="mo">0000</span><span class="mi">9021</span>    <span class="n">move</span>    <span class="n">s2</span><span class="p">,</span><span class="n">zero</span>
</span><span class='line'>  <span class="mi">48</span><span class="o">:</span>   <span class="mf">8f</span><span class="mi">990000</span>    <span class="n">lw</span>  <span class="n">t9</span><span class="p">,</span><span class="mi">0</span><span class="p">(</span><span class="n">gp</span><span class="p">)</span>
</span><span class='line'>  <span class="mi">4</span><span class="n">c</span><span class="o">:</span>   <span class="mo">0320</span><span class="mi">9821</span>    <span class="n">move</span>    <span class="n">s3</span><span class="p">,</span><span class="n">t9</span>
</span><span class='line'>  <span class="mi">50</span><span class="o">:</span>   <span class="mo">0260</span><span class="n">c821</span>    <span class="n">move</span>    <span class="n">t9</span><span class="p">,</span><span class="n">s3</span>
</span><span class='line'>  <span class="mi">54</span><span class="o">:</span>   <span class="mf">0320f</span><span class="mi">809</span>    <span class="n">jalr</span>    <span class="n">t9</span>
</span><span class='line'>  <span class="mi">58</span><span class="o">:</span>   <span class="mo">0000</span><span class="mi">8821</span>    <span class="n">move</span>    <span class="n">s1</span><span class="p">,</span><span class="n">zero</span>
</span><span class='line'>  <span class="mi">5</span><span class="n">c</span><span class="o">:</span>   <span class="mf">8f</span><span class="n">bc0010</span>    <span class="n">lw</span>  <span class="n">gp</span><span class="p">,</span><span class="mi">16</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
</span><span class='line'>  <span class="mi">60</span><span class="o">:</span>   <span class="mo">0260</span><span class="n">c821</span>    <span class="n">move</span>    <span class="n">t9</span><span class="p">,</span><span class="n">s3</span>
</span><span class='line'>  <span class="mi">64</span><span class="o">:</span>   <span class="mf">0320f</span><span class="mi">809</span>    <span class="n">jalr</span>    <span class="n">t9</span>
</span><span class='line'>  <span class="mi">68</span><span class="o">:</span>   <span class="mo">0040</span><span class="mi">8021</span>    <span class="n">move</span>    <span class="n">s0</span><span class="p">,</span><span class="n">v0</span>
</span><span class='line'>  <span class="mi">6</span><span class="n">c</span><span class="o">:</span>   <span class="mf">8f</span><span class="n">bc0010</span>    <span class="n">lw</span>  <span class="n">gp</span><span class="p">,</span><span class="mi">16</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
</span><span class='line'>  <span class="mi">70</span><span class="o">:</span>   <span class="mo">00401</span><span class="mi">821</span>    <span class="n">move</span>    <span class="n">v1</span><span class="p">,</span><span class="n">v0</span>
</span><span class='line'>  <span class="mi">74</span><span class="o">:</span>   <span class="mo">000217</span><span class="n">c3</span>    <span class="n">sra</span> <span class="n">v0</span><span class="p">,</span><span class="n">v0</span><span class="p">,</span><span class="mh">0x1f</span>
</span><span class='line'>  <span class="mi">78</span><span class="o">:</span>   <span class="mo">0202</span><span class="mi">8025</span>    <span class="n">or</span>  <span class="n">s0</span><span class="p">,</span><span class="n">s0</span><span class="p">,</span><span class="n">v0</span>
</span><span class='line'>  <span class="mi">7</span><span class="n">c</span><span class="o">:</span>   <span class="mo">0223</span><span class="mi">8825</span>    <span class="n">or</span>  <span class="n">s1</span><span class="p">,</span><span class="n">s1</span><span class="p">,</span><span class="n">v1</span>
</span><span class='line'>  <span class="mi">80</span><span class="o">:</span>   <span class="n">afb00018</span>    <span class="n">sw</span>  <span class="n">s0</span><span class="p">,</span><span class="mi">24</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
</span><span class='line'>  <span class="mi">84</span><span class="o">:</span>   <span class="n">afb1001c</span>    <span class="n">sw</span>  <span class="n">s1</span><span class="p">,</span><span class="mi">28</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
</span><span class='line'>  <span class="mi">88</span><span class="o">:</span>   <span class="mf">8f</span><span class="n">a30018</span>    <span class="n">lw</span>  <span class="n">v1</span><span class="p">,</span><span class="mi">24</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
</span><span class='line'>  <span class="mi">8</span><span class="n">c</span><span class="o">:</span>   <span class="mf">8f</span><span class="n">a2001c</span>    <span class="n">lw</span>  <span class="n">v0</span><span class="p">,</span><span class="mi">28</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
</span><span class='line'>  <span class="mi">90</span><span class="o">:</span>   <span class="mo">00031</span><span class="mi">83</span><span class="n">c</span>    <span class="n">dsll32</span>  <span class="n">v1</span><span class="p">,</span><span class="n">v1</span><span class="p">,</span><span class="mh">0x0</span>
</span><span class='line'>  <span class="mi">94</span><span class="o">:</span>   <span class="mo">0002103</span><span class="n">c</span>    <span class="n">dsll32</span>  <span class="n">v0</span><span class="p">,</span><span class="n">v0</span><span class="p">,</span><span class="mh">0x0</span>
</span><span class='line'>  <span class="mi">98</span><span class="o">:</span>   <span class="mo">0002103</span><span class="n">e</span>    <span class="n">dsrl32</span>  <span class="n">v0</span><span class="p">,</span><span class="n">v0</span><span class="p">,</span><span class="mh">0x0</span>
</span><span class='line'>  <span class="mi">9</span><span class="n">c</span><span class="o">:</span>   <span class="mo">00621</span><span class="mi">825</span>    <span class="n">or</span>  <span class="n">v1</span><span class="p">,</span><span class="n">v1</span><span class="p">,</span><span class="n">v0</span>
</span><span class='line'>  <span class="nl">a0:</span>   <span class="mo">0014</span><span class="n">a03c</span>    <span class="n">dsll32</span>  <span class="n">s4</span><span class="p">,</span><span class="n">s4</span><span class="p">,</span><span class="mh">0x0</span>
</span><span class='line'>  <span class="nl">a4:</span>   <span class="mo">0014</span><span class="n">a03e</span>    <span class="n">dsrl32</span>  <span class="n">s4</span><span class="p">,</span><span class="n">s4</span><span class="p">,</span><span class="mh">0x0</span>
</span><span class='line'>  <span class="nl">a8:</span>   <span class="n">fe830000</span>    <span class="n">sd</span>  <span class="n">v1</span><span class="p">,</span><span class="mi">0</span><span class="p">(</span><span class="n">s4</span><span class="p">)</span>
</span><span class='line'>  <span class="nl">ac:</span>   <span class="mi">26520001</span>    <span class="n">addiu</span>   <span class="n">s2</span><span class="p">,</span><span class="n">s2</span><span class="p">,</span><span class="mi">1</span>
</span><span class='line'>  <span class="nl">b0:</span>   <span class="mi">24020002</span>    <span class="n">li</span>  <span class="n">v0</span><span class="p">,</span><span class="mi">2</span>
</span><span class='line'>  <span class="nl">b4:</span>   <span class="mf">1642ff</span><span class="n">e7</span>    <span class="n">bne</span> <span class="n">s2</span><span class="p">,</span><span class="n">v0</span><span class="p">,</span><span class="mi">54</span> <span class="o">&lt;</span><span class="n">main</span><span class="o">+</span><span class="mh">0x54</span><span class="o">&gt;</span>
</span><span class='line'>  <span class="nl">b8:</span>   <span class="mo">0260</span><span class="n">c821</span>    <span class="n">move</span>    <span class="n">t9</span><span class="p">,</span><span class="n">s3</span>
</span><span class='line'>  <span class="nl">bc:</span>   <span class="mo">00001021</span>    <span class="n">move</span>    <span class="n">v0</span><span class="p">,</span><span class="n">zero</span>
</span><span class='line'>  <span class="nl">c0:</span>   <span class="mf">8f</span><span class="n">bf0034</span>    <span class="n">lw</span>  <span class="n">ra</span><span class="p">,</span><span class="mi">52</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
</span><span class='line'>  <span class="nl">c4:</span>   <span class="mf">8f</span><span class="n">b40030</span>    <span class="n">lw</span>  <span class="n">s4</span><span class="p">,</span><span class="mi">48</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
</span><span class='line'>  <span class="nl">c8:</span>   <span class="mf">8f</span><span class="n">b3002c</span>    <span class="n">lw</span>  <span class="n">s3</span><span class="p">,</span><span class="mi">44</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
</span><span class='line'>  <span class="nl">cc:</span>   <span class="mf">8f</span><span class="n">b20028</span>    <span class="n">lw</span>  <span class="n">s2</span><span class="p">,</span><span class="mi">40</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
</span><span class='line'>  <span class="nl">d0:</span>   <span class="mf">8f</span><span class="n">b10024</span>    <span class="n">lw</span>  <span class="n">s1</span><span class="p">,</span><span class="mi">36</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
</span><span class='line'>  <span class="nl">d4:</span>   <span class="mf">8f</span><span class="n">b00020</span>    <span class="n">lw</span>  <span class="n">s0</span><span class="p">,</span><span class="mi">32</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
</span><span class='line'>  <span class="nl">d8:</span>   <span class="mf">03e00008</span>    <span class="n">jr</span>  <span class="n">ra</span>
</span><span class='line'>  <span class="nl">dc:</span>   <span class="mi">27</span><span class="n">bd0038</span>    <span class="n">addiu</span>   <span class="n">sp</span><span class="p">,</span><span class="n">sp</span><span class="p">,</span><span class="mi">56</span>
</span></code></pre></td></tr></table></div></figure>


<p>可以看出，变量val_hi和val_lo分别存储在24(sp)和28(sp)这部分内存空间.</p>


<p>另外还需要注意的变量x。<br/>
<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='c'><span class='line'>  <span class="mi">64</span><span class="o">:</span>   <span class="mf">0320f</span><span class="mi">809</span>    <span class="n">jalr</span>    <span class="n">t9</span>
</span><span class='line'>  <span class="mi">68</span><span class="o">:</span>   <span class="mo">0040</span><span class="mi">8021</span>    <span class="n">move</span>    <span class="n">s0</span><span class="p">,</span><span class="n">v0</span>
</span><span class='line'>  <span class="mi">6</span><span class="n">c</span><span class="o">:</span>   <span class="mf">8f</span><span class="n">bc0010</span>    <span class="n">lw</span>  <span class="n">gp</span><span class="p">,</span><span class="mi">16</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
</span><span class='line'>  <span class="mi">70</span><span class="o">:</span>   <span class="mo">00401</span><span class="mi">821</span>    <span class="n">move</span>    <span class="n">v1</span><span class="p">,</span><span class="n">v0</span>
</span></code></pre></td></tr></table></div></figure>
由于我只是-C来编译，并没有做链接，所以在这里调用random()这个函数是被编译为了”jalr t9”，在MIPS上，函数调用的返回值会放在$v0这个寄存器里面。[2]在这里函数调用的返回值$v0 是直接赋值给了$s0和$v1，而不是放入栈空间，这说明编译器将变量x存储在了寄存器里面而不是内存里面。编译器之所以会这么做，是为了提高性能。变量尽可能的存储在寄存器上，从而减少访问内存所需要消耗的时间。另外再说一句，寄存器数量是有限的，当寄存器无法再存储变量时，就会将临时变量存储到内存上。</p>


<p></p>然后我们将TIME 变为3，对比看下有无funroll-loops下的差异。</p>
1) 无funroll-loops.</p>

<p>结果证明，跟TIMES为2的情况下相比，反汇编结果一样。此处不再拷贝代码</p>


<p>2） 使用funroll-loops</p>

<p> 汇编代码较长，闪花了眼，我在后面只解释重点。</p>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
<span class='line-number'>97</span>
<span class='line-number'>98</span>
<span class='line-number'>99</span>
<span class='line-number'>100</span>
<span class='line-number'>101</span>
<span class='line-number'>102</span>
<span class='line-number'>103</span>
<span class='line-number'>104</span>
<span class='line-number'>105</span>
<span class='line-number'>106</span>
<span class='line-number'>107</span>
<span class='line-number'>108</span>
<span class='line-number'>109</span>
<span class='line-number'>110</span>
<span class='line-number'>111</span>
<span class='line-number'>112</span>
<span class='line-number'>113</span>
<span class='line-number'>114</span>
<span class='line-number'>115</span>
<span class='line-number'>116</span>
<span class='line-number'>117</span>
<span class='line-number'>118</span>
<span class='line-number'>119</span>
<span class='line-number'>120</span>
<span class='line-number'>121</span>
<span class='line-number'>122</span>
<span class='line-number'>123</span>
<span class='line-number'>124</span>
<span class='line-number'>125</span>
<span class='line-number'>126</span>
<span class='line-number'>127</span>
<span class='line-number'>128</span>
<span class='line-number'>129</span>
<span class='line-number'>130</span>
<span class='line-number'>131</span>
<span class='line-number'>132</span>
<span class='line-number'>133</span>
<span class='line-number'>134</span>
<span class='line-number'>135</span>
<span class='line-number'>136</span>
<span class='line-number'>137</span>
<span class='line-number'>138</span>
<span class='line-number'>139</span>
<span class='line-number'>140</span>
<span class='line-number'>141</span>
<span class='line-number'>142</span>
<span class='line-number'>143</span>
<span class='line-number'>144</span>
<span class='line-number'>145</span>
<span class='line-number'>146</span>
<span class='line-number'>147</span>
<span class='line-number'>148</span>
<span class='line-number'>149</span>
<span class='line-number'>150</span>
<span class='line-number'>151</span>
<span class='line-number'>152</span>
<span class='line-number'>153</span>
<span class='line-number'>154</span>
<span class='line-number'>155</span>
<span class='line-number'>156</span>
<span class='line-number'>157</span>
<span class='line-number'>158</span>
<span class='line-number'>159</span>
<span class='line-number'>160</span>
<span class='line-number'>161</span>
<span class='line-number'>162</span>
<span class='line-number'>163</span>
<span class='line-number'>164</span>
<span class='line-number'>165</span>
<span class='line-number'>166</span>
<span class='line-number'>167</span>
<span class='line-number'>168</span>
<span class='line-number'>169</span>
<span class='line-number'>170</span>
<span class='line-number'>171</span>
<span class='line-number'>172</span>
<span class='line-number'>173</span>
<span class='line-number'>174</span>
<span class='line-number'>175</span>
</pre></td><td class='code'><pre><code class='c'><span class='line'><span class="mo">00000000</span> <span class="o">&lt;</span><span class="n">main</span><span class="o">&gt;:</span>
</span><span class='line'>   <span class="mi">0</span><span class="o">:</span>   <span class="mi">3</span><span class="n">c1c0000</span>    <span class="n">lui</span> <span class="n">gp</span><span class="p">,</span><span class="mh">0x0</span>
</span><span class='line'>   <span class="mi">4</span><span class="o">:</span>   <span class="mi">279</span><span class="n">c0000</span>    <span class="n">addiu</span>   <span class="n">gp</span><span class="p">,</span><span class="n">gp</span><span class="p">,</span><span class="mi">0</span>
</span><span class='line'>   <span class="mi">8</span><span class="o">:</span>   <span class="mf">0399e021</span>    <span class="n">addu</span>    <span class="n">gp</span><span class="p">,</span><span class="n">gp</span><span class="p">,</span><span class="n">t9</span>
</span><span class='line'>   <span class="nl">c:</span>   <span class="mi">27</span><span class="n">bdff58</span>    <span class="n">addiu</span>   <span class="n">sp</span><span class="p">,</span><span class="n">sp</span><span class="p">,</span><span class="o">-</span><span class="mi">168</span>
</span><span class='line'>  <span class="mi">10</span><span class="o">:</span>   <span class="n">afbf00a4</span>    <span class="n">sw</span>  <span class="n">ra</span><span class="p">,</span><span class="mi">164</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
</span><span class='line'>  <span class="mi">14</span><span class="o">:</span>   <span class="n">afbe00a0</span>    <span class="n">sw</span>  <span class="n">s8</span><span class="p">,</span><span class="mi">160</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
</span><span class='line'>  <span class="mi">18</span><span class="o">:</span>   <span class="n">afb7009c</span>    <span class="n">sw</span>  <span class="n">s7</span><span class="p">,</span><span class="mi">156</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
</span><span class='line'>  <span class="mi">1</span><span class="n">c</span><span class="o">:</span>   <span class="n">afb60098</span>    <span class="n">sw</span>  <span class="n">s6</span><span class="p">,</span><span class="mi">152</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
</span><span class='line'>  <span class="mi">20</span><span class="o">:</span>   <span class="n">afb50094</span>    <span class="n">sw</span>  <span class="n">s5</span><span class="p">,</span><span class="mi">148</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
</span><span class='line'>  <span class="mi">24</span><span class="o">:</span>   <span class="n">afb40090</span>    <span class="n">sw</span>  <span class="n">s4</span><span class="p">,</span><span class="mi">144</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
</span><span class='line'>  <span class="mi">28</span><span class="o">:</span>   <span class="n">afb3008c</span>    <span class="n">sw</span>  <span class="n">s3</span><span class="p">,</span><span class="mi">140</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
</span><span class='line'>  <span class="mi">2</span><span class="n">c</span><span class="o">:</span>   <span class="n">afb20088</span>    <span class="n">sw</span>  <span class="n">s2</span><span class="p">,</span><span class="mi">136</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
</span><span class='line'>  <span class="mi">30</span><span class="o">:</span>   <span class="n">afb10084</span>    <span class="n">sw</span>  <span class="n">s1</span><span class="p">,</span><span class="mi">132</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
</span><span class='line'>  <span class="mi">34</span><span class="o">:</span>   <span class="n">afb00080</span>    <span class="n">sw</span>  <span class="n">s0</span><span class="p">,</span><span class="mi">128</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
</span><span class='line'>  <span class="mi">38</span><span class="o">:</span>   <span class="n">afbc0010</span>    <span class="n">sw</span>  <span class="n">gp</span><span class="p">,</span><span class="mi">16</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
</span><span class='line'>  <span class="mi">3</span><span class="n">c</span><span class="o">:</span>   <span class="mo">00003</span><span class="mi">821</span>    <span class="n">move</span>    <span class="n">a3</span><span class="p">,</span><span class="n">zero</span>
</span><span class='line'>  <span class="mi">40</span><span class="o">:</span>   <span class="mo">00003021</span>    <span class="n">move</span>    <span class="n">a2</span><span class="p">,</span><span class="n">zero</span>
</span><span class='line'>  <span class="mi">44</span><span class="o">:</span>   <span class="n">afa70024</span>    <span class="n">sw</span>  <span class="n">a3</span><span class="p">,</span><span class="mi">36</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
</span><span class='line'>  <span class="mi">48</span><span class="o">:</span>   <span class="n">afa60020</span>    <span class="n">sw</span>  <span class="n">a2</span><span class="p">,</span><span class="mi">32</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
</span><span class='line'>  <span class="mi">4</span><span class="n">c</span><span class="o">:</span>   <span class="n">afa7002c</span>    <span class="n">sw</span>  <span class="n">a3</span><span class="p">,</span><span class="mi">44</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
</span><span class='line'>  <span class="mi">50</span><span class="o">:</span>   <span class="n">afa60028</span>    <span class="n">sw</span>  <span class="n">a2</span><span class="p">,</span><span class="mi">40</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
</span><span class='line'>  <span class="mi">54</span><span class="o">:</span>   <span class="n">afa7003c</span>    <span class="n">sw</span>  <span class="n">a3</span><span class="p">,</span><span class="mi">60</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
</span><span class='line'>  <span class="mi">58</span><span class="o">:</span>   <span class="n">afa60038</span>    <span class="n">sw</span>  <span class="n">a2</span><span class="p">,</span><span class="mi">56</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
</span><span class='line'>  <span class="mi">5</span><span class="n">c</span><span class="o">:</span>   <span class="mo">00002021</span>    <span class="n">move</span>    <span class="n">a0</span><span class="p">,</span><span class="n">zero</span>
</span><span class='line'>  <span class="mi">60</span><span class="o">:</span>   <span class="mo">00001</span><span class="mi">821</span>    <span class="n">move</span>    <span class="n">v1</span><span class="p">,</span><span class="n">zero</span>
</span><span class='line'>  <span class="mi">64</span><span class="o">:</span>   <span class="n">afa40044</span>    <span class="n">sw</span>  <span class="n">a0</span><span class="p">,</span><span class="mi">68</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
</span><span class='line'>  <span class="mi">68</span><span class="o">:</span>   <span class="n">afa30040</span>    <span class="n">sw</span>  <span class="n">v1</span><span class="p">,</span><span class="mi">64</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
</span><span class='line'>  <span class="mi">6</span><span class="n">c</span><span class="o">:</span>   <span class="n">afa4004c</span>    <span class="n">sw</span>  <span class="n">a0</span><span class="p">,</span><span class="mi">76</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
</span><span class='line'>  <span class="mi">70</span><span class="o">:</span>   <span class="n">afa30048</span>    <span class="n">sw</span>  <span class="n">v1</span><span class="p">,</span><span class="mi">72</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
</span><span class='line'>  <span class="mi">74</span><span class="o">:</span>   <span class="n">afa40054</span>    <span class="n">sw</span>  <span class="n">a0</span><span class="p">,</span><span class="mi">84</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
</span><span class='line'>  <span class="mi">78</span><span class="o">:</span>   <span class="n">afa30050</span>    <span class="n">sw</span>  <span class="n">v1</span><span class="p">,</span><span class="mi">80</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
</span><span class='line'>  <span class="mi">7</span><span class="n">c</span><span class="o">:</span>   <span class="n">afa4005c</span>    <span class="n">sw</span>  <span class="n">a0</span><span class="p">,</span><span class="mi">92</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
</span><span class='line'>  <span class="mi">80</span><span class="o">:</span>   <span class="n">afa30058</span>    <span class="n">sw</span>  <span class="n">v1</span><span class="p">,</span><span class="mi">88</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
</span><span class='line'>  <span class="mi">84</span><span class="o">:</span>   <span class="n">afa40064</span>    <span class="n">sw</span>  <span class="n">a0</span><span class="p">,</span><span class="mi">100</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
</span><span class='line'>  <span class="mi">88</span><span class="o">:</span>   <span class="n">afa30060</span>    <span class="n">sw</span>  <span class="n">v1</span><span class="p">,</span><span class="mi">96</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
</span><span class='line'> <span class="mi">8</span><span class="n">c</span><span class="o">:</span>   <span class="n">afa4006c</span>    <span class="n">sw</span>  <span class="n">a0</span><span class="p">,</span><span class="mi">108</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
</span><span class='line'>  <span class="mi">90</span><span class="o">:</span>   <span class="n">afa30068</span>    <span class="n">sw</span>  <span class="n">v1</span><span class="p">,</span><span class="mi">104</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
</span><span class='line'>  <span class="mi">94</span><span class="o">:</span>   <span class="n">afa40074</span>    <span class="n">sw</span>  <span class="n">a0</span><span class="p">,</span><span class="mi">116</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
</span><span class='line'>  <span class="mi">98</span><span class="o">:</span>   <span class="n">afa30070</span>    <span class="n">sw</span>  <span class="n">v1</span><span class="p">,</span><span class="mi">112</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
</span><span class='line'>  <span class="mi">9</span><span class="n">c</span><span class="o">:</span>   <span class="n">afa4007c</span>    <span class="n">sw</span>  <span class="n">a0</span><span class="p">,</span><span class="mi">124</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
</span><span class='line'>  <span class="nl">a0:</span>   <span class="n">afa30078</span>    <span class="n">sw</span>  <span class="n">v1</span><span class="p">,</span><span class="mi">120</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
</span><span class='line'>  <span class="nl">a4:</span>   <span class="mf">8f</span><span class="mi">990000</span>    <span class="n">lw</span>  <span class="n">t9</span><span class="p">,</span><span class="mi">0</span><span class="p">(</span><span class="n">gp</span><span class="p">)</span>
</span><span class='line'>  <span class="nl">a8:</span>   <span class="mf">0320f</span><span class="mi">809</span>    <span class="n">jalr</span>    <span class="n">t9</span>
</span><span class='line'>  <span class="nl">ac:</span>   <span class="mi">24040010</span>    <span class="n">li</span>  <span class="n">a0</span><span class="p">,</span><span class="mi">16</span>
</span><span class='line'>  <span class="nl">b0:</span>   <span class="mf">8f</span><span class="n">bc0010</span>    <span class="n">lw</span>  <span class="n">gp</span><span class="p">,</span><span class="mi">16</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
</span><span class='line'>  <span class="nl">b4:</span>   <span class="mf">2405ff</span><span class="n">f8</span>    <span class="n">li</span>  <span class="n">a1</span><span class="p">,</span><span class="o">-</span><span class="mi">8</span>
</span><span class='line'>  <span class="nl">b8:</span>   <span class="mo">00451024</span>    <span class="n">and</span> <span class="n">v0</span><span class="p">,</span><span class="n">v0</span><span class="p">,</span><span class="n">a1</span>
</span><span class='line'>  <span class="nl">bc:</span>   <span class="mf">8f</span><span class="mi">990000</span>    <span class="n">lw</span>  <span class="n">t9</span><span class="p">,</span><span class="mi">0</span><span class="p">(</span><span class="n">gp</span><span class="p">)</span>
</span><span class='line'>  <span class="nl">c0:</span>   <span class="mf">0320f</span><span class="mi">809</span>    <span class="n">jalr</span>    <span class="n">t9</span>
</span><span class='line'>  <span class="nl">c4:</span>   <span class="n">afa20030</span>    <span class="n">sw</span>  <span class="n">v0</span><span class="p">,</span><span class="mi">48</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
</span><span class='line'>  <span class="nl">c8:</span>   <span class="mf">8f</span><span class="n">bc0010</span>    <span class="n">lw</span>  <span class="n">gp</span><span class="p">,</span><span class="mi">16</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
</span><span class='line'>  <span class="nl">cc:</span>   <span class="mf">8f</span><span class="mi">990000</span>    <span class="n">lw</span>  <span class="n">t9</span><span class="p">,</span><span class="mi">0</span><span class="p">(</span><span class="n">gp</span><span class="p">)</span>
</span><span class='line'>  <span class="nl">d0:</span>   <span class="mf">0320f</span><span class="mi">809</span>    <span class="n">jalr</span>    <span class="n">t9</span>
</span><span class='line'>  <span class="nl">d4:</span>   <span class="mo">0040</span><span class="mi">8021</span>    <span class="n">move</span>    <span class="n">s0</span><span class="p">,</span><span class="n">v0</span>
</span><span class='line'>  <span class="nl">d8:</span>   <span class="mf">8f</span><span class="n">bc0010</span>    <span class="n">lw</span>  <span class="n">gp</span><span class="p">,</span><span class="mi">16</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
</span><span class='line'>  <span class="nl">dc:</span>   <span class="mo">0000</span><span class="n">a821</span>    <span class="n">move</span>    <span class="n">s5</span><span class="p">,</span><span class="n">zero</span>
</span><span class='line'>  <span class="nl">e0:</span>   <span class="mo">0002</span><span class="n">c7c3</span>    <span class="n">sra</span> <span class="n">t8</span><span class="p">,</span><span class="n">v0</span><span class="p">,</span><span class="mh">0x1f</span>
</span><span class='line'>  <span class="nl">e4:</span>   <span class="mo">021</span><span class="mi">8</span><span class="n">b825</span>    <span class="n">or</span>  <span class="n">s7</span><span class="p">,</span><span class="n">s0</span><span class="p">,</span><span class="n">t8</span>
</span><span class='line'>  <span class="nl">e8:</span>   <span class="n">afb70028</span>    <span class="n">sw</span>  <span class="n">s7</span><span class="p">,</span><span class="mi">40</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
</span><span class='line'>  <span class="nl">ec:</span>   <span class="mo">02</span><span class="n">a2a025</span>    <span class="n">or</span>  <span class="n">s4</span><span class="p">,</span><span class="n">s5</span><span class="p">,</span><span class="n">v0</span>
</span><span class='line'>  <span class="nl">f0:</span>   <span class="n">afb4002c</span>    <span class="n">sw</span>  <span class="n">s4</span><span class="p">,</span><span class="mi">44</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
</span><span class='line'>  <span class="nl">f4:</span>   <span class="mf">8f</span><span class="n">b1002c</span>    <span class="n">lw</span>  <span class="n">s1</span><span class="p">,</span><span class="mi">44</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
</span><span class='line'>  <span class="nl">f8:</span>   <span class="mf">8f</span><span class="n">b30028</span>    <span class="n">lw</span>  <span class="n">s3</span><span class="p">,</span><span class="mi">40</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
</span><span class='line'>  <span class="nl">fc:</span>   <span class="n">afb30018</span>    <span class="n">sw</span>  <span class="n">s3</span><span class="p">,</span><span class="mi">24</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
</span><span class='line'><span class="mi">100</span><span class="o">:</span>   <span class="n">afb1001c</span>    <span class="n">sw</span>  <span class="n">s1</span><span class="p">,</span><span class="mi">28</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
</span><span class='line'><span class="mi">104</span><span class="o">:</span>   <span class="mf">8f</span><span class="n">ae0018</span>    <span class="n">lw</span>  <span class="n">t6</span><span class="p">,</span><span class="mi">24</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
</span><span class='line'><span class="mi">108</span><span class="o">:</span>   <span class="mf">8f</span><span class="n">af001c</span>    <span class="n">lw</span>  <span class="n">t7</span><span class="p">,</span><span class="mi">28</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
</span><span class='line'><span class="mi">10</span><span class="n">c</span><span class="o">:</span>   <span class="mf">8f</span><span class="n">a50030</span>    <span class="n">lw</span>  <span class="n">a1</span><span class="p">,</span><span class="mi">48</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
</span><span class='line'><span class="mi">110</span><span class="o">:</span>   <span class="mf">000e703</span><span class="n">c</span>    <span class="n">dsll32</span>  <span class="n">t6</span><span class="p">,</span><span class="n">t6</span><span class="p">,</span><span class="mh">0x0</span>
</span><span class='line'><span class="mi">114</span><span class="o">:</span>   <span class="mf">000f</span><span class="mi">783</span><span class="n">c</span>    <span class="n">dsll32</span>  <span class="n">t7</span><span class="p">,</span><span class="n">t7</span><span class="p">,</span><span class="mh">0x0</span>
</span><span class='line'><span class="mi">118</span><span class="o">:</span>   <span class="mf">000f</span><span class="mi">783</span><span class="n">e</span>    <span class="n">dsrl32</span>  <span class="n">t7</span><span class="p">,</span><span class="n">t7</span><span class="p">,</span><span class="mh">0x0</span>
</span><span class='line'><span class="mi">11</span><span class="n">c</span><span class="o">:</span>   <span class="mo">01</span><span class="n">cf7025</span>    <span class="n">or</span>  <span class="n">t6</span><span class="p">,</span><span class="n">t6</span><span class="p">,</span><span class="n">t7</span>
</span><span class='line'><span class="mi">120</span><span class="o">:</span>   <span class="mo">00052</span><span class="mi">83</span><span class="n">c</span>    <span class="n">dsll32</span>  <span class="n">a1</span><span class="p">,</span><span class="n">a1</span><span class="p">,</span><span class="mh">0x0</span>
</span><span class='line'><span class="mi">124</span><span class="o">:</span>   <span class="mo">00052</span><span class="mi">83</span><span class="n">e</span>    <span class="n">dsrl32</span>  <span class="n">a1</span><span class="p">,</span><span class="n">a1</span><span class="p">,</span><span class="mh">0x0</span>
</span><span class='line'><span class="mi">128</span><span class="o">:</span>   <span class="n">fcae0000</span>    <span class="n">sd</span>  <span class="n">t6</span><span class="p">,</span><span class="mi">0</span><span class="p">(</span><span class="n">a1</span><span class="p">)</span>
</span><span class='line'><span class="mi">12</span><span class="n">c</span><span class="o">:</span>   <span class="mf">8f</span><span class="mi">990000</span>    <span class="n">lw</span>  <span class="n">t9</span><span class="p">,</span><span class="mi">0</span><span class="p">(</span><span class="n">gp</span><span class="p">)</span>
</span><span class='line'><span class="mi">130</span><span class="o">:</span>   <span class="mf">0320f</span><span class="mi">809</span>    <span class="n">jalr</span>    <span class="n">t9</span>
</span><span class='line'><span class="mi">134</span><span class="o">:</span>   <span class="mf">0000f</span><span class="mo">021</span>    <span class="n">move</span>    <span class="n">s8</span><span class="p">,</span><span class="n">zero</span>
</span><span class='line'><span class="mi">138</span><span class="o">:</span>   <span class="mf">8f</span><span class="n">bc0010</span>    <span class="n">lw</span>  <span class="n">gp</span><span class="p">,</span><span class="mi">16</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
</span><span class='line'><span class="mi">13</span><span class="n">c</span><span class="o">:</span>   <span class="mf">8f</span><span class="mi">990000</span>    <span class="n">lw</span>  <span class="n">t9</span><span class="p">,</span><span class="mi">0</span><span class="p">(</span><span class="n">gp</span><span class="p">)</span>
</span><span class='line'><span class="mi">140</span><span class="o">:</span>   <span class="mf">0320f</span><span class="mi">809</span>    <span class="n">jalr</span>    <span class="n">t9</span>
</span><span class='line'><span class="mi">144</span><span class="o">:</span>   <span class="mo">0040</span><span class="mi">8021</span>    <span class="n">move</span>    <span class="n">s0</span><span class="p">,</span><span class="n">v0</span>
</span><span class='line'><span class="mi">148</span><span class="o">:</span>   <span class="mf">8f</span><span class="n">bc0010</span>    <span class="n">lw</span>  <span class="n">gp</span><span class="p">,</span><span class="mi">16</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
</span><span class='line'><span class="mi">14</span><span class="n">c</span><span class="o">:</span>   <span class="n">afb00044</span>    <span class="n">sw</span>  <span class="n">s0</span><span class="p">,</span><span class="mi">68</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
</span><span class='line'><span class="mi">150</span><span class="o">:</span>   <span class="mo">001067</span><span class="n">c3</span>    <span class="n">sra</span> <span class="n">t4</span><span class="p">,</span><span class="n">s0</span><span class="p">,</span><span class="mh">0x1f</span>
</span><span class='line'><span class="mi">154</span><span class="o">:</span>   <span class="n">afac0040</span>    <span class="n">sw</span>  <span class="n">t4</span><span class="p">,</span><span class="mi">64</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
</span><span class='line'><span class="mi">158</span><span class="o">:</span>   <span class="mf">8f</span><span class="n">ab0044</span>    <span class="n">lw</span>  <span class="n">t3</span><span class="p">,</span><span class="mi">68</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
</span><span class='line'><span class="mi">15</span><span class="n">c</span><span class="o">:</span>   <span class="n">afab0048</span>    <span class="n">sw</span>  <span class="n">t3</span><span class="p">,</span><span class="mi">72</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
</span><span class='line'><span class="mi">160</span><span class="o">:</span>   <span class="mo">00005021</span>    <span class="n">move</span>    <span class="n">t2</span><span class="p">,</span><span class="n">zero</span>
</span><span class='line'><span class="mi">164</span><span class="o">:</span>   <span class="n">afaa004c</span>    <span class="n">sw</span>  <span class="n">t2</span><span class="p">,</span><span class="mi">76</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
</span><span class='line'><span class="mi">168</span><span class="o">:</span>   <span class="mf">8f</span><span class="n">a60048</span>    <span class="n">lw</span>  <span class="n">a2</span><span class="p">,</span><span class="mi">72</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
</span><span class='line'><span class="mi">16</span><span class="n">c</span><span class="o">:</span>   <span class="n">afa20054</span>    <span class="n">sw</span>  <span class="n">v0</span><span class="p">,</span><span class="mi">84</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
</span><span class='line'><span class="mi">170</span><span class="o">:</span>   <span class="mo">000247</span><span class="n">c3</span>    <span class="n">sra</span> <span class="n">t0</span><span class="p">,</span><span class="n">v0</span><span class="p">,</span><span class="mh">0x1f</span>
</span><span class='line'><span class="mi">174</span><span class="o">:</span>   <span class="n">afa80050</span>    <span class="n">sw</span>  <span class="n">t0</span><span class="p">,</span><span class="mi">80</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
</span><span class='line'><span class="mi">178</span><span class="o">:</span>   <span class="mf">8f</span><span class="n">a30054</span>    <span class="n">lw</span>  <span class="n">v1</span><span class="p">,</span><span class="mi">84</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
</span><span class='line'><span class="mi">17</span><span class="n">c</span><span class="o">:</span>   <span class="mf">8f</span><span class="n">a70050</span>    <span class="n">lw</span>  <span class="n">a3</span><span class="p">,</span><span class="mi">80</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
</span><span class='line'><span class="mi">180</span><span class="o">:</span>   <span class="mo">00</span><span class="n">c72025</span>    <span class="n">or</span>  <span class="n">a0</span><span class="p">,</span><span class="n">a2</span><span class="p">,</span><span class="n">a3</span>
</span><span class='line'><span class="mi">184</span><span class="o">:</span>   <span class="n">afa40020</span>    <span class="n">sw</span>  <span class="n">a0</span><span class="p">,</span><span class="mi">32</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
</span><span class='line'><span class="mi">188</span><span class="o">:</span>   <span class="mf">8f</span><span class="n">a5004c</span>    <span class="n">lw</span>  <span class="n">a1</span><span class="p">,</span><span class="mi">76</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
</span><span class='line'><span class="mi">18</span><span class="n">c</span><span class="o">:</span>   <span class="mo">00</span><span class="n">a31025</span>    <span class="n">or</span>  <span class="n">v0</span><span class="p">,</span><span class="n">a1</span><span class="p">,</span><span class="n">v1</span>
</span><span class='line'><span class="mi">190</span><span class="o">:</span>   <span class="n">afa20024</span>    <span class="n">sw</span>  <span class="n">v0</span><span class="p">,</span><span class="mi">36</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
</span><span class='line'><span class="mi">194</span><span class="o">:</span>   <span class="mf">8f</span><span class="n">bf0020</span>    <span class="n">lw</span>  <span class="n">ra</span><span class="p">,</span><span class="mi">32</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
</span><span class='line'><span class="mi">198</span><span class="o">:</span>   <span class="n">afbf005c</span>    <span class="n">sw</span>  <span class="n">ra</span><span class="p">,</span><span class="mi">92</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
</span><span class='line'><span class="mi">19</span><span class="n">c</span><span class="o">:</span>   <span class="n">afbe0058</span>    <span class="n">sw</span>  <span class="n">s8</span><span class="p">,</span><span class="mi">88</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
</span><span class='line'><span class="mi">1</span><span class="n">a0</span><span class="o">:</span>   <span class="mf">8f</span><span class="n">b8005c</span>    <span class="n">lw</span>  <span class="n">t8</span><span class="p">,</span><span class="mi">92</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
</span><span class='line'><span class="mi">1</span><span class="n">a4</span><span class="o">:</span>   <span class="n">afb80018</span>    <span class="n">sw</span>  <span class="n">t8</span><span class="p">,</span><span class="mi">24</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
</span><span class='line'><span class="mi">1</span><span class="n">a8</span><span class="o">:</span>   <span class="mf">8f</span><span class="n">b70024</span>    <span class="n">lw</span>  <span class="n">s7</span><span class="p">,</span><span class="mi">36</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
</span><span class='line'> <span class="mi">1</span><span class="n">ac</span><span class="o">:</span>   <span class="n">afb7001c</span>    <span class="n">sw</span>  <span class="n">s7</span><span class="p">,</span><span class="mi">28</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
</span><span class='line'><span class="mi">1</span><span class="n">b0</span><span class="o">:</span>   <span class="mf">8f</span><span class="n">b50018</span>    <span class="n">lw</span>  <span class="n">s5</span><span class="p">,</span><span class="mi">24</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
</span><span class='line'><span class="mi">1</span><span class="n">b4</span><span class="o">:</span>   <span class="mf">8f</span><span class="n">b6001c</span>    <span class="n">lw</span>  <span class="n">s6</span><span class="p">,</span><span class="mi">28</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
</span><span class='line'><span class="mi">1</span><span class="n">b8</span><span class="o">:</span>   <span class="mf">8f</span><span class="n">a40030</span>    <span class="n">lw</span>  <span class="n">a0</span><span class="p">,</span><span class="mi">48</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
</span><span class='line'><span class="mi">1</span><span class="n">bc</span><span class="o">:</span>   <span class="mo">0015</span><span class="n">a83c</span>    <span class="n">dsll32</span>  <span class="n">s5</span><span class="p">,</span><span class="n">s5</span><span class="p">,</span><span class="mh">0x0</span>
</span><span class='line'><span class="mi">1</span><span class="n">c0</span><span class="o">:</span>   <span class="mo">0016</span><span class="n">b03c</span>    <span class="n">dsll32</span>  <span class="n">s6</span><span class="p">,</span><span class="n">s6</span><span class="p">,</span><span class="mh">0x0</span>
</span><span class='line'><span class="mi">1</span><span class="n">c4</span><span class="o">:</span>   <span class="mo">0016</span><span class="n">b03e</span>    <span class="n">dsrl32</span>  <span class="n">s6</span><span class="p">,</span><span class="n">s6</span><span class="p">,</span><span class="mh">0x0</span>
</span><span class='line'><span class="mi">1</span><span class="n">c8</span><span class="o">:</span>   <span class="mo">02</span><span class="n">b6a825</span>    <span class="n">or</span>  <span class="n">s5</span><span class="p">,</span><span class="n">s5</span><span class="p">,</span><span class="n">s6</span>
</span><span class='line'><span class="mi">1</span><span class="n">cc</span><span class="o">:</span>   <span class="mo">0004203</span><span class="n">c</span>    <span class="n">dsll32</span>  <span class="n">a0</span><span class="p">,</span><span class="n">a0</span><span class="p">,</span><span class="mh">0x0</span>
</span><span class='line'><span class="mi">1</span><span class="n">d0</span><span class="o">:</span>   <span class="mo">0004203</span><span class="n">e</span>    <span class="n">dsrl32</span>  <span class="n">a0</span><span class="p">,</span><span class="n">a0</span><span class="p">,</span><span class="mh">0x0</span>
</span><span class='line'><span class="mi">1</span><span class="n">d4</span><span class="o">:</span>   <span class="n">fc950000</span>    <span class="n">sd</span>  <span class="n">s5</span><span class="p">,</span><span class="mi">0</span><span class="p">(</span><span class="n">a0</span><span class="p">)</span>
</span><span class='line'><span class="mi">1</span><span class="n">d8</span><span class="o">:</span>   <span class="mf">8f</span><span class="mi">990000</span>    <span class="n">lw</span>  <span class="n">t9</span><span class="p">,</span><span class="mi">0</span><span class="p">(</span><span class="n">gp</span><span class="p">)</span>
</span><span class='line'><span class="mi">1</span><span class="n">dc</span><span class="o">:</span>   <span class="mf">0320f</span><span class="mi">809</span>    <span class="n">jalr</span>    <span class="n">t9</span>
</span><span class='line'><span class="mf">1e0</span><span class="o">:</span>   <span class="mo">0000</span><span class="mi">8021</span>    <span class="n">move</span>    <span class="n">s0</span><span class="p">,</span><span class="n">zero</span>
</span><span class='line'><span class="mf">1e4</span><span class="o">:</span>   <span class="mf">8f</span><span class="n">bc0010</span>    <span class="n">lw</span>  <span class="n">gp</span><span class="p">,</span><span class="mi">16</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
</span><span class='line'><span class="mf">1e8</span><span class="o">:</span>   <span class="mf">8f</span><span class="mi">990000</span>    <span class="n">lw</span>  <span class="n">t9</span><span class="p">,</span><span class="mi">0</span><span class="p">(</span><span class="n">gp</span><span class="p">)</span>
</span><span class='line'><span class="mi">1</span><span class="n">ec</span><span class="o">:</span>   <span class="mf">0320f</span><span class="mi">809</span>    <span class="n">jalr</span>    <span class="n">t9</span>
</span><span class='line'><span class="mf">1f</span><span class="mi">0</span><span class="o">:</span>   <span class="mo">0040</span><span class="mi">9821</span>    <span class="n">move</span>    <span class="n">s3</span><span class="p">,</span><span class="n">v0</span>
</span><span class='line'><span class="mf">1f</span><span class="mi">4</span><span class="o">:</span>   <span class="mf">8f</span><span class="n">bc0010</span>    <span class="n">lw</span>  <span class="n">gp</span><span class="p">,</span><span class="mi">16</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
</span><span class='line'><span class="mf">1f</span><span class="mi">8</span><span class="o">:</span>   <span class="n">afb30064</span>    <span class="n">sw</span>  <span class="n">s3</span><span class="p">,</span><span class="mi">100</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
</span><span class='line'><span class="mf">1f</span><span class="n">c</span><span class="o">:</span>   <span class="mo">0013</span><span class="mi">97</span><span class="n">c3</span>    <span class="n">sra</span> <span class="n">s2</span><span class="p">,</span><span class="n">s3</span><span class="p">,</span><span class="mh">0x1f</span>
</span><span class='line'><span class="mi">200</span><span class="o">:</span>   <span class="n">afb20060</span>    <span class="n">sw</span>  <span class="n">s2</span><span class="p">,</span><span class="mi">96</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
</span><span class='line'><span class="mi">204</span><span class="o">:</span>   <span class="mf">8f</span><span class="n">b10064</span>    <span class="n">lw</span>  <span class="n">s1</span><span class="p">,</span><span class="mi">100</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
</span><span class='line'><span class="mi">208</span><span class="o">:</span>   <span class="n">afb10068</span>    <span class="n">sw</span>  <span class="n">s1</span><span class="p">,</span><span class="mi">104</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
</span><span class='line'><span class="mi">20</span><span class="n">c</span><span class="o">:</span>   <span class="n">afb0006c</span>    <span class="n">sw</span>  <span class="n">s0</span><span class="p">,</span><span class="mi">108</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
</span><span class='line'><span class="mi">210</span><span class="o">:</span>   <span class="mf">8f</span><span class="n">ac0068</span>    <span class="n">lw</span>  <span class="n">t4</span><span class="p">,</span><span class="mi">104</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
</span><span class='line'><span class="mi">214</span><span class="o">:</span>   <span class="n">afa20074</span>    <span class="n">sw</span>  <span class="n">v0</span><span class="p">,</span><span class="mi">116</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
</span><span class='line'><span class="mi">218</span><span class="o">:</span>   <span class="mo">000277</span><span class="n">c3</span>    <span class="n">sra</span> <span class="n">t6</span><span class="p">,</span><span class="n">v0</span><span class="p">,</span><span class="mh">0x1f</span>
</span><span class='line'><span class="mi">21</span><span class="n">c</span><span class="o">:</span>   <span class="n">afae0070</span>    <span class="n">sw</span>  <span class="n">t6</span><span class="p">,</span><span class="mi">112</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
</span><span class='line'><span class="mi">220</span><span class="o">:</span>   <span class="mf">8f</span><span class="n">aa0074</span>    <span class="n">lw</span>  <span class="n">t2</span><span class="p">,</span><span class="mi">116</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
</span><span class='line'><span class="mi">224</span><span class="o">:</span>   <span class="mf">8f</span><span class="n">ad0070</span>    <span class="n">lw</span>  <span class="n">t5</span><span class="p">,</span><span class="mi">112</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
</span><span class='line'><span class="mi">228</span><span class="o">:</span>   <span class="mo">01</span><span class="mi">8</span><span class="n">d5825</span>    <span class="n">or</span>  <span class="n">t3</span><span class="p">,</span><span class="n">t4</span><span class="p">,</span><span class="n">t5</span>
</span><span class='line'> <span class="mi">22</span><span class="n">c</span><span class="o">:</span>   <span class="n">afab0038</span>    <span class="n">sw</span>  <span class="n">t3</span><span class="p">,</span><span class="mi">56</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
</span><span class='line'><span class="mi">230</span><span class="o">:</span>   <span class="mf">8f</span><span class="n">a9006c</span>    <span class="n">lw</span>  <span class="n">t1</span><span class="p">,</span><span class="mi">108</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
</span><span class='line'><span class="mi">234</span><span class="o">:</span>   <span class="mo">012</span><span class="n">a4025</span>    <span class="n">or</span>  <span class="n">t0</span><span class="p">,</span><span class="n">t1</span><span class="p">,</span><span class="n">t2</span>
</span><span class='line'><span class="mi">238</span><span class="o">:</span>   <span class="n">afa8003c</span>    <span class="n">sw</span>  <span class="n">t0</span><span class="p">,</span><span class="mi">60</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
</span><span class='line'><span class="mi">23</span><span class="n">c</span><span class="o">:</span>   <span class="mf">8f</span><span class="n">a70038</span>    <span class="n">lw</span>  <span class="n">a3</span><span class="p">,</span><span class="mi">56</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
</span><span class='line'><span class="mi">240</span><span class="o">:</span>   <span class="n">afa7007c</span>    <span class="n">sw</span>  <span class="n">a3</span><span class="p">,</span><span class="mi">124</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
</span><span class='line'><span class="mi">244</span><span class="o">:</span>   <span class="mo">00003021</span>    <span class="n">move</span>    <span class="n">a2</span><span class="p">,</span><span class="n">zero</span>
</span><span class='line'><span class="mi">248</span><span class="o">:</span>   <span class="n">afa60078</span>    <span class="n">sw</span>  <span class="n">a2</span><span class="p">,</span><span class="mi">120</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
</span><span class='line'><span class="mi">24</span><span class="n">c</span><span class="o">:</span>   <span class="mf">8f</span><span class="n">a4007c</span>    <span class="n">lw</span>  <span class="n">a0</span><span class="p">,</span><span class="mi">124</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
</span><span class='line'><span class="mi">250</span><span class="o">:</span>   <span class="n">afa40018</span>    <span class="n">sw</span>  <span class="n">a0</span><span class="p">,</span><span class="mi">24</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
</span><span class='line'><span class="mi">254</span><span class="o">:</span>   <span class="mf">8f</span><span class="n">a5003c</span>    <span class="n">lw</span>  <span class="n">a1</span><span class="p">,</span><span class="mi">60</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
</span><span class='line'><span class="mi">258</span><span class="o">:</span>   <span class="n">afa5001c</span>    <span class="n">sw</span>  <span class="n">a1</span><span class="p">,</span><span class="mi">28</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
</span><span class='line'><span class="mi">25</span><span class="n">c</span><span class="o">:</span>   <span class="mf">8f</span><span class="n">a30018</span>    <span class="n">lw</span>  <span class="n">v1</span><span class="p">,</span><span class="mi">24</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
</span><span class='line'><span class="mi">260</span><span class="o">:</span>   <span class="mf">8f</span><span class="n">a2001c</span>    <span class="n">lw</span>  <span class="n">v0</span><span class="p">,</span><span class="mi">28</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
</span><span class='line'><span class="mi">264</span><span class="o">:</span>   <span class="mf">8f</span><span class="n">a40030</span>    <span class="n">lw</span>  <span class="n">a0</span><span class="p">,</span><span class="mi">48</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
</span><span class='line'><span class="mi">268</span><span class="o">:</span>   <span class="mo">00031</span><span class="mi">83</span><span class="n">c</span>    <span class="n">dsll32</span>  <span class="n">v1</span><span class="p">,</span><span class="n">v1</span><span class="p">,</span><span class="mh">0x0</span>
</span><span class='line'><span class="mi">26</span><span class="n">c</span><span class="o">:</span>   <span class="mo">0002103</span><span class="n">c</span>    <span class="n">dsll32</span>  <span class="n">v0</span><span class="p">,</span><span class="n">v0</span><span class="p">,</span><span class="mh">0x0</span>
</span><span class='line'><span class="mi">270</span><span class="o">:</span>   <span class="mo">0002103</span><span class="n">e</span>    <span class="n">dsrl32</span>  <span class="n">v0</span><span class="p">,</span><span class="n">v0</span><span class="p">,</span><span class="mh">0x0</span>
</span><span class='line'><span class="mi">274</span><span class="o">:</span>   <span class="mo">00621</span><span class="mi">825</span>    <span class="n">or</span>  <span class="n">v1</span><span class="p">,</span><span class="n">v1</span><span class="p">,</span><span class="n">v0</span>
</span><span class='line'><span class="mi">278</span><span class="o">:</span>   <span class="mo">0004203</span><span class="n">c</span>    <span class="n">dsll32</span>  <span class="n">a0</span><span class="p">,</span><span class="n">a0</span><span class="p">,</span><span class="mh">0x0</span>
</span><span class='line'><span class="mi">27</span><span class="n">c</span><span class="o">:</span>   <span class="mo">0004203</span><span class="n">e</span>    <span class="n">dsrl32</span>  <span class="n">a0</span><span class="p">,</span><span class="n">a0</span><span class="p">,</span><span class="mh">0x0</span>
</span><span class='line'><span class="mi">280</span><span class="o">:</span>   <span class="n">fc830000</span>    <span class="n">sd</span>  <span class="n">v1</span><span class="p">,</span><span class="mi">0</span><span class="p">(</span><span class="n">a0</span><span class="p">)</span>
</span><span class='line'><span class="mi">284</span><span class="o">:</span>   <span class="mo">00001021</span>    <span class="n">move</span>    <span class="n">v0</span><span class="p">,</span><span class="n">zero</span>
</span><span class='line'><span class="mi">288</span><span class="o">:</span>   <span class="mf">8f</span><span class="n">bf00a4</span>    <span class="n">lw</span>  <span class="n">ra</span><span class="p">,</span><span class="mi">164</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
</span><span class='line'><span class="mi">28</span><span class="n">c</span><span class="o">:</span>   <span class="mf">8f</span><span class="n">be00a0</span>    <span class="n">lw</span>  <span class="n">s8</span><span class="p">,</span><span class="mi">160</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
</span><span class='line'><span class="mi">290</span><span class="o">:</span>   <span class="mf">8f</span><span class="n">b7009c</span>    <span class="n">lw</span>  <span class="n">s7</span><span class="p">,</span><span class="mi">156</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
</span><span class='line'><span class="mi">294</span><span class="o">:</span>   <span class="mf">8f</span><span class="n">b60098</span>    <span class="n">lw</span>  <span class="n">s6</span><span class="p">,</span><span class="mi">152</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
</span><span class='line'><span class="mi">298</span><span class="o">:</span>   <span class="mf">8f</span><span class="n">b50094</span>    <span class="n">lw</span>  <span class="n">s5</span><span class="p">,</span><span class="mi">148</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
</span><span class='line'><span class="mi">29</span><span class="n">c</span><span class="o">:</span>   <span class="mf">8f</span><span class="n">b40090</span>    <span class="n">lw</span>  <span class="n">s4</span><span class="p">,</span><span class="mi">144</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
</span><span class='line'><span class="mi">2</span><span class="n">a0</span><span class="o">:</span>   <span class="mf">8f</span><span class="n">b3008c</span>    <span class="n">lw</span>  <span class="n">s3</span><span class="p">,</span><span class="mi">140</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
</span><span class='line'><span class="mi">2</span><span class="n">a4</span><span class="o">:</span>   <span class="mf">8f</span><span class="n">b20088</span>    <span class="n">lw</span>  <span class="n">s2</span><span class="p">,</span><span class="mi">136</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
</span><span class='line'><span class="mi">2</span><span class="n">a8</span><span class="o">:</span>   <span class="mf">8f</span><span class="n">b10084</span>    <span class="n">lw</span>  <span class="n">s1</span><span class="p">,</span><span class="mi">132</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
</span><span class='line'><span class="mi">2</span><span class="n">ac</span><span class="o">:</span>   <span class="mf">8f</span><span class="n">b00080</span>    <span class="n">lw</span>  <span class="n">s0</span><span class="p">,</span><span class="mi">128</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
</span><span class='line'><span class="mi">2</span><span class="n">b0</span><span class="o">:</span>   <span class="mf">03e00008</span>    <span class="n">jr</span>  <span class="n">ra</span>
</span><span class='line'><span class="mi">2</span><span class="n">b4</span><span class="o">:</span>   <span class="mi">27</span><span class="n">bd00a8</span>    <span class="n">addiu</span>   <span class="n">sp</span><span class="p">,</span><span class="n">sp</span><span class="p">,</span><span class="mi">168</span>
</span></code></pre></td></tr></table></div></figure>


<p>可以看到，栈空间一下子由56增加到了168，即增加了112字节这么大的空间！
我们就来分析下这112字节的空间是怎么产生的。<br/>
<1>从汇编代码来看，变量val_high和val_lo仍然是存储在24(sp)和28(sp)这部分内存空间。但是同时也生成了大量的临时变量。<br/>
比如i为1时被展开的循环体：<br/>
<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='c'><span class='line'><span class="nl">f4:</span>   <span class="mf">8f</span><span class="n">b1002c</span>    <span class="n">lw</span>  <span class="n">s1</span><span class="p">,</span><span class="mi">44</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
</span><span class='line'>  <span class="n">f8</span><span class="o">:</span>   <span class="mf">8f</span><span class="n">b30028</span>    <span class="n">lw</span>  <span class="n">s3</span><span class="p">,</span><span class="mi">40</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
</span><span class='line'>  <span class="n">fc</span><span class="o">:</span>   <span class="n">afb30018</span>    <span class="n">sw</span>  <span class="n">s3</span><span class="p">,</span><span class="mi">24</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
</span><span class='line'><span class="mi">100</span><span class="o">:</span>   <span class="n">afb1001c</span>    <span class="n">sw</span>  <span class="n">s1</span><span class="p">,</span><span class="mi">28</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>
可以看到至少新增了44(sp)和40(sp)这两个临时变量。<br/>
i为2时被展开的循环体：<br/>
<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='c'><span class='line'><span class="mi">1</span><span class="n">a0</span><span class="o">:</span>   <span class="mf">8f</span><span class="n">b8005c</span>    <span class="n">lw</span>  <span class="n">t8</span><span class="p">,</span><span class="mi">92</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
</span><span class='line'><span class="mi">1</span><span class="n">a4</span><span class="o">:</span>   <span class="n">afb80018</span>    <span class="n">sw</span>  <span class="n">t8</span><span class="p">,</span><span class="mi">24</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
</span><span class='line'><span class="mi">1</span><span class="n">a8</span><span class="o">:</span>   <span class="mf">8f</span><span class="n">b70024</span>    <span class="n">lw</span>  <span class="n">s7</span><span class="p">,</span><span class="mi">36</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
</span><span class='line'> <span class="mi">1</span><span class="n">ac</span><span class="o">:</span>   <span class="n">afb7001c</span>    <span class="n">sw</span>  <span class="n">s7</span><span class="p">,</span><span class="mi">28</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>
 至少新增了36(sp)和92(sp)这两个临时变量。 <br/>
i为3时被展开的循环体：<br/>
<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='c'><span class='line'><span class="mi">24</span><span class="n">c</span><span class="o">:</span>   <span class="mf">8f</span><span class="n">a4007c</span>    <span class="n">lw</span>  <span class="n">a0</span><span class="p">,</span><span class="mi">124</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
</span><span class='line'><span class="mi">250</span><span class="o">:</span>   <span class="n">afa40018</span>    <span class="n">sw</span>  <span class="n">a0</span><span class="p">,</span><span class="mi">24</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
</span><span class='line'><span class="mi">254</span><span class="o">:</span>   <span class="mf">8f</span><span class="n">a5003c</span>    <span class="n">lw</span>  <span class="n">a1</span><span class="p">,</span><span class="mi">60</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
</span><span class='line'><span class="mi">258</span><span class="o">:</span>   <span class="n">afa5001c</span>    <span class="n">sw</span>  <span class="n">a1</span><span class="p">,</span><span class="mi">28</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>
至少新增了60(sp)和124(sp)这两个临时变量。 <br/>
注意这里不是参数入栈和出栈，因为这里是inline，不是函数调用。增加的这六个临时变量都是因为atomic_write64这个inline函数里定义了局部变量，他们其实是为了服务于那两个局部变量。<br/>
<2>再来看变量x <br/>
<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='c'><span class='line'><span class="mi">140</span><span class="o">:</span>   <span class="mf">0320f</span><span class="mi">809</span>    <span class="n">jalr</span>    <span class="n">t9</span>
</span><span class='line'><span class="mi">144</span><span class="o">:</span>   <span class="mo">0040</span><span class="mi">8021</span>    <span class="n">move</span>    <span class="n">s0</span><span class="p">,</span><span class="n">v0</span>
</span><span class='line'><span class="mi">148</span><span class="o">:</span>   <span class="mf">8f</span><span class="n">bc0010</span>    <span class="n">lw</span>  <span class="n">gp</span><span class="p">,</span><span class="mi">16</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
</span><span class='line'><span class="mi">14</span><span class="n">c</span><span class="o">:</span>   <span class="n">afb00044</span>    <span class="n">sw</span>  <span class="n">s0</span><span class="p">,</span><span class="mi">68</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>
可以看到这里新增加了一个临时变量68(sp)用来存储random()函数的返回值。<br/>
这也是在前面使用“4:   afa40044    sw  a0,68(sp)”来初始化该临时变量的原因。<br/>
<3>循环展开后i值不同的循环体使用不同的$sn寄存器 <br/>
用到这些寄存器，就需要在函数开始将该寄存器压栈，然后在函数结束时出栈。<br/>
<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='c'><span class='line'>  <span class="mi">14</span><span class="o">:</span>   <span class="n">afbe00a0</span>    <span class="n">sw</span>  <span class="n">s8</span><span class="p">,</span><span class="mi">160</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
</span><span class='line'>  <span class="mi">18</span><span class="o">:</span>   <span class="n">afb7009c</span>    <span class="n">sw</span>  <span class="n">s7</span><span class="p">,</span><span class="mi">156</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
</span><span class='line'>  <span class="mi">1</span><span class="n">c</span><span class="o">:</span>   <span class="n">afb60098</span>    <span class="n">sw</span>  <span class="n">s6</span><span class="p">,</span><span class="mi">152</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
</span><span class='line'>  <span class="mi">20</span><span class="o">:</span>   <span class="n">afb50094</span>    <span class="n">sw</span>  <span class="n">s5</span><span class="p">,</span><span class="mi">148</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
</span><span class='line'>  <span class="mi">24</span><span class="o">:</span>   <span class="n">afb40090</span>    <span class="n">sw</span>  <span class="n">s4</span><span class="p">,</span><span class="mi">144</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
</span><span class='line'>  <span class="mi">28</span><span class="o">:</span>   <span class="n">afb3008c</span>    <span class="n">sw</span>  <span class="n">s3</span><span class="p">,</span><span class="mi">140</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
</span><span class='line'><span class="err">…</span>
</span><span class='line'><span class="mi">28</span><span class="n">c</span><span class="o">:</span>   <span class="mf">8f</span><span class="n">be00a0</span>    <span class="n">lw</span>  <span class="n">s8</span><span class="p">,</span><span class="mi">160</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
</span><span class='line'><span class="mi">290</span><span class="o">:</span>   <span class="mf">8f</span><span class="n">b7009c</span>    <span class="n">lw</span>  <span class="n">s7</span><span class="p">,</span><span class="mi">156</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
</span><span class='line'><span class="mi">294</span><span class="o">:</span>   <span class="mf">8f</span><span class="n">b60098</span>    <span class="n">lw</span>  <span class="n">s6</span><span class="p">,</span><span class="mi">152</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
</span><span class='line'><span class="mi">298</span><span class="o">:</span>   <span class="mf">8f</span><span class="n">b50094</span>    <span class="n">lw</span>  <span class="n">s5</span><span class="p">,</span><span class="mi">148</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
</span><span class='line'><span class="mi">29</span><span class="n">c</span><span class="o">:</span>   <span class="mf">8f</span><span class="n">b40090</span>    <span class="n">lw</span>  <span class="n">s4</span><span class="p">,</span><span class="mi">144</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>
新增的这些临时变量和对过多寄存器的使用增加了栈空间，而且入栈出栈也很消耗CPU cycles，因为这涉及到读写内存。 </p>


<p>由此我们可以得到一个初步结论，在unroll-loops的过程中，如果产生了额外的临时变量，那么unroll loops就极有可能对性能造成伤害。 </p>


<p>继续来分析gcc的unroll loops的特性。以下的分析基于gcc的源码loop-unroll.c 。</p>


<p>由于这时TIMES仅为3，gcc可以将其完全展开，即peel_loop_completely，展开方式如下：</p>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='c'><span class='line'><span class="cm">/* </span>
</span><span class='line'><span class="cm">   Peel all iterations of LOOP, remove exit edges and cancel the loop</span>
</span><span class='line'><span class="cm">   completely.  The transformation done:</span>
</span><span class='line'><span class="cm">*/</span>
</span><span class='line'>   <span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
</span><span class='line'>     <span class="n">body</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// 展开为</span>
</span><span class='line'>   <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'>   <span class="n">body</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">;</span>
</span><span class='line'>   <span class="n">body</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">;</span>
</span><span class='line'>   <span class="n">body</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">;</span>
</span></code></pre></td></tr></table></div></figure>


<p>如果将TIMES增大到100，可以发现gcc并不会将循环体展开100次。循环展开多少次最好，在gcc unroll loops的设计者看来也是一个很难的问题，A great problem is that we don&#8217;t have a good way how to determine how many times we should unroll the loop; the experiments I have made showed that this choice may affect performance in order of several %. 因而unroll loops的设计着就定义了一些parameter来由程序员自行定义unroll规则。</p>


<p>这些参数有max-unrolled-insns，max-unroll-times，max-peeled-insns和max-peel-times等。用法大致如&#8211;param max-unroll-times=N，如果在使能funroll-loops或者fpeel-loops（如果使能了funroll-loops会同时使能fpeel-loops）后没有设置这些参数，就会使用gcc的默认值，具体参考params.def这个文件。 这些参数的具体含义可以去查阅gcc manual，不再赘述。只说下peel和unroll的区别，从英语语义上来讲，peel是剥离，unroll是摊开，在这里也是这个含义，peel是指从循环中给剥离出去，unroll则是仍然在循环体内。我们可以通过gcc的source code来看下这两者的区别。</p>


<p>gcc unroll-loops的入口函数是rtl_unroll_and_peel_loops，在这里它会去检查funroll-loops,fpeel-loops,funroll-all-loops这些开关。然后就会调用unroll loops的主要函数体unroll_and_peel_loops。</p>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class='c'><span class='line'> <span class="n">unroll_and_peel_loops</span>
</span><span class='line'>        <span class="cm">/* First perform complete loop peeling (it is almost surely a win,</span>
</span><span class='line'><span class="cm">           and affects parameters for further decision a lot).  */</span>
</span><span class='line'>        <span class="n">peel_loops_completely</span> <span class="p">(</span><span class="n">flags</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>        <span class="cm">/* Now decide rest of unrolling and peeling.  */</span>
</span><span class='line'>        <span class="n">decide_unrolling_and_peeling</span> <span class="p">(</span><span class="n">flags</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>          <span class="cm">/* Scan the loops, inner ones first.  */</span>
</span><span class='line'>        <span class="n">FOR_EACH_LOOP</span> <span class="p">(</span><span class="n">loop</span><span class="p">,</span> <span class="n">LI_FROM_INNERMOST</span><span class="p">)</span>
</span><span class='line'>         <span class="p">{</span>
</span><span class='line'>              <span class="p">...</span>
</span><span class='line'>         <span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>可以看到它首先做的就是尝试peel completely，如果不行，就再去选择unroll/peel策略，最后从最内侧循环开始unroll。 举个简单的例子，<br/>
<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class='c'><span class='line'>   <span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">102</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
</span><span class='line'>     <span class="n">body</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="c1">//展开为</span>
</span><span class='line'>   <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'>   <span class="n">body</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">;</span>
</span><span class='line'>   <span class="n">body</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">;</span>
</span><span class='line'>   <span class="k">while</span> <span class="p">(</span><span class="n">i</span> <span class="o">&lt;</span> <span class="mi">102</span><span class="p">)</span>
</span><span class='line'>     <span class="p">{</span>
</span><span class='line'>       <span class="n">body</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">;</span>
</span><span class='line'>       <span class="n">body</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">;</span>
</span><span class='line'>       <span class="n">body</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">;</span>
</span><span class='line'>       <span class="n">body</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">;</span>
</span><span class='line'>     <span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>
前两个body就是peel，后面while循环体内就是unroll。</p>


<p></p>

<p>总之就是，使用gcc的unroll需谨慎，如果循环次数在编译阶段就确定的，完全可以手动的展开，而不用gcc的unroll，当然展开的次数也是一个经验值，需要根据具体情况来定。对于运行时才能决定循环次数的，gcc也可以将其展开，展开方法大致如下：
<br/>
<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
</pre></td><td class='code'><pre><code class='c'><span class='line'>   <span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
</span><span class='line'>     <span class="n">body</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>   <span class="c1">// 展开为： </span>
</span><span class='line'>   <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'>   <span class="n">mod</span> <span class="o">=</span> <span class="n">n</span> <span class="o">%</span> <span class="mi">4</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>   <span class="k">switch</span> <span class="p">(</span><span class="n">mod</span><span class="p">)</span>
</span><span class='line'>     <span class="p">{</span>
</span><span class='line'>       <span class="k">case</span> <span class="mi">3</span>:
</span><span class='line'>         <span class="n">body</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">;</span>
</span><span class='line'>       <span class="k">case</span> <span class="mi">2</span>:
</span><span class='line'>         <span class="n">body</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">;</span>
</span><span class='line'>       <span class="k">case</span> <span class="mi">1</span>:
</span><span class='line'>         <span class="n">body</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">;</span>
</span><span class='line'>       <span class="k">case</span> <span class="mi">0</span>: <span class="p">;</span>
</span><span class='line'>     <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>   <span class="k">while</span> <span class="p">(</span><span class="n">i</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">)</span>
</span><span class='line'>     <span class="p">{</span>
</span><span class='line'>       <span class="n">body</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">;</span>
</span><span class='line'>       <span class="n">body</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">;</span>
</span><span class='line'>       <span class="n">body</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">;</span>
</span><span class='line'>       <span class="n">body</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">;</span>
</span><span class='line'>     <span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>
另外再说一句，unroll loops要在critical path才能体现出价值来，对于non-critical path，就不应该做unroll loops了。这也是gcc的funroll-loops的一个不足之处，它不知道哪里是critical哪里non-critical，对它而言代码是平等的（程序员主动告知编译器的例外，比如likely/unlikely），它会一视同仁的把所有该展开的都展开。也许编程语言日后的发展方向会是，根据运行时的情况来自动的调整可执行文件的布局，从而每执行一次就可以优化一次来让程序越来越快[3].</p>


<p></p>

<p>[1] MIPS支持3种ABI：O32/N32/N64,O32/N32的数据模型是ILP32，而N64是LP64，N32和O32的区别是N32的寄存器是64bit而O32的是32bit，N32使用64bits寄存器就要求栈要以8字节对齐。具体见<a href="http://math-atlas.sourceforge.net/devel/assembly/007-2816-005.pdf">http://math-atlas.sourceforge.net/devel/assembly/007-2816-005.pdf</a> <br/>
[2] 如果返回值是64bits,就会用到$v0和$v1这两个寄存器。对于一些高级编程语言比如Ruby，它可以有多个返回值，不过它实际上是返回的一个数组，数组里面有多个值，即本质上还是返回一个值。<br/>
[3] 支持元编程的语言，比如Ruby，可以在运行时来修改代码，但是它不是来调整代码段的布局。<br/></p>

		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2014-11-26T21:58:59+08:00" pubdate data-updated="true">Nov 26<span>th</span>, 2014</time></div>
	<div class="tags">

</div>
	
</div>
</article>  


   <article class="post">
	<h2 class="title">
		
		<a href="/blog/2014/08/31/ruby/">
		
			Ruby, 我的书有点乱</a>
	</h2>
	<div class="entry-content">
		<p>可能人到了三十而立的时候，就很少纯粹为了学习而学习了，因为已经没有太多的精力来浪费在那些花里胡哨的东西上。这个时候通常都是为了解决实际问题而去学习，这也像是找工作一样，刚毕业的人都是看潜力，工作几年之后就是看能不能尽快干活了。</p>


<p>我现在学习Ruby，也不是为了了解这个纯粹面向对象的东西到底是什么样子的，而是为了解决我面对的一些实际问题。比如说现在遇到的问题，自从买了Kindle后，我就隔三差五的会下载一些kindle电子书，有时候也会买一些，而我呢又是比较懒散的一个人，这样就搞的我的电子书有些乱，就那样胡乱的放着。这个时候你可能会说，花一点点时间整理一下不就好了嘛。嗯，那是因为你不是程序员。对于程序员而言，他们宁愿花很多时间写个程序来搞定。</p>


<p>因为对于程序员而言，手动操作是下三滥的勾当，它就像一个男人向别人承认自己阳痿一样难以接受。</p>


<p>在很多情况下，明明5分钟就能用手来搞定的事情，非得花几个小时写然后再花几天调最终还可能产生意料之外的错误的程序来做。这大致就是程序员碎了一地的节操吧。</p>


<p>我在网上下载以及从Amazon上买的电子书有以下几种情况让我心里有些许的不爽，可能是由于最近是处女座的日子，我也跟着有些强迫症起来。<br>
1. Life of Pi(少年pi的奇幻漂流） - Austin Lee.mobi<br>
我不喜欢名字里面有括号括起来的东西，而且这部分内容完全是重复的，我向纯粹一些，把括号里面的内容给删掉。<br>
2. Of Mice and Men (Penguin Classics)_B00CS74W6Q.azw3<br> 
Amazon上卖的书，书的编号（比如_B00CS74W6Q）是直接放在文件名字里面的，好在我不是处女座，所以对这个东西是可以接受的，而且觉得它挺好，可以用来区分哪些书是下载的哪些书是买的。我正好打算把下载的书和买的书给分开，所以这个东西就派上用场了。<br> 
3. 我下载的东西都是放在默认的Download目录里面，我想把他们都整理到Documents这个目录里面。<br>
所以我就写了个Ruby脚本来做这件事。其实，目前为止仍然困惑我的一件事情是，Ruby除了做脚本还能做什么呢？</p>


<p></p>

<p>这个<a href="https://github.com/laoar/bcleaner">Ruby脚本</a>很短小，所以就直接贴在这里了。</p>




<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">if</span> <span class="no">ARGV</span><span class="o">.</span><span class="n">size</span> <span class="o">!=</span>  <span class="mi">2</span>
</span><span class='line'>    <span class="nb">print</span> <span class="s2">&quot;usage: ./bcleaner.rb dst_path src_path</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span class='line'>    <span class="nb">exit</span> <span class="o">-</span><span class="mi">1</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="vg">$dst</span> <span class="o">=</span> <span class="no">ARGV</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span>
</span><span class='line'><span class="vg">$src</span> <span class="o">=</span> <span class="no">ARGV</span><span class="o">[</span><span class="mi">1</span><span class="o">]</span>
</span><span class='line'>
</span><span class='line'><span class="k">if</span> <span class="o">!</span><span class="no">Dir</span><span class="o">.</span><span class="n">exist?</span><span class="p">(</span><span class="vg">$src</span><span class="p">)</span> <span class="o">||</span> <span class="o">!</span><span class="no">Dir</span><span class="o">.</span><span class="n">exist?</span><span class="p">(</span><span class="vg">$dst</span><span class="p">)</span>
</span><span class='line'>    <span class="nb">puts</span> <span class="s2">&quot;No such Directory&quot;</span>
</span><span class='line'>    <span class="nb">exit</span> <span class="o">-</span><span class="mi">1</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="k">if</span> <span class="no">Dir</span><span class="o">.</span><span class="n">entries</span><span class="p">(</span><span class="vg">$src</span><span class="p">)</span> <span class="o">==</span> <span class="o">[</span><span class="s2">&quot;.&quot;</span><span class="p">,</span> <span class="s2">&quot;..&quot;</span><span class="p">,</span> <span class="s2">&quot;.DS_Store&quot;</span><span class="o">]</span> <span class="o">||</span> <span class="no">Dir</span><span class="o">.</span><span class="n">entries</span><span class="p">(</span><span class="vg">$src</span><span class="p">)</span> <span class="o">==</span> <span class="o">[</span><span class="s2">&quot;.&quot;</span><span class="p">,</span> <span class="s2">&quot;..&quot;</span><span class="o">]</span>
</span><span class='line'>    <span class="nb">printf</span> <span class="s2">&quot;%s is empty!</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="vg">$src</span>
</span><span class='line'>    <span class="nb">exit</span> <span class="o">-</span><span class="mi">1</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="k">if</span> <span class="o">!</span><span class="no">Dir</span><span class="o">.</span><span class="n">exist?</span><span class="p">(</span><span class="vg">$dst</span> <span class="o">+</span> <span class="s2">&quot;/purchased&quot;</span><span class="p">)</span>
</span><span class='line'>    <span class="no">Dir</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="vg">$dst</span> <span class="o">+</span> <span class="s2">&quot;/purchased&quot;</span><span class="p">)</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="no">Dir</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="vg">$src</span><span class="p">)</span>
</span><span class='line'><span class="vg">$hit</span> <span class="o">=</span> <span class="kp">false</span>
</span><span class='line'><span class="no">Dir</span><span class="o">.</span><span class="n">entries</span><span class="p">(</span><span class="vg">$src</span><span class="p">)</span><span class="o">.</span><span class="n">each</span><span class="p">{</span><span class="o">|</span><span class="n">x</span><span class="o">|</span>
</span><span class='line'>    <span class="n">y</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span><span class='line'>    <span class="k">for</span> <span class="n">i</span> <span class="k">in</span> <span class="mi">0</span><span class="o">.</span><span class="n">.</span><span class="o">.</span><span class="n">x</span><span class="o">.</span><span class="n">length</span>
</span><span class='line'>        <span class="k">if</span> <span class="n">x</span><span class="o">[</span><span class="n">i</span><span class="o">]</span> <span class="o">!=</span> <span class="s1">&#39;(&#39;</span> <span class="o">&amp;&amp;</span>  <span class="n">x</span><span class="o">[</span><span class="n">i</span><span class="o">]</span> <span class="o">!=</span> <span class="s1">&#39;（&#39;</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="vg">$hit</span>
</span><span class='line'>            <span class="n">y</span> <span class="o">+=</span> <span class="n">x</span><span class="o">[</span><span class="n">i</span><span class="o">]</span>
</span><span class='line'>        <span class="k">else</span>
</span><span class='line'>            <span class="vg">$hit</span> <span class="o">=</span> <span class="kp">true</span>
</span><span class='line'>            <span class="k">if</span> <span class="n">x</span><span class="o">[</span><span class="n">i</span><span class="o">]</span> <span class="o">==</span> <span class="s1">&#39;)&#39;</span> <span class="o">||</span> <span class="n">x</span><span class="o">[</span><span class="n">i</span><span class="o">]</span> <span class="o">==</span> <span class="s1">&#39;）&#39;</span> <span class="o">||</span> <span class="n">x</span><span class="o">[</span><span class="n">i</span><span class="o">]</span> <span class="o">==</span> <span class="s1">&#39;_&#39;</span>
</span><span class='line'>                <span class="vg">$hit</span> <span class="o">=</span> <span class="kp">false</span>
</span><span class='line'>                <span class="vg">$hit</span> <span class="o">=</span> <span class="kp">false</span>
</span><span class='line'>                <span class="k">if</span> <span class="n">x</span><span class="o">[</span><span class="n">i</span><span class="o">]</span> <span class="o">==</span> <span class="s1">&#39;_&#39;</span>
</span><span class='line'>                    <span class="n">y</span> <span class="o">+=</span> <span class="n">x</span><span class="o">[</span><span class="n">i</span><span class="o">]</span>
</span><span class='line'>                <span class="k">end</span>
</span><span class='line'>            <span class="k">end</span>
</span><span class='line'>        <span class="k">end</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">if</span> <span class="n">x</span><span class="o">.</span><span class="n">include?</span><span class="p">(</span><span class="s2">&quot;.azw3&quot;</span><span class="p">)</span> <span class="o">||</span> <span class="n">x</span><span class="o">.</span><span class="n">include?</span><span class="p">(</span><span class="s2">&quot;.mobi&quot;</span><span class="p">)</span>
</span><span class='line'>        <span class="k">if</span> <span class="n">x</span><span class="o">.</span><span class="n">include?</span><span class="s2">&quot;_B00&quot;</span>
</span><span class='line'>            <span class="no">File</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="vg">$dst</span> <span class="o">+</span> <span class="s2">&quot;/purchased/&quot;</span> <span class="o">+</span> <span class="n">y</span><span class="p">)</span>
</span><span class='line'>        <span class="k">elsif</span> <span class="n">x</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span> <span class="o">!=</span> <span class="s1">&#39;.&#39;</span>
</span><span class='line'>            <span class="no">File</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="vg">$dst</span> <span class="o">+</span> <span class="s1">&#39;/&#39;</span> <span class="o">+</span> <span class="n">y</span><span class="p">)</span>
</span><span class='line'>        <span class="k">end</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span></code></pre></td></tr></table></div></figure>




<p>Ruby很有特色的一个地方就包括它的字符串处理，它不用像C语言一样来考虑内存管理，程序员也不必要担心字符串占用的内存空间[1].<br>
比如可以直接这样给一个字符串赋值:<br>
str = “we” + “ are” + “ a&#8221; + “ whole”<br>
str2 = 2 * str<br>
此时str2是&#8221;we are a whole we are a whole&#8221;<br>
妈妈说，再也不用担心用strcpy还是strncpy了&#8230;</p>


<p>另外一个有特色的地方是Ruby对于中文字符的支持，我们知道在UTF-8编码下一个汉字是占用3个字节，这可以很容易的用C语言来验证：printf(&#8220;%d\n&#8221;, strlen(&#8220;你好&#8221;)) 显示的结果是6。但是，在Ruby里面，printf(&#8220;%d\n&#8221;, &#8220;再见&#8221;.length)的结果是2，即它显示的是字数而不是字节数，这也是Ruby对中文支持很好的地方，或许是因为松本行泓先生是日本人的缘故吧。所以对于str = &#8220;你好&#8221;而言，在Ruby里面str[0]是&#8221;你&#8221;；而在C语言里面，str[0]则只是&#8221;你&#8221;的第一个字节。</p>




<p>看起来确实是挺酷的吧&#8230;</p>




<p>在执行完这个程序后，这些书就按照我的预期整理好了。但是，等等，让我们打开其中的书试试看。当我打开从网上下载的书时，一点问题都没有，然而当我打开从Amazon上买的书时，结果：<br>
<img src="/images/ruby.png">
</p>


<p>&hellip;&hellip;</p>

<p> 哈哈哈哈哈哈&#8230;</p>


<p> 所以说，备份很重要～</p>


<p>[1] <a href="http://guides.ruby.tw/ruby/strings.html">guides.ruby</a><br>
[2] 进来事情有些多，所以直到这个月最后一号才写这篇文章，写的也有些赶。</p>

		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2014-08-31T00:26:17+08:00" pubdate data-updated="true">Aug 31<span>st</span>, 2014</time></div>
	<div class="tags">

</div>
	
</div>
</article>  


   <article class="post">
	<h2 class="title">
		
		<a href="/blog/2014/07/13/jin-ji-de-ccheng-xu-yuan/">
		
			进击的C程序员, Ruby, 豆瓣读书</a>
	</h2>
	<div class="entry-content">
		<p>我接触编程较晚，从进入大学后才开始。所以我对那些大器晚成的运动员很有好感，比如迭戈•米利托、里克尔梅、诺维茨基、纳什、刘昌赫，所谓榜样的力量。当然这不是说我不喜欢梅西、科比、李昌镐。</p>


<p>我工作后一直都在做底层相关开发，电子线路，总线协议，CPU设计，BIOS(Bootloader)，System(OS，Compiler)，网络，可以说是从硬件到CPU再到OS再到网络一步步往上走的过程。所以目前为止我所使用的语言主要是C，其次是汇编，X86，ARM，MIPS这些芯片的手册也是翻来覆去的看。后来我进入了现在所在的外企，个人时间相对多了一些，所以我也在思考要不要在业余时间做点什么，我不想一辈子就停留在C上。C语言是一切编程语言的基础，没人愿意一辈子停留在基础上。</p>


<p>在2013年的元旦(那会我还在上一家比较辛苦的公司，没有个人时间，也没有多余精力)，我写完了自己的<a href="http://laoar.net/blogs/227/"ll”>年终总结</a>，然后给小儿看。小儿问我，你看的电影是怎么统计成一个表格的？我说，我手动一个个记录啊。小儿：切，我还以为你有什么高效的方法的哪&#8230; 于是我意识到了我的这种做法是多么的愚蠢，我写软件的目的是什么，不就是为了更方便更高效吗，我为什么不能写个程序来自动统计而非得一个个的机械化的去记录？这个时候我就萌生了要自己做点东西的想法，当然由于拖延症以及确实没有个人时间，导致我只是在心里有这个想法，一直没有去做。</p>


<p>在接着我就进入了这家外企。在有一次周例会上，一个编程牛人同事给我们介绍了各种各样的语言，看的我眼花缭乱头昏脑胀，这些语言我一个都不会写。榜样的力量是强大的，既然他可以做到，我为什么不能做到？所以我就买了本《七周七语言》来看。</p>


<p>《七周七语言》这本书里面提到了Ruby，里面有句话说，Ruby特别适合写爬虫程序。这句话一下子触动了我，从豆瓣上统计自己看过的电影不就是一个爬虫程序吗？我心里一阵激动，这个时候已经到了2013年底。</p>


<p>接着我就买了《代码的未来》和《松本行泓的程序世界》这两本书，看完这两本书，已经到了2014年中旬。</p>


<p>看《松本行泓的程序世界》的过程中，我又粗略翻了下《Programming Ruby》这本书。看完后我就撸起袖子开始写这个爬虫程序了。在写这个爬虫程序前，我不知道html是什么，也不知道css是什么，更不用说javascript，正所谓无知者无畏，我就这么开始写了。就一个周末的时间，我竟然写出来了，当然我写的是爬自己读过的书，而不是看过的电影，因为读书会显得自己逼格高一点，而看电影每个人在无聊的时候都会做。</p>


<p>在折腾html、Ruby的过程中，我又顺便把自己的博客系统由wordpress改为了octopress。在弄这个octopress的时候确实是两眼一抹黑，因为什么都不懂嘛。好在我懂得使用grep，比如我想把那个Google搜索按钮给去掉，于是我就grep -r &#8220;oogle.com&#8221; * &#8211;color，因为知识是相通的，这个Google按钮一定是去访问了google.com,而它一定是存在某个文件里面，那么我就一定能找到它在哪个地方，然后就一定能修改它。正是凭借着grep，我把octopress给摸了个大概，然后把主题改的挺个性化，虽然看起来不好看。如果有人问我，linux相比windows最大的优点是什么，我会毫不犹豫的回答，“grep”。grep就像是知识海洋里的百度地图，百度地图在手，在任何陌生地方都能通行无阻。它再配合xargs，真的是自学利器。</p>


<p>再来看这个爬虫程序。其实它所做的就是解析html格式的文件，就像是linux系统里对elf文件的反汇编一样。只要熟悉了它的文件格式，剩下的无非就是找到这个文件（uri表示的文件）、打开、按照一定规则去解析、再友好的输出解析结果。还是那句话，知识总是相通的，学会了一个自然能够举一反三。</p>


<p>打开uri的过程涉及到一点http知识。当我们在浏览器里面输入一个网址，敲下enter键，实际上是相这个网址所对应的服务器端发送了一个http请求，然后服务器端把我们请求的这个文件压缩分包加密后再传送到我们的浏览器，我们的浏览器再把这些包解密合并解压然后呈现给我们一个网页。一个网页其实就是一个文件，万物皆为文件，这就是linux的思想。</p>


<p>写完了这个<a href="https://github.com/laoar/bookwall"ll”>爬虫程序</a>，然后把自己读过的书的封面放在博客的<a href="http://laoar.net/read/"ll”>一个页面</a>里面，就像一个照片墙，所以我给自己的这个程序取了个名字叫做BookWall。虽然做的过程很折腾，可是花点心思毕竟也做出来了，当然这对于web程序员而言是小菜一碟。然后我就在想，接下来我再折腾点啥？学习下html5/css3，把自己的博客弄的酷炫狂拽屌炸天一些，或者，搞个WebApp，一键来统计自己在所有网站（比如豆瓣，微博，知乎，github，linkedin，goodreads，quaro，last.fm）上的活动记录，跟大数据一样。首先我得想想用什么语言合适，然后开始慢悠悠的看上几本书，再开始动笔&#8230;</p>


<p>从13年元旦开始有这个想法，到14年中旬才完成。这实在难以称得上是进击，所以标题叫做“患有拖延症的C程序员，Ruby，豆瓣读书”更合适一些。</p>




		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2014-07-13T14:04:50+08:00" pubdate data-updated="true">Jul 13<span>th</span>, 2014</time></div>
	<div class="tags">

</div>
	
</div>
</article>  


   <article class="post">
	<h2 class="title">
		
		<a href="/blog/2014/06/24/ldscript/">
		
			性能优化，要懂点编译原理</a>
	</h2>
	<div class="entry-content">
		<h4><center>前言一</center></h4>


<p>现在正处在世界杯小组赛的阶段，我通常都是10点钟早早睡觉，然后爬起来看完12点场的比赛再睡觉，或者，早起看6点场的比赛然后冲个澡去上班。今晚为了写这篇文章，就不打算早睡了，直接看完12点场的比赛再睡觉。</p>

<h4><center>前言二</center></h4>


<p>我不是想说gcc的-O选项，诚然它很强大，不过gcc manual已经说的很清楚了<a href="https://gcc.gnu.org/onlinedocs/gcc-4.8.1/gcc/Optimize-Options.html#Optimize-Options" title="Title">
Gcc-Optimize-Options</a></p>

<h4><center>前言三</center></h4>


<p>在我上大学的时候，我买了本《编译原理》，盗版的，这应该是我这一生买的最后一本盗版书。那本书我翻了几页就没继续往下看，因为纸张看着实在是太不舒服了。后来工作后，我从amazon上买了本正版的，纸张确实好很多，不过还是看不下去，原因嘛，你懂的~</p>

<h4><center>正文</center></h4>


<p>可执行文件的内存布局对程序性能的影响是非常巨大的，因为我最近一直在做性能优化，对这方面感触颇深。要搞明白可执行文件的内存布局，就必须得了解编译原理，当然编译原理实在是太过于高深了，我所知也是皮毛，所以我就从最实用的地方开始入手一点点的分析。</p>


<p>就从我前文里提到的__attribute__((section(&#8220;.sec_name&#8221;)))来说起吧，因为我使用这个东西确实给我们的性能带来了一定的提升。 </p>


<p>关于attribute section这个东西，你要google的话，能够搜索出来不少前人的分析，不过实在都是大同小异，你抄我来我抄你，毫无营养。在他们的博客里，无非是说，“将作用的函数或者数据放入指定名为‘.sec_name’ 的输入段”，然后再巴拉巴拉一通什么是输入段，说的你云里雾里一头雾水分不清东西南北顿觉高大上。</p>


<p>那我们就来看下attribute section到底是什么。</p>


<p>要知道attribute section, 就要先理解链接脚本。链接脚本即链接器在把.o文件链接成最后的elf文件所遵循的规则，也就是，最终的可执行文件是什么样子的是由这个链接脚本决定的。链接脚本的语法和C语言很类似，我们能够很容易读明白，所以从链接脚本来入手分析这个东西会更清晰一些。对应于 __attribute__((section(&#8220;.sec_name&#8221;)))这句话，它在链接的时候采取的默认规则是：
<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='c'><span class='line'><span class="p">.</span><span class="n">sec_name</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>     <span class="o">*</span><span class="p">(.</span><span class="n">sec_name</span><span class="p">)</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>
即把.sec_name指向的内容放在.sec_name这个段里面。我们再来稍微清晰化一些，下面举个例子。
<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='c'><span class='line'><span class="kt">void</span> <span class="nf">foo</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>  <span class="n">__attribute__</span><span class="p">((</span><span class="n">section</span><span class="p">(</span><span class="s">&quot;.in_name&quot;</span><span class="p">)));</span>
</span><span class='line'><span class="kt">void</span> <span class="nf">bar</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>  <span class="n">__attribute__</span><span class="p">((</span><span class="n">section</span><span class="p">(</span><span class="s">&quot;.in_name&quot;</span><span class="p">)));</span>
</span></code></pre></td></tr></table></div></figure>
我们使用attribute section来声明了两个函数，然后我们在链接脚本里面做如下约束：
<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='c'><span class='line'><span class="p">.</span><span class="n">out_name</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>     <span class="o">*</span><span class="p">(.</span><span class="n">in_name</span><span class="p">)</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>
这样就把foor(),bar()这两个函数给放在了最终elf文件里的.out_name这个section。而如果我们不再链接脚本里做这个约束，那么它在链接过程中就会采用默认规则，即输入段和输出段的名字是一样的：
<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='c'><span class='line'><span class="p">.</span><span class="n">in_name</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>     <span class="o">*</span><span class="p">(.</span><span class="n">in_name</span><span class="p">)</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>
</p>




<p>总结起来就是，__attribute__((section(&#8220;.in_name&#8221;)))的作用是把.in_name指向的符号给放在一起。</p>


<p>唔~ 仍然有点模糊是不？ 那就好好读读《linkers and loaders》或者《程序员的自我修养》这两本书吧。</p>




<p>然后我们来看下linux内核对于attribute section的应用， 以linux kernel的链接脚本vmlinux.lds为例。先来看下linux kernel最终镜像的代码段是如何规划的。</p>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class='c'><span class='line'><span class="n">SECTIONS</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>     <span class="p">.</span> <span class="o">=</span> <span class="n">VMLINUX_LOAD_ADDRESS</span><span class="p">;</span>
</span><span class='line'>     <span class="cm">/* read-only */</span>
</span><span class='line'>     <span class="n">_text</span> <span class="o">=</span> <span class="p">.;</span>     <span class="cm">/* Text and read-only data */</span>
</span><span class='line'>     <span class="p">.</span><span class="n">text</span> <span class="o">:</span> <span class="p">{</span>
</span><span class='line'>          <span class="n">TEXT_TEXT</span>
</span><span class='line'>          <span class="n">SCHED_TEXT</span>
</span><span class='line'>          <span class="n">LOCK_TEXT</span>
</span><span class='line'>          <span class="n">KPROBES_TEXT</span>
</span><span class='line'>          <span class="n">IRQENTRY_TEXT</span>
</span><span class='line'>          <span class="o">*</span><span class="p">(.</span><span class="n">text</span><span class="p">.</span><span class="o">*</span><span class="p">)</span>
</span><span class='line'>          <span class="o">*</span><span class="p">(.</span><span class="n">fixup</span><span class="p">)</span>
</span><span class='line'>          <span class="o">*</span><span class="p">(.</span><span class="n">gnu</span><span class="p">.</span><span class="n">warning</span><span class="p">)</span>
</span><span class='line'>     <span class="p">}</span> <span class="o">:</span><span class="n">text</span> <span class="o">=</span> <span class="mi">0</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>如上就是一个典型的linux kenrel链接脚本的代码段部分。稍微解释下。
. = VMLINUX_LOAD_ADDRESS;的意思是说，此处的地址是VMLINUX_LOAD_ADDRESS，接着又把该值赋给了_text，也就是内核代码段的其实地址是VMLINUX_LOAD_ADDRESS，就这就开始了代码段。在代码段里面我们可以很明显的看到它划分了TEXT_TEXT、SCHED_TEXT、LOCK_TEXT、KPROBES_TEXT、IRQENTRY_TEXT，这样划分的目的，就是为了合理规划地址空间以提升性能。我们可以看下这几个宏到底表示什么：
<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
</pre></td><td class='code'><pre><code class='c'><span class='line'><span class="cp">#define TEXT_TEXT                                   \</span>
</span><span class='line'><span class="cp">          ALIGN_FUNCTION();                         \</span>
</span><span class='line'><span class="cp">          *(.text.hot)                              \</span>
</span><span class='line'><span class="cp">          *(.text)                              \</span>
</span><span class='line'><span class="cp">          *(.ref.text)                              \</span>
</span><span class='line'><span class="cp">     MEM_KEEP(init.text)                              \</span>
</span><span class='line'><span class="cp">     MEM_KEEP(exit.text)                              \</span>
</span><span class='line'><span class="cp">          *(.text.unlikely)</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#define SCHED_TEXT                                   \</span>
</span><span class='line'><span class="cp">          ALIGN_FUNCTION();                         \</span>
</span><span class='line'><span class="cp">          VMLINUX_SYMBOL(__sched_text_start) = .;               \</span>
</span><span class='line'><span class="cp">          *(.sched.text)                              \</span>
</span><span class='line'><span class="cp">          VMLINUX_SYMBOL(__sched_text_end) = .;</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#define LOCK_TEXT                                   \</span>
</span><span class='line'><span class="cp">          ALIGN_FUNCTION();                         \</span>
</span><span class='line'><span class="cp">          VMLINUX_SYMBOL(__lock_text_start) = .;               \</span>
</span><span class='line'><span class="cp">          *(.spinlock.text)                         \</span>
</span><span class='line'><span class="cp">          VMLINUX_SYMBOL(__lock_text_end) = .;</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#define KPROBES_TEXT                                   \</span>
</span><span class='line'><span class="cp">          ALIGN_FUNCTION();                         \</span>
</span><span class='line'><span class="cp">          VMLINUX_SYMBOL(__kprobes_text_start) = .;          \</span>
</span><span class='line'><span class="cp">          *(.kprobes.text)                         \</span>
</span><span class='line'><span class="cp">          VMLINUX_SYMBOL(__kprobes_text_end) = .;</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#define IRQENTRY_TEXT                                   \</span>
</span><span class='line'><span class="cp">          ALIGN_FUNCTION();                         \</span>
</span><span class='line'><span class="cp">          VMLINUX_SYMBOL(__irqentry_text_start) = .;          \</span>
</span><span class='line'><span class="cp">          *(.irqentry.text)                         \</span>
</span><span class='line'><span class="cp">          VMLINUX_SYMBOL(__irqentry_text_end) = .;</span>
</span></code></pre></td></tr></table></div></figure>
这些宏其实就是定义了一些input section， 比如.text.hot等。</p>


<p>接着以.sched.text为例来看看到底是怎么用的。
<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='c'><span class='line'><span class="cp">#define __sched          __attribute__((__section__(&quot;.sched.text&quot;)))</span>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">__sched</span> <span class="n">notrace</span> <span class="nf">preempt_schedule_context</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span>
</span><span class='line'><span class="k">static</span> <span class="kt">void</span> <span class="n">__sched</span> <span class="nf">__schedule</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span>
</span><span class='line'><span class="n">asmlinkage</span> <span class="kt">void</span> <span class="n">__sched</span> <span class="nf">schedule</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span>
</span><span class='line'><span class="n">asmlinkage</span> <span class="kt">void</span> <span class="n">__sched</span> <span class="nf">schedule_user</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span>
</span><span class='line'><span class="kt">void</span> <span class="n">__sched</span> <span class="nf">schedule_preempt_disabled</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span>
</span><span class='line'><span class="n">asmlinkage</span> <span class="kt">void</span> <span class="n">__sched</span> <span class="n">notrace</span> <span class="nf">preempt_schedule</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span>
</span><span class='line'><span class="n">asmlinkage</span> <span class="kt">void</span> <span class="n">__sched</span> <span class="nf">preempt_schedule_irq</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span>
</span><span class='line'><span class="p">....</span>
</span></code></pre></td></tr></table></div></figure>
一目了然了吧？ 就是前面我们说的attribute section这个东西，内核就是使用了这个东西来规划地址空间，将相互关联的代码给放在一起，以达到提升性能并保持稳定的作用。 </p>




<p>因为松柏公司的性能受代码check-in影响波动较大，所以我就想到了使用linux kernel的这种做法来规划可执行文件的地址空间，按照不同模块来划分不同的section，这样来避免频繁code check-in对性能波动的影响。
<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='c'><span class='line'><span class="p">.</span><span class="n">text</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>     <span class="o">*</span><span class="p">(.</span><span class="n">module_a</span><span class="p">.</span><span class="n">text</span><span class="p">)</span>
</span><span class='line'>     <span class="o">*</span><span class="p">(.</span><span class="n">module_b</span><span class="p">.</span><span class="n">text</span><span class="p">)</span>
</span><span class='line'>     <span class="o">*</span><span class="p">(.</span><span class="n">module_c</span><span class="p">.</span><span class="n">text</span><span class="p">)</span>
</span><span class='line'>     <span class="p">...</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>
</p>


<p>其实，再稍微的深入思考下，我们就能发现一个更细粒度的控制，那就是控制函数在可执行文件里的先后顺序。
<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='c'><span class='line'><span class="kt">void</span> <span class="nf">foo</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>  <span class="n">__attribute__</span><span class="p">((</span><span class="n">section</span><span class="p">(</span><span class="s">&quot;.in_name.1&quot;</span><span class="p">)));</span>
</span><span class='line'><span class="kt">void</span> <span class="nf">bar</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>  <span class="n">__attribute__</span><span class="p">((</span><span class="n">section</span><span class="p">(</span><span class="s">&quot;.in_name.2&quot;</span><span class="p">)));</span>
</span><span class='line'>
</span><span class='line'> <span class="p">.</span><span class="n">text</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>     <span class="o">*</span><span class="p">(.</span><span class="n">in_name</span><span class="mf">.1</span><span class="p">)</span>
</span><span class='line'>     <span class="o">*</span><span class="p">(.</span><span class="n">in_name</span><span class="mf">.2</span><span class="p">)</span>
</span><span class='line'>     <span class="p">...</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>
这样做之后，在可执行文件里，foo就会在bar的前面，及foo和bar的地址紧挨着，bar紧跟在foo的后面。</p>


<p></p>

<p>我们在缩小一下我们的视角，从宏观上来看下这个链接脚本。
<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='c'><span class='line'><span class="n">SECTIONS</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>     <span class="p">.</span><span class="n">text</span> <span class="o">:</span> <span class="p">{</span>
</span><span class='line'>          <span class="p">...</span>
</span><span class='line'>     <span class="p">}</span>
</span><span class='line'>     <span class="p">.</span><span class="n">data</span> <span class="o">:</span> <span class="p">{</span>
</span><span class='line'>          <span class="p">...</span>
</span><span class='line'>     <span class="p">}</span>
</span><span class='line'>     <span class="p">.</span><span class="n">bss</span><span class="o">:</span><span class="p">{</span>
</span><span class='line'>          <span class="p">...</span>
</span><span class='line'>     <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>
这也是为什么可执行文件的内存布局先是代码段，接着数据段，再是bss段的原因，即链接脚本决定可执行文件的内存布局。在linux／freebsd机器上运行“ld —verbose”就可以获得ld使用的默认链接脚本。</p>


		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2014-06-24T22:08:21+08:00" pubdate data-updated="true">Jun 24<span>th</span>, 2014</time></div>
	<div class="tags">

</div>
	
</div>
</article>  


   <article class="post">
	<h2 class="title">
		
		<a href="/blog/2014/05/25/hello-github/">
		
			Hello Github!</a>
	</h2>
	<div class="entry-content">
		<p>Hi there all:</p>

<p>博客服务器由国外收费服务器迁移到github上，博客管理工具由wordpress转向octopress，这样显得Geek些。</p>

<p>Thanks<br>
<font color=blue>@laoar</font></p>

		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2014-05-25T21:08:29+08:00" pubdate data-updated="true">May 25<span>th</span>, 2014</time></div>
	<div class="tags">

</div>
	
</div>
</article>  


   <article class="post">
	<h2 class="title">
		
		<a href="/blogs/501">
		
			性能优化：一些很有意思的尝试</a>
	</h2>
	<div class="entry-content">
		<p>Cliff跟我说，做性能优化就得花时间去琢磨，<wbr />你要天天琢磨这个事，慢慢的就能找到办法了。 Boss的相对宽容，就给了我足够的时间来做一些琢磨（<wbr />一开始写的是研究，想着自己也不是啥科学家，<wbr />研究这个词还是太高大上了），<wbr />我也得以能够做一些实验来证明自己的想法。<br />
我在前一篇博客里也说过，<wbr />关于性能优化的经验文章可谓汗牛充栋数不胜数，<wbr />然而这一类的文章大多数都是纸上谈兵，纯理论派，<wbr />实际操作性太差。所以我就说下我的实际操作经验，<wbr />这些操作经验在理论派达人眼里可能是小儿科，<wbr />远不及他们指点江山挥斥方遒的派头，<wbr />然而实用的终究要比花拳绣腿好。<br />
因为有些东西我还没有想明白，<wbr />所以这篇博客可能最终没有真正的结论，只有实际的效果。<wbr />仅举几个有趣的例子。<br />
某松柏公司的版本管理方案大致是下面这个这个样子，<wbr />首先有一个主线版本，在每个迭代的开始会拉出一个开发分支，<wbr />开发分支开发完毕再sync到主线，<wbr />然后再从主线拉出一个发布分支做版本发布。注：<wbr />开发分支主要是针对一些大的特性的改动，一些bug fix可能只是commit到主线，<wbr />而不会commit到开发分支。<br />
对于开发分支，会定期有一些sanity check，即做一些测试来监控开发版本的一些指标，<wbr />比如性能指标。主线由于相对稳定，因而就没有这些sanity check。<br />
开发分支由于有daily build的性能测试，因而能够及时的发现问题，<wbr />所以它的性能状况一向都比较良好。<br />
于是问题就来了。最近再把开发分支sync到主线，<wbr />然后从主线拉出来一个发布分支后，发布分支的性能非常之低。 比如开发分支的UDP吞吐量是900Kpps，<wbr />发布分支的UDP吞吐量竟然下降到了780Kpps，<wbr />版本经理的预期是要达到850Kpps，<wbr />因而我需要找出来为什么性能下降这么大，<wbr />以及怎么样来提升它的性能。<br />
理论派达人如果过来指点下江山的话，可能会说，<wbr />用profile工具来比较性能较好（开发分支）和性能很差（<wbr />发布分支）的两个image，看看他们的关键路径上有什么差异，<wbr />先找出差异来，再做调整。 但是，实际情况是，性能差异这么巨大，<wbr />很大的可能性不是由于critical path的代码改动导致的，<wbr />而是由一些无关痛痒的代码改动导致cache的sensitiv<wbr />e。 如果花时间的话，这种想法也的确可行，<wbr />然而最终效果总是看起来很美实际上只是老大爷打太极有板有眼就是<wbr />敌不过一双拳。<br />
再稍微务实一点的想法是，<wbr />我们找到主线分支上性能较好的一个revision，<wbr />然后利用二分查找法来找出是不是由于某个check－<wbr />in导致的。这里的难点在于，首先，<wbr />代码的性能变化是一个波浪型的曲线，<wbr />你没有办法来确认你找到的性能较高的revision是一个合理<wbr />的revision。这种想法更务实一点，<wbr />花费的时间可能也会很多。<br />
更务实一点的想法是，我们找出哪些代码只commit到了主线（<wbr />性能较低）而没有commit到开发分支（性能很好），<wbr />那么性能下降必然是由这些check－in导致的。难点在于，<wbr />每天的代码的check－in少则有4、5个，多则有十几个，<wbr />这个比较也是一个吃力不讨好的事。<br />
所以，我们玩点有技术含量的吧，比较二进制！ 坦白说，在我打算这么做的时候，我不知道结果会怎么样，<wbr />也不知道能不能搞定，反正当时心一横，管它哪，干吧！<br />
于是，<wbr />我将开发分支和发布分支的两个image的符号表给dump出来<wbr />，然后由低地址到高地址sort排序。 大致命令如下：<br />
objdump -t image1.elf | sort &gt; iamge2.sym<br />
objdump -t image2.elf | sort &gt; image2.sym<br />
vim -d iamge1.sym image2.sym<br />
然后我痛苦的发现，这两个符号表竟然有10多万个差异。 这要是一个个的去查，那得查到天荒地老了。<br />
然而这些差异很多都是符号地址的差异，符号的大小基本都一样的。 所以接下来，我就把image1.sym和image2.<wbr />sym的地址这一列给删除再做比较。<wbr />在vim的visual模式下可以按列删除，<wbr />具体请google，此处不缀述。<br />
然后问题就稍微简化了些，很快就找到了一个值得怀疑的地方，<wbr />如下图。（为了不泄漏某松柏公司的信息，我对图片做了些处理。<wbr />虽然这些信息可能也无关紧要，不过做人要职业些嘛）<br />
<img src="/images/501.jpg"></p>
<p>我们可以看到深蓝色的那一行就是两个的差异，<wbr />该符号的大小由0x910增大到了0xaa8，<wbr />共增加了102条指令。于是我验证了下，<wbr />果然是这个差异导致的性能由900Kpps下降到了780Kpp<wbr />s。<br />
既然知道了是哪里导致性能下降的了，问题就简单了，<wbr />肯定是有办法来解决的。<br />
不过我要说的，到这里并没有结束，接下来才是关键。事实上，<wbr />这个符号在data path里并不会执行到，也就是说，<wbr />UDP的吞吐量根本就不会执行这个函数，<wbr />但是这个函数的改动又切切实实的导致了性能的下降。<wbr />唯二的可能性就是a)这个符号的改动影响了后续符号的地址，<wbr />导致一些cache line对齐问题，b)这个符号的改动使得critical path里面的函数／数据出现了cache line的冲突。然而由于符号的差异确实太多了，<wbr />而且critical path里面的函数和数据也很多，<wbr />所以我没有太多的时间和精力来查找到底是哪个原因。<wbr />对于b这种可能性相对好验证一些，只要知道了cache line的大小，和组相连的set，就能够知道cache line冲突的单位是set*line_size, 然后以这个值为基本单位来比较相差这个大小的符号即可。<wbr />对于情况a，可能就不太好验证了，因为要排查的东西太多了，<wbr />时间不允许，不过对于这种情况，我们可以有一些预防措施，<wbr />比如使用__attribute__(signed(128))<wbr />来将一些大的数据结构cache line对齐。注意我们将大数据结构cache line对齐并不是说对齐可以提高访问速度，oh god，如果你这么想那就真的是太悲哀了，<wbr />RISC的访问必须是对齐访问，<wbr />CISC的访问可以不对齐访问多花一个cycle。<wbr />这里所说的cache line对齐，是指，避免这个大数据结构占用多个cache line，比如如果这个大数据结构是136字节，<wbr />不对齐的话它完全是有可能占用3个cache line的（假设cache line的大小是128字节），而对齐的话只需要2个cache line。接下来如果我有充足的时间的话，<wbr />我会继续深入的做一下这件事的琢磨，看看能不能发现一些东西。<wbr />当然也可能花费很多时间什么都做不出来。<br />
事情到这里还没有结束。我们还得再琢磨琢磨。<br />
我们也看到了，<wbr />这明显是无关代码改动导致关键路径性能下降的例子，<wbr />那么我们为何不将关键路径，<wbr />或者说主要功能的代码给放到符号地址空间的前面，<wbr />而将这些次要功能或者说不是很重要的代码给放到后面，<wbr />这样这些无关代码的改动就不会太明显的影响了关键路径了。<wbr />这也说明，对于大型软件系统而言，<wbr />合理的划分地址空间是多么的重要，<wbr />不然以后就只能疲于奔命的去解决这些很无奈的问题了。<br />
合理的划分地址空间，就设计到Makefile／<wbr />链接脚本的设计。这些也不是一个想当然的事，<wbr />而是要根据具体情况来做。 在设计大型软件之初，也不必要去过多的关注这方面，<wbr />等到需要改变的时候再去改变也不迟，毕竟，高司令也教导我们，“<wbr />过早优化是万恶之源”。</p>
		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2014-05-24T00:00:00+08:00" pubdate data-updated="true">May 24<span>th</span>, 2014</time></div>
	<div class="tags">

</div>
	
</div>
</article>  


   <article class="post">
	<h2 class="title">
		
		<a href="/blogs/482">
		
			性能优化，从linux内核里来学习，和一个例子</a>
	</h2>
	<div class="entry-content">
		<p style="padding-left: 30px;"></p>
<p>    我对“案例”这个词比较反感，所以标题是“一个例子”。 “案例”这个词，就跟“拉通”、“沟通”、“跟产品PK”、“奋斗者”、“客户”一样，在我眼里属于洗脑文化，所以我比较忌讳使用这些词。使用“例子”、“员工”、“customer”这些词(很抱歉我不知道“拉通”、“沟通”、“和产品PK”是什么意思，因而找不到对应的词，还好我生活和工作中也不会用到这些词)会让我更舒服一些。<br />
<p style="padding-left: 30px;"></p><br />
    对于性能优化，相信稍微懂点编程的人都能说出个二五六来。比如对于inline的使用，只要是会写C语言，相信你一定能够口若悬河滔滔不绝的说出一大坨一大坨inline的优劣以及对性能的影响，然而这一大坨一大坨的经验都是bullshit，一切要看结果怎么样（我心里忽然不由自主的冒出了“以结果为导向”这个词，oh god，愿上帝拯救我）。就像木心在《文学回忆录》说的，“思想过剩的人，行动力往往较差”，关于性能优化这件事也是这样，不要迷信前人的经验，要自己动手去做。注意“迷信”的前提是了解，你要去了解他们的说法，但是不要去相信他们。<span style="line-height: 1.5em;">   </span></p>
<p><span style="line-height: 1.5em;">    再来看inline这个问题，有个哥哥根据自己的实验发现，</span><span style="text-decoration: underline;"><a href="https://lwn.net/Articles/82494/">在skbbuff里面的一些skb__函数都不应该使用inline，因为去掉这些inline后能够提升3%的性</a>能</span><span style="line-height: 1.5em;">。所以说，这些想当然的经验都是bullshit，一切要看实际结果，写代码时不要傻逼兮兮的一上来就到处加inline，毕竟高司令也说过，“过早优化是万恶之源‘。</span><br />
<p style="padding-left: 30px;"></p><br />
    当然我要说的例子不是这个inline的例子。<br />
<p style="padding-left: 30px;"></p><br />
    我们知道Linux Kernel跟GNU是密切联系的，所以在Linux Kernel里面到处可见GCC的一些优化手段，比如GCC的attribute这个东西。《GNU/Linux Application Programming》的作者Tim Jones在他的文章《GCC hacks in Linux Kernel》里对GCC的这些手段做了些总结，写的也挺好。不过这个老兄忽略了一个很重要的东西，__attribute__((section(&#8220;name&#8221;))). 如果你要是写过内核驱动或者做过内核启动的话，你应该对__attribute__((section(&#8220;.init.text&#8221;)))不会陌生，没错他就是__init这个宏。__init这个宏的作用是，Gcc会把这个函数放在.init.text的输入段给链接器，这样所有以__init来声明的符号都会放在.init.text这个section里面。然后在初始化完毕，这些初始化代码显然就不会再执行了，那么他们占用的内存就可以被释放掉，所以在kernel初始化结束会调用一个free_initmem()函数来释放所有位于.init这个section的函数。<br />
<p style="padding-left: 30px;"></p><br />
    不过可惜的是，由于释放的是代码段的页表，因而必须得在内核里面来做，而且内核也没有提供这样的系统调用给用户态 ，对于用户态而言就没有办法来这样处理。事实上有很多用户态程序的初始化代码也很大，几百KB的初始化代码也是很正常的，释放这部分空间也是很可观。不清楚内核开发者为什么不考虑将这个方法以一个系统调用的形式导出到用户态。即提供这样一个系统调用：<br />
int free_inittext(unsigned long start, unsigned long end);<br />
释放页表要求是页对齐，这部分工作可以在内核里面进行检查，并将start向后对齐，以及end向前对齐，该系统调用的返回值是实际释放的page数目，如果没有释放就返回负值。<br />
<p style="padding-left: 30px;"></p><br />
    我们已经知道__attribute__((section(“name&quot;)))的作用是将这个函数给放在一起，这样就给我们提供了一个优化思路，我们完全可以将hot function用这种方法给放在一起，来减少icache miss。之所以是将hot function放在一起，而不是将逻辑上顺序执行的代码顺序排放，是因为icache的替换算法是LRU，即最近最少使用。既然是hot function，显然是会经常调用的，那么，我们把经常调用的函数给放在一起，当某一个函数得到执行时就会可能将另外的hot function一并给预取到cache line里面，其实本质上就是利用cpu的指令预取特性，有点类似于likely()；并且由于这个cache line里都是hot instruction，它总是会得到执行，被替换出去的可能性就大大减少，从而提高cache hit rate。这里需要澄清的一点是，当执行到某一个函数的时候，由于cpu不直接跟memory打交道，它会把该函数读取到cache里面再load到寄存器里面去执行，它把函数读取到cache里面时并不是把整个函数给读取到cache里，而是只读取一个cache line。比如我某一个函数它的起始地址是0x40000008, 假设cache line大小是32bytes， 那么我要执行这个函数的时候就会一次性的将0x40000000～0x40000020这部分的指令给读取到cache，某些cpu会有critical设计，即先读取0x40000008开始的4字节（对于32bits的CPU而言，其read path是4字节）读取到cache接下来再读取其余的28bytes。<br />
<p style="padding-left: 30px;"></p><br />
    这里就是我要说的一个例子。我在做性能优化的时候，仅仅是将critical path里的2个函数利用这种方法给放在了一起，就将UDP的throughput给提升了&gt;10%.<br />
<p style="padding-left: 30px;"></p><br />
    然而，我之所以选择这样做也是迫不得已，我更理想的想法是将另外一个函数给定义成inline，然而无奈另外一个函数有多处调用，如定义成inline可能会得不偿失，因为可执行文件的size就会变大了。结果也恰如我所料，将其定义为inline反而导致性能下降。<br />
<p style="padding-left: 30px;"></p><br />
    所以我就想，C语言里面是否应该有这种设计：inline不是用来作为函数定义的限制词，而是作为函数调用的限制词，即我在调用的时候来决定是否将该函数给内嵌过来，而不是在定义该函数的时候限制其为inline。 比如：<br />
<div class='bogus-wrapper'><figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='c'><span class='line'><span class="kt">int</span> <span class="nf">func_c</span><span class="p">(</span><span class="kt">int</span> <span class="n">a</span><span class="p">,</span> <span class="kt">int</span> <span class="n">b</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="nf">func_a</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="c1">//...</span>
</span><span class='line'>    <span class="n">c</span> <span class="o">=</span> <span class="n">func_b</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span> <span class="kr">__inline</span><span class="p">;</span>
</span><span class='line'>    <span class="c1">//...</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure></div></p>
		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2014-04-29T00:00:00+08:00" pubdate data-updated="true">Apr 29<span>th</span>, 2014</time></div>
	<div class="tags">

</div>
	
</div>
</article>  


   <article class="post">
	<h2 class="title">
		
		<a href="/blogs/466">
		
			关于struct Hack, 优雅的FreeBSD</a>
	</h2>
	<div class="entry-content">
		<p style="padding-left: 30px;"></p>
<p>    本来今晚计划去健身的，谁知道正打算去的时候发现背包里只带着运动裤，忘了带跑步鞋了，脚上的Northface鞋实在不适合健身，于是无奈放弃了。然后趁这个机会写点东西。<br />
<p style="padding-left: 30px;"></p><br />
    好了，言归正传。<br />
<p style="padding-left: 60px;"></p><br />
    我们对于struct stack熟知的是下面这种情况。<br />
<img src="/images/466.jpg"><br />
我们定义一个结构体family来记录一个正常家庭的人的年龄，显然对于一个正常家庭来说，爸妈各只有一个，但是孩子有多少就不确定了，所以我们把family的最后一个成员baby定义为了变长数组。对于这种在一个结构体里面最后一个变量是变长数组而且仅有这一个成员是变长数组的情况，我们称之为struct hack。这属于C语言里面的一个trick。<br />
<p style="padding-left: 30px;"></p><br />
    我这边博客要讨论的不是这种情况，我要说的是我在FreeBSD内核里面看到的一个很有意思的代码，也是一种struct的trick。它起的名字是struct __hack, 所以我就联想到了前面的struc hack ：）<br />
<p style="padding-left: 30px;"></p><br />
    在说FreeBSD内核的struct __hack之前，先来说下Linux内核里的do{ }while(0) 。 在我之前一个<a href="http://www.laoar.net/?p=289">blog</a>里，我说了 do{} while(0) 的目的是为了防止悬挂else问题。之所以会出现悬挂else问题，就是因为代码写的不是太规范。所以说，对于if/else,我们还是要尽量写成<br />
<p style="text-align: left; padding-left: 150px;"><br />
if  (…)  {<br />
&#8230;<br />
} else {<br />
&#8230;<br />
}</p><br />
即使里面只有一句话。<br />
<p style="padding-left: 30px;">然后在来看这个struct __hack。</p><br />
<img src="/images/466-2.jpg"><br />
<p style="padding-left: 90px;"></p><br />
<p style="text-align: left;">     任何技术或者技巧的出现都是为了解决一些问题的，那么这里的struct __hack是为了解决什么问题哪？ 其实它是用来告诉程序员这个宏只用作函数声明。我们知道函数声明一般都是下面这个样子：</p><br />
<p style="text-align: left; padding-left: 150px;"><br />
void foobar(void);</p><br />
<p style="text-align: left;">这个宏也是为了模拟这种形式, 当然事实上它仍然是宏定义了一个函数, 这里要模拟，是说，它的函数体在别处。比如：</p><br />
<p style="text-align: left; padding-left: 150px;">TASKQUEUE_DEFINE_THREAD(kqueue);</p><br />
<p style="padding-left: 30px;"></p><br />
    总之，这个小小的细节正体现出了FreeBSD所追求的优雅性.<br />
<p style="padding-left: 30px;"></p><br />
    写完发现字数太少了。所以在歪歪唧唧一些。最近写blog经常中英混杂，貌似好像大概可能也许很多人都讨厌这个样子，不过目测讨厌这样的多半都不是计算机这个行业或者工作中和英语打交道较少的。假如英语真的影响到你的薪水，进而又影响到你的生活质量，显然你也会不自觉的变成这样，无他，赚钱糊口而已。正应了那句话，叫做，屌丝的生活高富帅永远都不懂，只有经历了你才会明白：）<br />
<p style="padding-left: 30px;"></p><br />
    计算机这个东西本身就是美国的，凡事都是原汁原味的好，而且在绝大多数情况下，你面对的只有英文。比如对于一个C编译器的编译错误信息“discards qualifiers from pointer target type”， 如果你要Google一下才知道这是什么错误的话，那么恭喜你，码农的苦逼生活不适合你：）<br />
<p style="padding-left: 30px;"></p><br />
    其实反过来想也是这样。我在的小区附近老外特别多，旁边一个小区住着N多的韩国人。最近楼下新开了一家店，为了招徕老外，显然得起个英文名，它的英文名字叫“Chinese Humberger”，你猜它的中文名叫什么？ 肉夹馍！ 哈哈，很不伦不类，莫名其妙不是。所以说，原汁原味的才是最好的。</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2014-03-20T00:00:00+08:00" pubdate data-updated="true">Mar 20<span>th</span>, 2014</time></div>
	<div class="tags">

</div>
	
</div>
</article>  


   <article class="post">
	<h2 class="title">
		
		<a href="/blogs/455">
		
			性能优化,关于Profiling</a>
	</h2>
	<div class="entry-content">
		<p style="padding-left: 30px;"></p>
<p>    对于大型软件系统而言，可维护性是很重要的一个方面，否则到了最后没人能够搞懂全部的代码那就是一个灾难了。这方面的例子可谓比比皆是，比如华为VRP平台的Linux内核，因为模块间耦合太严重很难升级Linux内核版本，搞到最后实在搞不下去，于是团队解散，投奔中软的RTOS。松本行弘在《代码的未来》这本书里说，开发人员的成本越来越高，机器成本则是越来越便宜，所以我们的编程语言应该要侧重于开发效率和维护效率，而不应该太过于关注性能，至于性能这件事，完全可以通过升级更牛逼的硬件来很轻松的搞定。其实Ruby之父的这个观点在很久之前就被Donald Kunth说过了，“premature  optimization is the root of all evil”。两位大师的观点可谓殊途同归。<br />
<p style="padding-left: 30px;"></p><br />
    Donald Knuth在大多数软件工程师眼里可谓神一般的存在，它的这句名言也一直被码农们牢记在心。 Donald Knuth前辈并不是反对optimization，它只是反对premature optimization，即盲目无意义的优化，optimization应该要针对critical的东西。如何寻找critical的代码，就是一个profiling系统需要做的事情。当然profiling本身也属于可维护性的一部分。<br />
<p style="padding-left: 30px;"></p><br />
    Profiling的本质，是为了充分发挥CPU的能力。现代CPU的体系结构已经很牛逼了，但是相对而言，软件开发语言则没多大进步，再加上软件开发人员水平的良莠不齐，直接的后果就是，CPU的能力没有得到充分利用。虽然说使用更牛逼的CPU更牛逼的内存更牛逼的散热系统可以大幅的提高性能，但是在相同的配置下，比别人有更牛逼的表现不是更好嘛。iPhone和三星Andriod手机的对比不就是很好的证明嘛。<br />
<p style="padding-left: 30px;">现代CPU的流水线体系结构大概是这个样的。</p><br />
<img src="/images/455.jpg"><br />
Instruction Fetch Unit用来从memory中取指令到寄存器中，Decode and Issue Unit则是将指令翻译成CPU能够识别的编码然后发射到Functional Units（比如运算器等等）来执行这些指令，FU的执行结果再放回到寄存器中。 所以一条指令的执行完毕最好的情况下需要4个CPU cycles就可以搞定了。我们都已经知道流水线的原理就是，指令A在FU执行时，指令B在译码准备发射，指令C在被从内存中读取到寄存器中，于是这样就实现了不同指令的并行工作来提高CPU的效率。 CPU的这个设计思想被Unix开发人员学来了，于是就是有了管道（pipe）。再接着Erlang又把管道的原理用在了语言特性上来实现并发编程，最后Golang又把Erlang的管道特性给学了去。这并不是说CPU的设计人员有多么牛逼，而是说，软件开发人员要在CPU设计人员制定的规则下做事才能充分利用CPU的性能。<br />
<p style="padding-left: 30px;"></p><br />
    CPU的这种流水线存在的缺点，或者说，要依赖编程人员水平的地方在于，指令A可能是JUMP D，这样就导致指令B和指令C要被从流水线里面刷出去了，就造成CPU cycle的浪费。 要想避免这种浪费，就要要求程序自身具有很好的分支预测特性，即要充分迎合CPU的这种预测执行的特性。 在Linux内核里面随处可见的likely()/unlikely()就是做这个事情的，likely()/unlikely()是告诉编译器要去做什么以及不去做什么。因为CPU最后执行的是编译器生成的二进制，而不是我们写的代码，所以一个好的编译器对于程序性能的影响是巨大的。现在的编译器要比程序员聪明的多，它往往能够预测出程序接下来要执行的指令是什么，有时候我们加的likely()/unlikely()可能根本就没有意义甚至适得其反，因为程序员相比编译器而言太蠢了。有一个例子就是real-time Linux Kernel的maintainer Steven Rostedt做的一个统计，他发现内核里面有<a href="https://lwn.net/Articles/419102/">大量误用likely()/unlikely()的地方</a>，其中在<a href="https://lwn.net/Articles/420028/">page_mapping()函数里面的一个unlikely()有39%的概率是错误的</a>，然后这位大神就提交了一个patch把这个unlikely()给去掉了。所以，如果你没有十足的把握，就不要随便使用unlikely()/likely()这俩宏。 不过有一个基本准确的经验就是，在错误处理的分支上加unlikely()大致不会是坏事。比如：<br />
char * p = (char *)malloc(<span class="caps">SIZE</span>);<br />
if (unlikely(!p)) {<br />
perror(&#8220;malloc&#8221;);  // 原谅我没有缩进<br />
}</p>
<p>这里的unlikely()在绝大多数情况下都能够提升性能，不过，如果这段代码是non-critical的，那么这个unlikely()就是non-sense的，因为在这种情况下它对性能的提升可能近似为0.0000%，而且进一步而言，牛逼点的编译器自己也能够做这个事。如果这段代码真的是critical的话，那么这个unlikely()就有必要了。我们可以统计下linux内核的代码，unlikely()的使用次数大概是likely()的10倍，就是很多错误处理的分支都加了unlikely()的缘故。<br />
<p style="padding-left: 30px;"></p><br />
    除了这个分支预测之外，还有一个性质对流水线的影响较大，那就是数据依赖。指令B已经译码完成，准备要发出去的时候，发现它的操作数不可用，有可能别的CPU在使用这个操作数，于是指令B只能在这里傻傻的等待另外的CPU释放这个操作数。<br />
<p style="padding-left: 30px;"></p><br />
    所以对于流水线型的CPU，主要就这两方面决定着性能的好坏：1）数据依赖 2）分支预测。现在的并发编程也主要是解决的这两件事。<br />
<p style="padding-left: 30px;"></p><br />
    CPU的设计人员为了让程序员能够更直观的感受这两件事的表现，就给程序员提供了一些性能统计的寄存器，这些寄存器都在协处理0里面。他们做的事情，就是统计多长时间cpu cycle内，指令的issue/retire的数目，icache/dcache的hit/miss,以及l2 icache/dcache的hit/miss等等。比如说，如果icache的miss较大，那显然是程序的分支预测较差。<br />
<p style="padding-left: 30px;"></p><br />
    对于应用程序开发人员而言，是没有必要了解这么详细的性能寄存器信息的，或者说在这个上面花费精力意义不大。因而就有了perf、oprofile、systemtap、dtrace这些性能调试工具的应运而生。这些工具提供给程序员更友好的方式来分析程序，借助这些工具能够很直观的找到程序的critical部分。</p>
<p>注：<br />
<sup class="footnote" id="fnr1"><a href="#fn1">1</a></sup> 图是用Google Doc画的，第一次使用Google Doc画图，画的较差:(<br />
<sup class="footnote" id="fnr2"><a href="#fn2">2</a></sup> 本文的观点纯属个人歪歪，未必准确，但基本正确（所以说，汉语很博大精深不是） ：）</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2014-03-06T00:00:00+08:00" pubdate data-updated="true">Mar 6<span>th</span>, 2014</time></div>
	<div class="tags">

</div>
	
</div>
</article>  

<nav id="pagenavi">
    
    
        <a href="/blog/page/2/" class="next">Next</a>
    
    <div class="center"><a href="/blog/archives">Blog Archives</a></div>
</nav>

&#8211;>
</div>
	<footer id="footer" class="inner">Copyright &copy; 2015

    Yafang Shao

</footer>
	<script src="/javascripts/slash.js"></script>
<script src="/javascripts/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
	$('.fancybox').fancybox();
})(jQuery);
</script> <!-- Delete or comment this line to disable Fancybox -->


<script type="text/javascript">
      var disqus_shortname = 'laoar';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//go.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>





</body>
</html>